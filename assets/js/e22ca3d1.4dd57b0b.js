"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[6498],{8244:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>m,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>i});const o=JSON.parse('{"id":"programming/devops/prometheus/named-volume","title":"Using a Named Volume for Production","description":"Volume within the docker","source":"@site/docs/programming/devops/prometheus/named-volume.md","sourceDirName":"programming/devops/prometheus","slug":"/programming/devops/prometheus/named-volume","permalink":"/guides/docs/programming/devops/prometheus/named-volume","draft":false,"unlisted":false,"editUrl":"https://github.com/talkohavy/guides/docs/programming/devops/prometheus/named-volume.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mySidebar","previous":{"title":"- Getting Started","permalink":"/guides/docs/programming/devops/prometheus/getting-started"},"next":{"title":"- Custom Configuration","permalink":"/guides/docs/programming/devops/prometheus/custom-configuration"}}');var r=s(5813),t=s(3546);const a={},m="Using a Named Volume for Production",l={},i=[{value:"Volume within the docker",id:"volume-within-the-docker",level:2},{value:"Named volume vs anonymous volume",id:"named-volume-vs-anonymous-volume",level:2},{value:"Anonymous volume (what happens by default):",id:"anonymous-volume-what-happens-by-default",level:3},{value:"Named volume (recommended for production):",id:"named-volume-recommended-for-production",level:3},{value:"Why named volumes help with upgrades",id:"why-named-volumes-help-with-upgrades",level:2},{value:"In kubernetes",id:"in-kubernetes",level:2},{value:"Kubernetes persistent storage",id:"kubernetes-persistent-storage",level:3},{value:"How it works for Prometheus",id:"how-it-works-for-prometheus",level:3}];function u(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"using-a-named-volume-for-production",children:"Using a Named Volume for Production"})}),"\n",(0,r.jsx)(n.h2,{id:"volume-within-the-docker",children:"Volume within the docker"}),"\n",(0,r.jsx)(n.p,{children:"The Dockerfile declares:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'VOLUME [ "/prometheus" ]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["This means ",(0,r.jsx)(n.code,{children:"/prometheus"})," is a volume mount point. Prometheus stores its time-series data there."]}),"\n",(0,r.jsx)(n.h2,{id:"named-volume-vs-anonymous-volume",children:"Named volume vs anonymous volume"}),"\n",(0,r.jsx)(n.p,{children:"From the official documentation:"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"The Prometheus image uses a volume to store the actual metrics. For production deployments it is highly recommended to use a named volume to ease managing the data on Prometheus upgrades."})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"anonymous-volume-what-happens-by-default",children:"Anonymous volume (what happens by default):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run --name prometheus -d -p 127.0.0.1:9090:9090 prom/prometheus\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Docker creates an anonymous volume automatically"}),"\n",(0,r.jsxs)(n.li,{children:["The volume has a random hash name like ",(0,r.jsx)(n.code,{children:"a1b2c3d4e5f6..."})]}),"\n",(0,r.jsx)(n.li,{children:"Hard to identify and manage"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"named-volume-recommended-for-production",children:"Named volume (recommended for production):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Create a named volume first\ndocker volume create prometheus-data\n\n# Use it in your run command\ndocker run --name prometheus -d -p 127.0.0.1:9090:9090 \\\n  -v prometheus-data:/prometheus \\\n  prom/prometheus\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You give it a clear name (",(0,r.jsx)(n.code,{children:"prometheus-data"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Easy to identify, manage, and reference"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"why-named-volumes-help-with-upgrades",children:"Why named volumes help with upgrades"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Easy to reference:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Stop old container\ndocker stop prometheus\ndocker rm prometheus\n\n# Start new version with same data\ndocker run --name prometheus -d -p 127.0.0.1:9090:9090 \\\n  -v prometheus-data:/prometheus \\\n  prom/prometheus:v2.0.0\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Easy to backup:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Backup the named volume\ndocker run --rm -v prometheus-data:/data -v $(pwd):/backup \\\n  busybox tar czf /backup/prometheus-backup.tar.gz /data\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Easy to inspect:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker volume inspect prometheus-data\ndocker volume ls  # See all your named volumes\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"Persists across container removal:"}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Removing the container doesn't remove a named volume"}),"\n",(0,r.jsx)(n.li,{children:"Anonymous volumes can be orphaned and harder to track"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"in-kubernetes",children:"In kubernetes"}),"\n",(0,r.jsx)(n.p,{children:"In Kubernetes, you don't use Docker named volumes. Use PersistentVolumes (PVs) and PersistentVolumeClaims (PVCs) for persistent storage."}),"\n",(0,r.jsx)(n.h3,{id:"kubernetes-persistent-storage",children:"Kubernetes persistent storage"}),"\n",(0,r.jsx)(n.p,{children:"Kubernetes uses PersistentVolumeClaims (PVCs) to request storage, which is similar to a named volume but managed by Kubernetes."}),"\n",(0,r.jsx)(n.h3,{id:"how-it-works-for-prometheus",children:"How it works for Prometheus"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a PersistentVolumeClaim:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: prometheus-data\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 50Gi\n  storageClassName: standard  # or whatever your cluster uses\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Use it in your Prometheus Deployment:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: prometheus\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: prometheus\n  template:\n    metadata:\n      labels:\n        app: prometheus\n    spec:\n      containers:\n      - name: prometheus\n        image: prom/prometheus\n        volumeMounts:\n        - name: prometheus-storage\n          mountPath: /prometheus  # This matches the VOLUME in Dockerfile\n        args:\n          - "--config.file=/etc/prometheus/prometheus.yml"\n          - "--storage.tsdb.path=/prometheus"\n      volumes:\n      - name: prometheus-storage\n        persistentVolumeClaim:\n          claimName: prometheus-data  # Reference to the PVC\n'})}),"\n",(0,r.jsx)(n.p,{children:"Why this helps with upgrades"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Data persists across pod restarts and upgrades"}),"\n",(0,r.jsx)(n.li,{children:"Easy to reference: use the same PVC name in new deployments"}),"\n",(0,r.jsx)(n.li,{children:"Kubernetes manages the underlying storage"}),"\n",(0,r.jsx)(n.li,{children:"Can be backed up using standard Kubernetes tools"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Complete example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: prometheus-data\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 50Gi\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: prometheus\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: prometheus\n  template:\n    metadata:\n      labels:\n        app: prometheus\n    spec:\n      containers:\n      - name: prometheus\n        image: prom/prometheus:latest\n        ports:\n        - containerPort: 9090\n        volumeMounts:\n        - name: prometheus-storage\n          mountPath: /prometheus\n        - name: prometheus-config\n          mountPath: /etc/prometheus\n        args:\n          - "--config.file=/etc/prometheus/prometheus.yml"\n          - "--storage.tsdb.path=/prometheus"\n      volumes:\n      - name: prometheus-storage\n        persistentVolumeClaim:\n          claimName: prometheus-data\n      - name: prometheus-config\n        configMap:\n          name: prometheus-config\n'})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},3546:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>m});var o=s(9729);const r={},t=o.createContext(r);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function m(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);