"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[1663],{6477:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"programming/web/history","title":"History","description":"1. Description","source":"@site/docs/programming/web/history.md","sourceDirName":"programming/web","slug":"/programming/web/history","permalink":"/guides/docs/programming/web/history","draft":false,"unlisted":false,"editUrl":"https://github.com/talkohavy/guides/docs/programming/web/history.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mySidebar","previous":{"title":"- Headers","permalink":"/guides/docs/programming/web/headers"},"next":{"title":"- Http","permalink":"/guides/docs/http"}}');var i=n(5813),a=n(3546);const r={},o="History",h={},c=[{value:"1. Description",id:"1-description",level:2},{value:"2. Working with the History API",id:"2-working-with-the-history-api",level:2},{value:"3. Single-page applications and session history",id:"3-single-page-applications-and-session-history",level:2},{value:"4. Using pushState()",id:"4-using-pushstate",level:2},{value:"5. Using the <code>popstate</code> event",id:"5-using-the-popstate-event",level:2},{value:"6. Using replaceState()",id:"6-using-replacestate",level:2},{value:"7. Examples",id:"7-examples",level:2}];function l(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"history",children:"History"})}),"\n",(0,i.jsx)(t.h2,{id:"1-description",children:"1. Description"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"History"})," interface of the History API allows manipulation of the browser ",(0,i.jsx)(t.em,{children:"session history"}),", that is the pages visited in the tab or frame that the current page is loaded in."]}),"\n",(0,i.jsxs)(t.p,{children:["There is only ",(0,i.jsx)(t.strong,{children:"one instance of history"}),", ",(0,i.jsx)(t.strong,{children:"it is a singleton"}),", accessible via the global object ",(0,i.jsx)(t.code,{children:"history"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"2-working-with-the-history-api",children:"2. Working with the History API"}),"\n",(0,i.jsx)(t.p,{children:'The History API enables a website to interact with the browser\'s session history: that is, the list of pages that the user has visited in a given window. As the user visits new pages, for example by clicking links, those new pages are added to the session history. The user can also move back and forth through the history using the browser\'s "Back" and "Forward" buttons.'}),"\n",(0,i.jsx)(t.p,{children:"The main interface defined in the History API is the History interface, and this defines two quite distinct sets of methods:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Methods to navigate to a page in the session history:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"History.back()"}),"\n",(0,i.jsx)(t.li,{children:"History.forward()"}),"\n",(0,i.jsx)(t.li,{children:"History.go()"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Methods to modify the session history:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"History.pushState()"}),"\n",(0,i.jsx)(t.li,{children:"History.replaceState()"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In this guide we'll be concerned only with the second set of methods, as these have more complex behavior."}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"pushState()"})," method adds a new entry to the session history, while the ",(0,i.jsx)(t.code,{children:"replaceState()"})," method updates the session history entry for the current page. Both these methods take a ",(0,i.jsx)(t.code,{children:"state"})," parameter which can contain any serializable object. When the browser navigates to this history entry, the browser fires a ",(0,i.jsx)(t.code,{children:"popstate"})," event, which contains the state object associated with that entry."]}),"\n",(0,i.jsxs)(t.p,{children:["The main purpose of these APIs is to support websites like Single-page applications, that use JavaScript APIs such as ",(0,i.jsx)(t.code,{children:"fetch()"})," to update the page with new content, instead of loading a whole new page."]}),"\n",(0,i.jsx)(t.h2,{id:"3-single-page-applications-and-session-history",children:"3. Single-page applications and session history"}),"\n",(0,i.jsx)(t.p,{children:"Traditionally, websites are implemented as a collection of pages. When users navigate to different parts of the site by clicking links, the browser loads a whole new page each time."}),"\n",(0,i.jsx)(t.p,{children:"While this is great for many sites, it can have some disadvantages:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"It can be inefficient to load a whole page every time, when only part of the page needs to be updated."}),"\n",(0,i.jsx)(t.li,{children:"It is hard to maintain application state when navigating across pages"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For these reasons, a popular pattern for web apps is the single-page application (SPA), in which the site consists of a single page, and when the user clicks links, the page:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Prevents the default behavior of loading a new page"}),"\n",(0,i.jsx)(t.li,{children:"Fetches new content to display"}),"\n",(0,i.jsx)(t.li,{children:"Updates the page with the new content"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'document.addEventListener("click", async (event) => {\n  const creature = event.target.getAttribute("data-creature");\n  if (creature) {\n    // Prevent a new page from loading\n    event.preventDefault();\n    try {\n      // Fetch new content\n      const response = await fetch(`creatures/${creature}.json`);\n      const json = await response.json();\n      // Update the page with the new content\n      displayContent(json);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n});\n'})}),"\n",(0,i.jsxs)(t.p,{children:["In this click handler, if the link contains a data attribute ",(0,i.jsx)(t.code,{children:'"data-creature"'}),", then we use the value of that attribute to fetch a JSON file containing the new content for the page."]}),"\n",(0,i.jsx)(t.p,{children:"The JSON file might look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n  "description": "Bald eagles are not actually bald.",\n  "image": {\n    "src": "images/eagle.jpg",\n    "alt": "A bald eagle"\n  },\n  "name": "Eagle"\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Our displayContent() function updates the page with the JSON:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'// Update the page with the new content\nfunction displayContent(content) {\n  document.title = `Creatures: ${content.name}`;\n\n  const description = document.querySelector("#description");\n  description.textContent = content.description;\n\n  const photo = document.querySelector("#photo");\n  photo.setAttribute("src", content.image.src);\n  photo.setAttribute("alt", content.image.alt);\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:'The problem is that it breaks the expected behavior of the browser\'s "Back" and "Forward" buttons.'}),"\n",(0,i.jsx)(t.p,{children:"From the user's point of view, they clicked a link and the page updated, so it looks like a new page. If they then press the browser's \"Back\" button, they expect to go to the state before they clicked the link."}),"\n",(0,i.jsx)(t.p,{children:'But as far as the browser is concerned, the last link didn\'t load a new page, so "Back" will take the browser to whichever page was loaded before the user opened the SPA.'}),"\n",(0,i.jsxs)(t.p,{children:["This is essentially the problem that ",(0,i.jsx)(t.code,{children:"pushState()"}),", ",(0,i.jsx)(t.code,{children:"replaceState()"}),", and the ",(0,i.jsx)(t.code,{children:"popstate"}),' event solve. They enable us to synthesize history entries, and to be notified when the current session history entry changes to one of these entries (for example, because the user pressed the "Back" or "Forward" buttons).']}),"\n",(0,i.jsx)(t.h2,{id:"4-using-pushstate",children:"4. Using pushState()"}),"\n",(0,i.jsx)(t.p,{children:"We can add a history entry to the click handler above as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'document.addEventListener("click", async (event) => {\n  const creature = event.target.getAttribute("data-creature");\n  if (creature) {\n    event.preventDefault();\n    try {\n      const response = await fetch(`creatures/${creature}.json`);\n      const json = await response.json();\n      displayContent(json);\n      // Add a new entry to the history.\n      // This simulates loading a new page.\n      history.pushState(json, "", creature);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n});\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Here, we're calling ",(0,i.jsx)(t.code,{children:"pushState()"})," with three arguments:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"json"}),": this is the content we just fetched. It will be stored with the history entry, and later included as the ",(0,i.jsx)(t.code,{children:"state"})," property of the argument passed to the ",(0,i.jsx)(t.code,{children:"popstate"})," event handler."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:'""'}),": this is needed for backward compatibility with legacy sites, and should always be an empty string"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"creature"}),": this will be used as the URL for the entry. It will be shown in the browser's URL bar, and will be used as the value of the ",(0,i.jsx)(t.code,{children:"Referer"})," header in any HTTP requests that the page makes. Note that this must be ",(0,i.jsx)(t.code,{children:"same-origin"})," with the page."]}),"\n"]}),"\n",(0,i.jsxs)(t.h2,{id:"5-using-the-popstate-event",children:["5. Using the ",(0,i.jsx)(t.code,{children:"popstate"})," event"]}),"\n",(0,i.jsx)(t.p,{children:"Suppose the user:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Clicks a link in our SPA, so we update the page and add history entry A using ",(0,i.jsx)(t.code,{children:"pushState()"})]}),"\n",(0,i.jsxs)(t.li,{children:["Clicks another link in our SPA, so we update the page and add history entry B using ",(0,i.jsx)(t.code,{children:"pushState()"})]}),"\n",(0,i.jsx)(t.li,{children:'Presses the "Back" button'}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Now the new current history entry is A, so the browser fires the ",(0,i.jsx)(t.code,{children:"popstate"})," event, and the event handler argument includes the JSON that we passed to ",(0,i.jsx)(t.code,{children:"pushState()"})," when we handled the navigation to A. This means we can restore the correct content with an event handler like this:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'// Handle forward/back buttons\nwindow.addEventListener("popstate", (event) => {\n  // If a state has been provided, we have a "simulated" page\n  // and we update the current page.\n  if (event.state) {\n    // Simulate the loading of the previous page\n    displayContent(event.state);\n  }\n});\n'})}),"\n",(0,i.jsx)(t.h2,{id:"6-using-replacestate",children:"6. Using replaceState()"}),"\n",(0,i.jsx)(t.p,{children:"There's one more piece we need to add. When the user loads the SPA, the browser adds a history entry. Because this was an actual page load, the entry has no state associated with it. So suppose the user:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Loads the SPA: the browser adds a history entry"}),"\n",(0,i.jsxs)(t.li,{children:["Clicks a link inside the SPA: the click handler updates the page and adds a history entry with ",(0,i.jsx)(t.code,{children:"pushState()"})]}),"\n",(0,i.jsx)(t.li,{children:'Presses the "Back" button'}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Now we want to go back to the SPA's initial state, but since this is a navigation in the same document, the page will not be reloaded, and since the history entry for the initial page has no state, we can't use ",(0,i.jsx)(t.code,{children:"popstate"})," to restore it."]}),"\n",(0,i.jsxs)(t.p,{children:["The solution here is to use ",(0,i.jsx)(t.code,{children:"replaceState()"})," to set the state object for the initial page. For example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'// Create state on page load and replace the current history with it\nconst image = document.querySelector("#photo");\nconst initialState = {\n  description: document.querySelector("#description").textContent,\n  image: {\n    src: image.getAttribute("src"),\n    alt: image.getAttribute("alt"),\n  },\n  name: "Home",\n};\nhistory.replaceState(initialState, "", document.location.href);\n'})}),"\n",(0,i.jsxs)(t.p,{children:["On page load, we collect all the parts of the page that we need to restore when the user returns to the starting point for the SPA. This has the same structure as the JSON we fetch when handling other navigations. We pass this ",(0,i.jsx)(t.code,{children:"initialState"})," object into ",(0,i.jsx)(t.code,{children:"replaceState()"}),", which effectively adds the state object to the current history entry."]}),"\n",(0,i.jsxs)(t.p,{children:["When the user returns to our starting point, the ",(0,i.jsx)(t.code,{children:"popstate"})," event will contain this initial state, and we can use our ",(0,i.jsx)(t.code,{children:"displayContent()"})," function to update the page."]}),"\n",(0,i.jsx)(t.h2,{id:"7-examples",children:"7. Examples"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:'window.addEventListener("popstate", (event) => {\n  alert(\n    `location: ${document.location}, state: ${JSON.stringify(event.state)}`,\n  );\n});\n\nhistory.pushState({ page: 1 }, "title 1", "?page=1");\nhistory.pushState({ page: 2 }, "title 2", "?page=2");\nhistory.replaceState({ page: 3 }, "title 3", "?page=3");\nhistory.back(); // alerts "location: http://example.com/example.html?page=1, state: {"page":1}"\nhistory.back(); // alerts "location: http://example.com/example.html, state: null"\nhistory.go(2); // alerts "location: http://example.com/example.html?page=3, state: {"page":3}"\n'})})]})}function d(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},3546:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var s=n(9729);const i={},a=s.createContext(i);function r(e){const t=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:t},e.children)}}}]);