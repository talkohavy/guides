"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[7944],{4789:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var i=t(5493),s=t(6070),o=t(7010);const r={title:"How to Create a Component Library with Vite",description:"How to create a components library fast using Vite's library mode, typescript, css modules, and publish to npm.",slug:"vite-library-mode",authors:["talkohavy"],image:"https://i.ibb.co/rGSxHmB/vite.png",tags:["vite","react","typescript","tutorial"],hide_table_of_contents:!1},l=void 0,a={authorsImageUrls:[void 0]},d=[{value:"1. Set up a new Vite project",id:"1-set-up-a-new-vite-project",level:2},{value:"2. Create a <code>lib/main.ts</code> file",id:"2-create-a-libmaints-file",level:2},{value:"3. Activate Vite&#39;s Library Mode",id:"3-activate-vites-library-mode",level:2},{value:"4. tsconfig.json dedicated for build",id:"4-tsconfigjson-dedicated-for-build",level:2},{value:"5. Use the tsconfig.build.ts for building",id:"5-use-the-tsconfigbuildts-for-building",level:2},{value:"6. Copy <code>vite-env.d.ts</code> from <code>src</code> to <code>lib</code>",id:"6-copy-vite-envdts-from-src-to-lib",level:2},{value:"7. Set <code>emptyOutDir</code> to <code>false</code>",id:"7-set-emptyoutdir-to-false",level:2},{value:"8. Get rid of the <code>vite.svg</code> file",id:"8-get-rid-of-the-vitesvg-file",level:2},{value:"9. Create a basic component",id:"9-create-a-basic-component",level:2},{value:"10. Remove <code>react</code> &amp; <code>react/jsx-runtime</code> from the bundle",id:"10-remove-react--reactjsx-runtime-from-the-bundle",level:2},{value:"11. Handle CSS files",id:"11-handle-css-files",level:2},{value:"12. Split up the CSS",id:"12-split-up-the-css",level:2},{value:"13. Update your <code>package.json</code> file",id:"13-update-your-packagejson-file",level:2},{value:"14. Add CSS to Side effects",id:"14-add-css-to-side-effects",level:2},{value:"15. Use <code>prepublishOnly</code> to ensure build prior to publish",id:"15-use-prepublishonly-to-ensure-build-prior-to-publish",level:2},{value:"16. Demo page",id:"16-demo-page",level:2}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"1-set-up-a-new-vite-project",children:"1. Set up a new Vite project"}),"\n",(0,s.jsx)(n.p,{children:"Start a new project:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm create vite@latest\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Choose ",(0,s.jsx)(n.code,{children:"React"})," & ",(0,s.jsx)(n.code,{children:"TypeScript + SWC"})]}),"\n",(0,s.jsx)(n.p,{children:"Here are 4 things I recommend you to do right after installing Vite:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Early first commit\nCommitting regularly is a very good habit. And there is one point in time where it is especially helpful, right after you created a new project and BEFORE you type the first character in your project."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install node's types\nIf working with TypeScript I also install the types package for node. Sooner or later you will need this."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @types/node\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"2-create-a-libmaints-file",children:["2. Create a ",(0,s.jsx)(n.code,{children:"lib/main.ts"})," file"]}),"\n",(0,s.jsxs)(n.p,{children:["Create a folder next to ",(0,s.jsx)(n.code,{children:"src"})," and name it ",(0,s.jsx)(n.code,{children:"lib"}),". Inside, create the file which will act as the main entry point of your library, and name it ",(0,s.jsx)(n.code,{children:"main.ts"}),". When installing the library you can import everything that is exported from this file."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-diff",children:" \ud83d\udcc2 my-component-library\n// diff-add-start\n\u2523 \ud83d\udcc2 lib\n\u2503 \u2517 \ud83d\udcdc main.ts\n// diff-add-end\n  \u2523 \ud83d\udcc2 public\n  \u2523 \ud83d\udcc2 src\n  \u2026\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3-activate-vites-library-mode",children:"3. Activate Vite's Library Mode"}),"\n",(0,s.jsxs)(n.p,{children:["By default, when running ",(0,s.jsx)(n.code,{children:"vite build"}),", Vite will transpile the code inside ",(0,s.jsx)(n.code,{children:"src"})," to the ",(0,s.jsx)(n.code,{children:"dist"})," folder. What we want instead, is to transpile and ship the code inside of ",(0,s.jsx)(n.code,{children:"lib"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["To activate vite's library mode, inside of our ",(0,s.jsx)(n.code,{children:"vite.config.ts"})," file, we will need to use the ",(0,s.jsx)(n.code,{children:"build.lib"})," option."]}),"\n",(0,s.jsx)(n.p,{children:"Like so (do not copy code yet!):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",metastring:"showLineNumbers",children:"// diff-add-next-line\nimport { resolve } from 'path'\nimport { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react-swc'\n\nexport default defineConfig({\n  plugins: [react()],\n// diff-add-start\n  build: {\n    lib: {\n      entry: resolve(__dirname, 'lib/main.ts'),\n      formats: ['es']\n    }\n  }\n// diff-add-end\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"4-tsconfigjson-dedicated-for-build",children:"4. tsconfig.json dedicated for build"}),"\n",(0,s.jsxs)(n.p,{children:["Update the contents of your ",(0,s.jsx)(n.code,{children:"tsconfig.json"})," file like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"title=tsconfig.json",children:'{\n  "files": [],\n  "references": [\n    { "path": "./tsconfig.app.json" },\n    { "path": "./tsconfig.node.json" },\n// diff-add-next-line\n    { "path": "./tsconfig.build.json" }\n  ]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["And create a new ",(0,s.jsx)(n.code,{children:"tsconfig.json"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-diff",children:" \ud83d\udcc2my-component-library\n  \u2523 ...\n  \u2523 \ud83d\udcdctsconfig.json\n// diff-add-next-line\n\u2523 \ud83d\udcdctsconfig.build.json\n  ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"And paste the below code as its contents:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"title=tsconfig.build.ts",children:'{\n  "extends": "./tsconfig.json",\n  "compilerOptions": {\n    // -------------------\n    // Section 1: Projects\n    // -------------------\n    // "composite": true, // Enable constraints that allow a TypeScript project to be used with project references.\n    // "incremental": true, // Save .tsbuildinfo files to allow for incremental compilation of projects.\n    // "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo", // Specify the path to .tsbuildinfo incremental compilation file.\n    // "disableSourceOfProjectReferenceRedirect": true,  // Disable preferring source files instead of declaration files when referencing composite projects.\n    // "disableSolutionSearching": true,                 // Opt a project out of multi-project reference checking when editing.\n    // "disableReferencedProjectLoad": true,             // Reduce the number of projects loaded automatically by TypeScript.\n\n    // -----------------------------------\n    // Section 2: Language and Environment\n    // -----------------------------------\n    "target": "ESNext",\n    "jsx": "react-jsx", // Specify what JSX code is generated.\n    "lib": ["ESNext", "DOM", "DOM.Iterable"], // adding the "DOM" library helps vs-code to recognize the window & document objects. Specify a set of bundled library declaration files that describe the target runtime environment.\n    "useDefineForClassFields": true, // Emit ECMAScript-standard-compliant class fields.\n    "moduleDetection": "force", // <--- defaults to `auto`. Control what method is used to detect module-format JS files.\n    // "experimentalDecorators": true,                   // Enable experimental support for legacy experimental decorators.\n    // "emitDecoratorMetadata": true,                    // Emit design-type metadata for decorated declarations in source files.\n    // "jsxFactory": "",                                 // Specify the JSX factory function used when targeting React JSX emit, e.g. \'React.createElement\' or \'h\'.\n    // "jsxFragmentFactory": "",                         // Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. \'React.Fragment\' or \'Fragment\'.\n    // "jsxImportSource": "",                            // Specify module specifier used to import the JSX factory functions when using \'jsx: react-jsx*\'.\n    // "reactNamespace": "",                             // Specify the object invoked for \'createElement\'. This only applies when targeting \'react\' JSX emit.\n    // "noLib": true,                                    // Disable including any library files, including the default lib.d.ts.\n\n    // ------------------\n    // Section 3: Modules\n    // ------------------\n    "module": "ESNext", // <--- defaults to `commonjs`. Specify what module code is generated.\n    "moduleResolution": "Bundler", // Specify how TypeScript looks up a file from a given module specifier.\n    "resolveJsonModule": true,\n    "allowImportingTsExtensions": true, // Option \'allowImportingTsExtensions\' can only be used when either \'noEmit\' or \'emitDeclarationOnly\' is set.ts\n    "baseUrl": "./", // Specify the base directory to resolve non-relative module names.\n    "typeRoots": ["node_modules/@types"], // Specify multiple folders that act like \'./node_modules/@types\'.\n    "paths": {\n      "/*": ["src/public/*"],\n      "@src/*": ["src/*"]\n    },\n    // "rootDirs": [],                                   /* Allow multiple folders to be treated as one when resolving modules. */\n    // "types": [],                                      /* Specify type package names to be included without being referenced in a source file. */\n    // "allowUmdGlobalAccess": true,                     /* Allow accessing UMD globals from modules. */\n    // "moduleSuffixes": [],                             /* List of file name suffixes to search when resolving a module. */\n    // "allowImportingTsExtensions": true,               /* Allow imports to include TypeScript file extensions. Requires \'--moduleResolution bundler\' and either \'--noEmit\' or \'--emitDeclarationOnly\' to be set. */\n    // "resolvePackageJsonExports": true,                /* Use the package.json \'exports\' field when resolving package imports. */\n    // "resolvePackageJsonImports": true,                /* Use the package.json \'imports\' field when resolving imports. */\n    // "customConditions": [],                           /* Conditions to set in addition to the resolver-specific defaults when resolving imports. */\n    // "resolveJsonModule": true,                        /* Enable importing .json files. */\n    // "allowArbitraryExtensions": true,                 /* Enable importing files with any extension, provided a declaration file is present. */\n    // "noResolve": true,                                /* Disallow \'import\'s, \'require\'s or \'<reference>\'s from expanding the number of files TypeScript should add to a project. */\n\n    // -----------------------------\n    // Section 4: JavaScript Support\n    // -----------------------------\n    "checkJs": true, // without it? this config file would not apply to js/jsx files. Enable error reporting in type-checked JavaScript files.\n    "maxNodeModuleJsDepth": 0, // Specify the maximum folder depth used for checking JavaScript files from \'node_modules\'. Only applicable with \'allowJs\'.\n    // "allowJs": true,                                  /* Allow JavaScript files to be a part of your program. Use the \'checkJS\' option to get errors from these files. */\n\n    // ---------------\n    // Section 5: Emit\n    // ---------------\n    "noEmit": false, // set to `true` to disable emitting files from a compilation.\n    "outDir": "./dist", // Specify an output folder for all emitted files.\n    "declaration": true, // Generate .d.ts files from TypeScript and JavaScript files in your project.\n    "emitDeclarationOnly": true, // Only output d.ts files and not JavaScript files\n    // "sourceMap": true, // defaults to `false`. Create source map files for emitted JavaScript files.\n    // "declarationMap": true, // Create sourcemaps for d.ts files.\n    // "inlineSourceMap": true, // Include sourcemap files inside the emitted JavaScript. */\n    // "outFile": "./", // Specify a file that bundles all outputs into one JavaScript file. If \'declaration\' is true, also designates a file that bundles all .d.ts output. */\n    // "removeComments": true, // Disable emitting comments.\n    // "importHelpers": true, // Allow importing helper functions from tslib once per project, instead of including them per-file.\n    // "downlevelIteration": true, // Emit more compliant, but verbose and less performant JavaScript for iteration.\n    // "sourceRoot": "", // Specify the root path for debuggers to find the reference source code.\n    // "mapRoot": "", // Specify the location where debugger should locate map files instead of generated locations.\n    // "inlineSources": true, // Include source code in the sourcemaps inside the emitted JavaScript.\n    // "emitBOM": true, // Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files.\n    // "newLine": "crlf", // Set the newline character for emitting files.\n    // "stripInternal": true, // Disable emitting declarations that have \'@internal\' in their JSDoc comments.\n    // "noEmitHelpers": true, // Disable generating custom helper functions like \'__extends\' in compiled output.\n    // "noEmitOnError": true, // Disable emitting files if any type checking errors are reported.\n    // "preserveConstEnums": true, // Disable erasing \'const enum\' declarations in generated code.\n    // "declarationDir": "./", // Specify the output directory for generated declaration files.\n\n    // ------------------------------\n    // Section 6: Interop Constraints\n    // ------------------------------\n    "isolatedModules": true, // <--- Setting to `true` tells TypeScript to warn you if you write certain code that can\'t be correctly interpreted by a single-file transpilation process. Ensure that each file can be safely transpiled without relying on other imports.\n    "esModuleInterop": true, // Emit additional JavaScript to ease support for importing CommonJS modules. This enables \'allowSyntheticDefaultImports\' for type compatibility.\n    "allowSyntheticDefaultImports": true, // Allow \'import x from y\' when a module doesn\'t have a default export.\n    "forceConsistentCasingInFileNames": true, // Ensure that casing is correct in imports.\n    // "preserveSymlinks": true, // <--- Solved being redirected to node_modules/.pnpm symlink all the time! Disable resolving symlinks to their realpath. This correlates to the same flag in node. But on the other-hand, I wasn\'t able to import Page as type from playwright in jsdoc. Disable resolving symlinks to their realpath. This correlates to the same flag in node.\n    // "verbatimModuleSyntax": true,                     /* Do not transform or elide any imports or exports not marked as type-only, ensuring they are written in the output file\'s format based on the \'module\' setting. */\n    // "isolatedDeclarations": true,                     /* Require sufficient annotation on exports so other tools can trivially generate declaration files. */\n\n    // ------------------------\n    // Section 7: Type Checking\n    // ------------------------\n    /* Linting */\n    // "strictNullChecks": true,                         // <--- When type checking, take into account \'null\' and \'undefined\'.\n    // "strictFunctionTypes": true,                      // <--- When assigning functions, check to ensure parameters and the return values are subtype-compatible.\n    // "strictBindCallApply": true,                      // <--- Check that the arguments for \'bind\', \'call\', and \'apply\' methods match the original function.\n    // "strictPropertyInitialization": true,             // <--- Check for class properties that are declared but not set in the constructor.\n    "strict": true, // <--- Enable all strict type-checking options.\n    "noImplicitAny": true, // <--- Enable error reporting for expressions and declarations with an implied \'any\' type.\n    "noImplicitThis": true, // <---Enable error reporting when \'this\' is given the type \'any\'.\n    "useUnknownInCatchVariables": true, // <--- Default catch clause variables as \'unknown\' instead of \'any\'.\n    "alwaysStrict": true, // <--- Ensure \'use strict\' is always emitted.\n    "noUnusedLocals": true, // <--- Enable error reporting when local variables aren\'t read.\n    "noUnusedParameters": true, // <--- Raise an error when a function parameter isn\'t read.\n    "exactOptionalPropertyTypes": false, // <--- Interpret optional property types as written, rather than adding \'undefined\'.\n    "noImplicitReturns": true, // <--- Enable error reporting for codepaths that do not explicitly return in a function.\n    "noFallthroughCasesInSwitch": true, // <--- Enable error reporting for fallthrough cases in switch statements.\n    "noUncheckedIndexedAccess": true, // <--- Add \'undefined\' to a type when accessed using an index.\n    "noImplicitOverride": true, // <--- Ensure overriding members in derived classes are marked with an override modifier.\n    "noPropertyAccessFromIndexSignature": false, // <--- settings this to true marks obj[\'firstName\'] as an error, and recommends obj.firstName instead. Enforces using indexed accessors for keys declared using an indexed type.\n    "allowUnusedLabels": false, // <--- Disable error reporting for unused labels.\n    // "allowUnreachableCode": true,                     // <--- Disable error reporting for unreachable code.\n\n    // -----------------------\n    // Section 8: Completeness\n    // -----------------------\n    "skipLibCheck": true // Skip type checking all .d.ts files.\n    // "skipDefaultLibCheck": true,                      /* Skip type checking .d.ts files that are included with TypeScript. */\n  },\n  "include": ["lib"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:['The important part to notice is that the "include" key of it has the value of ["lib"], to have our typescript rules be applied only to the ',(0,s.jsx)(n.code,{children:"lib"})," folder, and not the ",(0,s.jsx)(n.code,{children:"src"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Implementing this separate configuration helps avoid TypeScript errors when you import components directly from the ",(0,s.jsx)(n.code,{children:"dist"})," folder on the demo page and those components haven't been built yet."]}),"\n",(0,s.jsx)(n.h2,{id:"5-use-the-tsconfigbuildts-for-building",children:"5. Use the tsconfig.build.ts for building"}),"\n",(0,s.jsxs)(n.p,{children:["To use ",(0,s.jsx)(n.code,{children:"tsconfig.build.json"})," for building you need to pass the configuration file to ",(0,s.jsx)(n.code,{children:"tsc"})," in the build script in your package.json:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  // ...\n  "scripts": {\n     ...\n// diff-remove-next-line\n  "build": "tsc && vite build",\n// diff-add-next-line\n  "build": "tsc -p ./tsconfig.build.json && vite build",\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"6-copy-vite-envdts-from-src-to-lib",children:["6. Copy ",(0,s.jsx)(n.code,{children:"vite-env.d.ts"})," from ",(0,s.jsx)(n.code,{children:"src"})," to ",(0,s.jsx)(n.code,{children:"lib"})]}),"\n",(0,s.jsxs)(n.p,{children:["You will also need to copy the file ",(0,s.jsx)(n.code,{children:"vite-env.d.ts"})," from ",(0,s.jsx)(n.code,{children:"src"})," to ",(0,s.jsx)(n.code,{children:"lib"}),". Without this file Typescript will miss some types definitions provided by Vite when building (because we don't include ",(0,s.jsx)(n.code,{children:"src"})," in our ",(0,s.jsx)(n.code,{children:"tsconfig.build.ts"}),")."]}),"\n",(0,s.jsxs)(n.h2,{id:"7-set-emptyoutdir-to-false",children:["7. Set ",(0,s.jsx)(n.code,{children:"emptyOutDir"})," to ",(0,s.jsx)(n.code,{children:"false"})]}),"\n",(0,s.jsx)(n.p,{children:"By default, vite empties the output directory."}),"\n",(0,s.jsxs)(n.p,{children:["This ",(0,s.jsx)(n.em,{children:"would"})," have been a good behavior, if we weren't using types being compiled with typescript."]}),"\n",(0,s.jsxs)(n.p,{children:["See, what happens now is that typescript creates types (just the types), puts them inside the ",(0,s.jsx)(n.code,{children:"dist"})," folder, and then comes along vite and deletes them. We want to cancel that behavior:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=cite.config.ts",children:"import { defineConfig } from 'vite';\n\nexport default defineConfig({\n  build: {\n    // ...\n    emptyOutDir: false, // <--- defaults to `true`\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can now execute ",(0,s.jsx)(n.code,{children:"npm run build"})," and this is what you will see in your ",(0,s.jsx)(n.code,{children:"dist"})," folder:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2dist\n  \u2523 \ud83d\udcdcmy-component-library.js\n  \u2523 \ud83d\udcdcmain.d.ts\n  \u2523 \ud83d\udcdcmain.js\n  \u2517 \ud83d\udcdcvite.svg\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["\ud83d\udca1 The name of the output file is identical with the ",(0,s.jsx)(n.code,{children:"name"})," property in your package.json per default. This can be changed in the Vite config (",(0,s.jsx)(n.code,{children:"build.lib.fileName"}),") but we will do something else about this later."]})}),"\n",(0,s.jsxs)(n.h2,{id:"8-get-rid-of-the-vitesvg-file",children:["8. Get rid of the ",(0,s.jsx)(n.code,{children:"vite.svg"})," file"]}),"\n",(0,s.jsxs)(n.p,{children:["The file ",(0,s.jsx)(n.code,{children:"vite.svg"})," is in your ",(0,s.jsx)(n.code,{children:"dist"})," folder because Vite copies all files from the ",(0,s.jsx)(n.code,{children:"public"})," directory to the output folder. Let's disable this behavior:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"showLineNumbers",children:"export default defineConfig({\n  // ...\n  build: {\n// diff-add-next-line\n    copyPublicDir: false,\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"9-create-a-basic-component",children:"9. Create a basic component"}),"\n",(0,s.jsxs)(n.p,{children:["What is a React component library without components?",(0,s.jsx)(n.br,{}),"\n","Let's create one or two:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2 my-component-library\n  \u2523 \ud83d\udcc2 lib\n +\u2503 \u2523 \ud83d\udcc2 components\n +\u2503 \u2503 \u2523 \ud83d\udcc2 Button\n +\u2503 \u2503 \u2503 \u2523 \ud83d\udcc2 Button.tsx\n +\u2503 \u2503 \u2503 \u2517 \ud83d\udcdc index.ts\n +\u2503 \u2503 \u2517 \ud83d\udcc2 Label\n +\u2503 \u2503 \u2503 \u2523 \ud83d\udcc2 Label.tsx\n +\u2503 \u2503   \u2517 \ud83d\udcdc index.ts\n  \u2503 \u2517 \ud83d\udcdc main.ts\n  \u2026\n"})}),"\n",(0,s.jsx)(n.p,{children:"And add a very basic implementation for these components:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=lib/components/Button/Button.tsx",children:"export default function Button(props: React.ButtonHTMLAttributes<HTMLButtonElement>) {\n  return <button type='button' {...props} />;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=lib/components/Label/Label.tsx",children:"export default function Label(props: React.LabelHTMLAttributes<HTMLLabelElement>) {\n  return <label {...props} />;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally export the components from the library's main file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=lib/main.ts",children:"export { default as Button } from './components/Button';\nexport { default as Label } from './components/Label';\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you ",(0,s.jsx)(n.code,{children:"npm run build"})," again you will notice that the transpiled file ",(0,s.jsx)(n.code,{children:"my-component-library.js"})," now has ",(0,s.jsx)(n.strong,{children:"78kb"})," \ud83d\ude2e"]}),"\n",(0,s.jsxs)(n.h2,{id:"10-remove-react--reactjsx-runtime-from-the-bundle",children:["10. Remove ",(0,s.jsx)(n.code,{children:"react"})," & ",(0,s.jsx)(n.code,{children:"react/jsx-runtime"})," from the bundle"]}),"\n",(0,s.jsxs)(n.p,{children:["The implementation of the components above contains React JSX code and therefore ",(0,s.jsx)(n.code,{children:"react"})," (and ",(0,s.jsx)(n.code,{children:"react/jsx-runtime"}),") gets bundled as well. As this library will be used in projects that have React installed anyways, you can ",(0,s.jsx)(n.strong,{children:"externalize"})," this dependencies to ",(0,s.jsx)(n.em,{children:"remove the code from bundle"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"export default defineConfig({\n  // ...\n  build: {\n   // ...\n// diff-add-start\n   rollupOptions: {\n       external: ['react', 'react/jsx-runtime'],\n   },\n// diff-add-end\n  },\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Now take a look at your ",(0,s.jsx)(n.code,{children:"package.json"})," file under ",(0,s.jsx)(n.code,{children:"dependencies"})," key. Right now there should be only two there: ",(0,s.jsx)(n.code,{children:"react"})," and ",(0,s.jsx)(n.code,{children:"react-dom"})," You can move both to the ",(0,s.jsx)(n.code,{children:"devDependencies"}),". Additionally, add them as ",(0,s.jsx)(n.code,{children:"peerDependencies"}),", so that the consuming application is aware that it must have React installed to use this package."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n// diff-remove-next-line\n"dependencies": {\n  // diff-add-next-line\n"peerDependencies": {\n  "react": "^18.2.0",\n    "react-dom": "^18.2.0"\n  },\n  "devDependencies": {\n// diff-add-start\n"react": "^18.2.0",\n"react-dom": "^18.2.0",\n// diff-add-end\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"11-handle-css-files",children:"11. Handle CSS files"}),"\n",(0,s.jsxs)(n.p,{children:["This library will use ",(0,s.jsx)(n.strong,{children:"CSS modules"})," to style the components."]}),"\n",(0,s.jsxs)(n.p,{children:["CSS modules are supported by Vite by default. All you have to do is to create CSS files that end with ",(0,s.jsx)(n.code,{children:".module.css"})," (or ",(0,s.jsx)(n.code,{children:".module.scss"}),")."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2my-component-library\n  \u2523 \ud83d\udcc2lib\n  \u2503 \u2523 \ud83d\udcc2components\n  \u2503 \u2503 \u2523 \ud83d\udcc2Button\n  \u2503 \u2503 \u2503 \u2523 \ud83d\udcc2Button.tsx\n  \u2503 \u2503 \u2503 \u2523 \ud83d\udcdcindex.ts\n+ \u2503 \u2503 \u2503 \u2517 \ud83d\udcc2Button.module.scss\n  \u2503 \u2503 \u2517 \ud83d\udcc2Label\n  \u2503 \u2503   \u2523 \ud83d\udcc2Label.tsx\n  \u2503 \u2503   \u2523 \ud83d\udcdcindex.ts\n+ \u2503 \u2503   \u2517 \ud83d\udcc2Label.module.scss\n  \u2503 \u2517 \ud83d\udcdcmain.ts\n  \u2026\n"})}),"\n",(0,s.jsx)(n.p,{children:"And add some basic CSS classes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-css",metastring:"title=lib/components/Button/Button.module.scss",children:".button {\n    padding: 1rem;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-css",metastring:"title=lib/components/Label/Label.module.scss",children:".label {\n    font-weight: bold;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"And import/use them inside your components:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import styles from './Button.module.scss';\n\nexport function Button(props: React.ButtonHTMLAttributes<HTMLButtonElement>) {\n  const { className, ...restProps } = props;\n  return <button type='button' className={`${className} ${styles.button}`} {...restProps} />;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you choose to use ",(0,s.jsx)(n.code,{children:".scss"})," instead of ",(0,s.jsx)(n.code,{children:".css"})," files, you'll need ",(0,s.jsx)(n.code,{children:"sass"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D sass\n"})}),"\n",(0,s.jsx)(n.p,{children:"So now, after transpiling your library you will notice that there is a new file in your distribution folder:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2dist\n  \u2523 \u2026\n  \u2523 \ud83d\udcdcmy-component-library.js\n# diff-add-next-line\n\u2517 \ud83d\udcdcstyle.css\n"})}),"\n",(0,s.jsx)(n.p,{children:"But there are two issues with this file:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"You need to manually import the file in the consuming application."}),"\n",(0,s.jsx)(n.li,{children:"It is one big giant file that contains all styles for all components."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"CSS files just can't easily be imported in JavaScript. Therefore, the CSS file is generated separately, allowing the library user to decide how to handle the file."}),"\n",(0,s.jsx)(n.p,{children:"But what if we were to assume that the application using the library has a bundler configuration that can handle CSS imports?"}),"\n",(0,s.jsxs)(n.p,{children:["For this to work, the transpiled JavaScript bundle must contain an import statement for the CSS file. We are going to use yet another Vite plugin (",(0,s.jsx)(n.a,{href:"https://github.com/emosheeep/vite-plugin-lib-inject-css",children:"vite-plugin-lib-inject-css"}),") that does exactly what we need with zero configuration."]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"From their documentation:"})}),(0,s.jsx)(n.p,{children:'"Inject css at the top of each chunk file in library mode using import statement, support multi-entries build, especially to help building component libraries."'})]}),"\n",(0,s.jsxs)(n.p,{children:["Let's install ",(0,s.jsx)(n.code,{children:"vite-plugin-lib-inject-css"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D vite-plugin-lib-inject-css\n"})}),"\n",(0,s.jsxs)(n.p,{children:["And use it inside our ",(0,s.jsx)(n.code,{children:"vite.config.ts"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"// diff-add-next-line\nimport { libInjectCss } from 'vite-plugin-lib-inject-css';\n\nexport default defineConfig({\n  // ...\n  plugins: [\n    react(),\n// diff-add-next-line\n  libInjectCss(),\n  ],\n  // ...\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Build the library and take a look at the top of your bundled JavaScript file (",(0,s.jsx)(n.code,{children:"dist/my-component-library.js"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=dist/my-component-library.js",children:"import './main.css';\n\n// ...\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"\ud83d\udca1 You may notice that the CSS filename has changed from style.css to main.css. This change occurs because the plugin generates a separate CSS file for each chunk, and in this case the name of the chunk comes from the filename of the entry file."})}),"\n",(0,s.jsx)(n.h2,{id:"12-split-up-the-css",children:"12. Split up the CSS"}),"\n",(0,s.jsxs)(n.p,{children:["But there's still the second problem: when you import something from your library, ",(0,s.jsx)(n.code,{children:"main.css"})," is also imported and all the CSS styles end up in your application bundle. Even if you only import the ",(0,s.jsx)(n.strong,{children:"Button"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Well, good news!!! The ",(0,s.jsx)(n.code,{children:"libInjectCSS"})," plugin generates a separate CSS file for each chunk and includes an import statement at the beginning of each chunk's output file. So if you split up the JavaScript code, you'll end up having separate CSS files that only get imported when the according JavaScript files are imported."]}),"\n",(0,s.jsxs)(n.p,{children:["Best way of doing this would be to turn every file into an Rollup entry point. And there is a recommended way of doing this right in the ",(0,s.jsx)(n.a,{href:"https://rollupjs.org/configuration-options/#input",children:"Rollup documentation"}),":"]}),"\n",(0,s.jsx)(n.p,{children:"So let's add this to your configuration."}),"\n",(0,s.jsxs)(n.p,{children:["First install ",(0,s.jsx)(n.code,{children:"glob"})," as it will be required:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D glob\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then change your Vite config to this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"/* eslint-disable*/\n// diff-remove-next-line\nimport { resolve } from 'path';\n// diff-add-start\nimport { extname, relative, resolve } from 'path';\nimport { glob } from 'glob';\nimport { fileURLToPath } from 'node:url';\n// diff-add-end\n// ...\nexport default defineConfig({\n  // ...\n    rollupOptions: {\n      external: ['react', 'react/jsx-runtime'],\n// diff-add-start\n     input: Object.fromEntries(\n         glob.sync('lib/**/*.{ts,tsx}', {\n             ignore: ['lib/**/*.d.ts'],\n       }).map(file => [\n         // The name of the entry point lib/nested/foo.ts becomes nested/foo\n         relative(\n             'lib',\n           file.slice(0, file.length - extname(file).length),\n         ),\n         // The absolute path to the entry file lib/nested/foo.ts becomes /project/lib/nested/foo.ts\n         fileURLToPath(new URL(file, import.meta.url)),\n       ]),\n     ),\n// diff-add-end\n    },\n   // ...\n});\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["\ud83d\udca1 The glob library helps you to specify a set of filenames. In this case it selects all files ending with ",(0,s.jsx)(n.code,{children:".ts"})," or ",(0,s.jsx)(n.code,{children:".tsx"})," and ignores ",(0,s.jsx)(n.code,{children:"*.d.ts"})," files."]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"How to use Storybook for my library?"})}),"\n",(0,s.jsxs)(n.p,{children:["To install Storybook run ",(0,s.jsx)(n.code,{children:"npx storybook@latest init"})," and start adding your stories."]}),"\n",(0,s.jsxs)(n.p,{children:["If you add stories inside the ",(0,s.jsx)(n.code,{children:"lib"})," folder you also need to make sure to exclude all ",(0,s.jsx)(n.code,{children:".stories.tsx"})," files from the glob pattern so the stories don't end up in your bundle."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"glob.sync('lib/**/*.{ts,tsx}', {\n  // diff-remove-next-line\n  ignore: ['lib/**/*.d.ts'],\n// diff-add-next-line\n  ignore: ['lib/**/*.d.ts', 'lib/**/*.stories.tsx'],\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Now you end up with a bunch of JavaScript and CSS files in the root of your ",(0,s.jsx)(n.code,{children:"dist"})," folder. It works, but it doesn't look particularly pretty, does it?"]}),"\n",(0,s.jsxs)(n.p,{children:["That's why we'll add ",(0,s.jsx)(n.code,{children:"rollupOptions.output"})," to our config:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"export default defineConfig({\n\n  rollupOptions: {\n    // ...\n// diff-add-start\n     output: {\n       assetFileNames: 'assets/[name][extname]',\n       entryFileNames: '[name].js',\n     },\n// diff-add-end\n    },\n    // ...\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Transpile the library again and all JavaScript files should now be in the same organized folder structure you have created in ",(0,s.jsx)(n.code,{children:"lib"})," alongside with their type definitions. And the CSS files are inside a new folder called assets. \ud83d\ude4c"]}),"\n",(0,s.jsx)(n.p,{children:'Notice that the name of the main file has changed from "my-component-library.js" to "main.js". That\'s great!'}),"\n",(0,s.jsxs)(n.h2,{id:"13-update-your-packagejson-file",children:["13. Update your ",(0,s.jsx)(n.code,{children:"package.json"})," file"]}),"\n",(0,s.jsxs)(n.p,{children:["main & types should be ",(0,s.jsx)(n.code,{children:"dist/main.js"})," and ",(0,s.jsx)(n.code,{children:"dist/main.d.ts"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Your library's primary entry point is now located at ",(0,s.jsx)(n.code,{children:"dist/main.js"}),", so this needs to be set in your ",(0,s.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The same applies to the types' entry point: ",(0,s.jsx)(n.code,{children:"dist/main.d.ts"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n  "name": "my-component-library",\n  "private": true,\n  "version": "0.0.0",\n  "type": "module",\n// highlight-start\n  "main": "dist/main.js",\n  "types": "dist/main.d.ts",\n// highlight-end\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"14-add-css-to-side-effects",children:"14. Add CSS to Side effects"}),"\n",(0,s.jsx)(n.p,{children:"To prevent the CSS files from being accidentally removed by the consumer's tree-shaking efforts, you should also specify the generated CSS as side effects:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n// ...\n// diff-add-next-line\n"sideEffects": ["**/*.css"],\n// ...\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"15-use-prepublishonly-to-ensure-build-prior-to-publish",children:["15. Use ",(0,s.jsx)(n.code,{children:"prepublishOnly"})," to ensure build prior to publish"]}),"\n",(0,s.jsxs)(n.p,{children:["You can use the special lifecycle script ",(0,s.jsx)(n.code,{children:"prepublishOnly"})," to guarantee that your changes are always built before the package is published:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n  "scripts": {\n    "dev": "vite",\n    "build": "tsc && vite build",\n    // ...\n// diff-add-next-line\n  "prepublishOnly": "npm run build"\n  },\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"16-demo-page",children:"16. Demo page"}),"\n",(0,s.jsxs)(n.p,{children:["To just play around with your components on the demo page, you can simply import the components directly from the root of your project. This works because your ",(0,s.jsx)(n.code,{children:"package.json"})," points to the transpiled main file ",(0,s.jsx)(n.code,{children:"dist/main.ts"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",metastring:"title=src/App.tsx",children:"/* eslint-disable */\nimport { Button, Input, Label } from '../';\n\n// ...\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},7010:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var i=t(758);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},5493:e=>{e.exports=JSON.parse('{"permalink":"/guides/blog/vite-library-mode","editUrl":"https://github.com/talkohavy/guides/blog/2024-08-10-vite-library-mode.md","source":"@site/blog/2024-08-10-vite-library-mode.md","title":"How to Create a Component Library with Vite","description":"How to create a components library fast using Vite\'s library mode, typescript, css modules, and publish to npm.","date":"2024-08-10T00:00:00.000Z","tags":[{"inline":true,"label":"vite","permalink":"/guides/blog/tags/vite"},{"inline":true,"label":"react","permalink":"/guides/blog/tags/react"},{"inline":true,"label":"typescript","permalink":"/guides/blog/tags/typescript"},{"inline":true,"label":"tutorial","permalink":"/guides/blog/tags/tutorial"}],"readingTime":18.02,"hasTruncateMarker":true,"authors":[{"name":"Tal Kohavy","title":"Full Stack Developer","url":"https://github.com/talkohavy","imageURL":"https://github.com/talkohavy.png","key":"talkohavy","page":null}],"frontMatter":{"title":"How to Create a Component Library with Vite","description":"How to create a components library fast using Vite\'s library mode, typescript, css modules, and publish to npm.","slug":"vite-library-mode","authors":["talkohavy"],"image":"https://i.ibb.co/rGSxHmB/vite.png","tags":["vite","react","typescript","tutorial"],"hide_table_of_contents":false},"unlisted":false,"nextItem":{"title":"Welcome","permalink":"/guides/blog/welcome"}}')}}]);