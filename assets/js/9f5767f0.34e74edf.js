"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[6613],{6451:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"knowledge/csrf-attack","title":"What is a CSRF attack?","description":"CSRF initials are Cross-Site Request Forgery.","source":"@site/docs/knowledge/csrf-attack.md","sourceDirName":"knowledge","slug":"/knowledge/csrf-attack","permalink":"/guides/docs/knowledge/csrf-attack","draft":false,"unlisted":false,"editUrl":"https://github.com/talkohavy/guides/docs/knowledge/csrf-attack.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mySidebar","previous":{"title":"Knowledge Base","permalink":"/guides/docs/category/knowledge-base"},"next":{"title":"- Design Patterns","permalink":"/guides/docs/knowledge/design-patterns"}}');var i=s(5813),t=s(3546);const a={},o="What is a CSRF attack?",l={},c=[{value:"Example 1: bank transfer (Classic example)",id:"example-1-bank-transfer-classic-example",level:2},{value:"1\ufe0f\u20e3 Normal behavior",id:"1\ufe0f\u20e3-normal-behavior",level:3},{value:"2\ufe0f\u20e3 Attacker&#39;s website",id:"2\ufe0f\u20e3-attackers-website",level:3},{value:"3\ufe0f\u20e3 What happens in your browser",id:"3\ufe0f\u20e3-what-happens-in-your-browser",level:3},{value:"Why CSRF works",id:"why-csrf-works",level:2},{value:"Example 2: changing email/password (also common)",id:"example-2-changing-emailpassword-also-common",level:2},{value:"When CSRF is possible",id:"when-csrf-is-possible",level:2},{value:"How to prevent a CSRF attack?",id:"how-to-prevent-a-csrf-attack",level:2},{value:"\u2705 1. SameSite cookies",id:"-1-samesite-cookies",level:3},{value:"\u2705 2. CSRF tokens (most common)",id:"-2-csrf-tokens-most-common",level:3},{value:"\u2705 3. Check Origin / Referer headers",id:"-3-check-origin--referer-headers",level:3}];function d(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"what-is-a-csrf-attack",children:"What is a CSRF attack?"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"CSRF"})," initials are ",(0,i.jsx)(n.strong,{children:"Cross-Site Request Forgery"}),".",(0,i.jsx)(n.br,{}),"\n","It is a web security attack where a malicious website tricks a ",(0,i.jsx)(n.strong,{children:"logged-in user's browser"})," into performing an ",(0,i.jsx)(n.strong,{children:"unintended action"})," on another website ",(0,i.jsx)(n.strong,{children:"where the user is already authenticated"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.strong,{children:"weakness"})," that is being exploited is in the definition ",(0,i.jsx)(n.strong,{children:"of how browsers treat cookies"}),":"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"The browser automatically includes cookies (session/auth cookies) with requests"}),", even if the request was triggered by a different site."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"example-1-bank-transfer-classic-example",children:"Example 1: bank transfer (Classic example)"}),"\n",(0,i.jsx)(n.h3,{id:"1\ufe0f\u20e3-normal-behavior",children:"1\ufe0f\u20e3 Normal behavior"}),"\n",(0,i.jsx)(n.p,{children:"You are logged into your bank:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://bank.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"You are authenticated via a cookie:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Cookie: session=abc123\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The bank has an API endpoint called ",(0,i.jsx)(n.code,{children:"/transfer"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /transfer\namount=1000&toAccount=9876\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"2\ufe0f\u20e3-attackers-website",children:"2\ufe0f\u20e3 Attacker's website"}),"\n",(0,i.jsx)(n.p,{children:"You visit a malicious website:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://evil.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"It contains hidden HTML:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<form action="https://bank.com/transfer" method="POST">\n  <input type="hidden" name="amount" value="1000">\n  <input type="hidden" name="toAccount" value="9876">\n</form>\n\n<script>\n  document.forms[0].submit();\n<\/script>\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3\ufe0f\u20e3-what-happens-in-your-browser",children:"3\ufe0f\u20e3 What happens in your browser"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Your browser ",(0,i.jsx)(n.strong,{children:"automatically includes bank.com cookies"})]}),"\n",(0,i.jsx)(n.li,{children:"The request looks legitimate to the bank"}),"\n",(0,i.jsx)(n.li,{children:"The transfer happens"}),"\n",(0,i.jsx)(n.li,{children:"You never clicked \u201cTransfer\u201d"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\ud83d\udca5 ",(0,i.jsx)(n.strong,{children:"Attack succeeds"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"why-csrf-works",children:"Why CSRF works"}),"\n",(0,i.jsx)(n.p,{children:"CSRF works because:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Cookies are ",(0,i.jsx)(n.strong,{children:"automatically sent"})]}),"\n",(0,i.jsxs)(n.li,{children:["The server ",(0,i.jsx)(n.strong,{children:"cannot tell"})," whether:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"the request came from its own UI"}),"\n",(0,i.jsx)(n.li,{children:"or from a malicious site"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"example-2-changing-emailpassword-also-common",children:"Example 2: changing email/password (also common)"}),"\n",(0,i.jsxs)(n.p,{children:["Same idea: let's say facebook has an endpoint ",(0,i.jsx)(n.code,{children:"/change-email"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"POST /change-email\nemail=attacker@example.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"If unprotected, an attacker can:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Change your email"}),"\n",(0,i.jsx)(n.li,{children:"Reset your password"}),"\n",(0,i.jsx)(n.li,{children:"Take over your account"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"when-csrf-is-possible",children:"When CSRF is possible"}),"\n",(0,i.jsx)(n.p,{children:"CSRF attacks are possible when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Authentication uses ",(0,i.jsx)(n.strong,{children:"cookies"})," (which it often does)"]}),"\n",(0,i.jsxs)(n.li,{children:["The action has ",(0,i.jsx)(n.strong,{children:"no CSRF protection"})]}),"\n",(0,i.jsx)(n.li,{children:"The browser can send the request automatically"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-to-prevent-a-csrf-attack",children:"How to prevent a CSRF attack?"}),"\n",(0,i.jsx)(n.h3,{id:"-1-samesite-cookies",children:"\u2705 1. SameSite cookies"}),"\n",(0,i.jsxs)(n.p,{children:["The setting that allows or disallows 3rd-party websites to send cookies on your behalf, is called ",(0,i.jsx)(n.code,{children:"SameSite"}),". And the default setting for ",(0,i.jsx)(n.code,{children:"SameSite"}),' is "lax".']}),"\n",(0,i.jsx)(n.p,{children:'By simply changing the value to "Strict", you can prevent CSRF attacks.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"Set-Cookie: session=abc123; SameSite=Strict\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Browser ",(0,i.jsx)(n.strong,{children:"won't send cookies"})," on cross-site requests"]}),"\n",(0,i.jsx)(n.li,{children:"Very effective modern defense"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"-2-csrf-tokens-most-common",children:"\u2705 2. CSRF tokens (most common)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Server generates a random token"}),"\n",(0,i.jsx)(n.li,{children:"Token is embedded in forms / headers"}),"\n",(0,i.jsx)(n.li,{children:"Server verifies token on every state-changing request"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'<input type="hidden" name="csrfToken" value="random123">\n'})}),"\n",(0,i.jsx)(n.p,{children:"If the attacker doesn't know the token \u2192 request fails."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"-3-check-origin--referer-headers",children:"\u2705 3. Check Origin / Referer headers"}),"\n",(0,i.jsx)(n.p,{children:"Server verifies:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Origin: https://bank.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Less reliable, but useful as an extra layer."}),"\n",(0,i.jsxs)(n.p,{children:["They are less reliable because browsers may omit them, and servers must decide what to do then. There could be ",(0,i.jsx)(n.strong,{children:"legitimate requests"})," without ",(0,i.jsx)(n.code,{children:"referrer"}),". For example, Opening a link from bookmarks."]}),"\n",(0,i.jsxs)(n.p,{children:["Can an attacker fake these headers? \u274c From a normal browser: ",(0,i.jsx)(n.strong,{children:"NO"})]}),"\n",(0,i.jsx)(n.p,{children:"A malicious website cannot arbitrarily set or modify:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Origin"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Referrer"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Browsers forbid JavaScript from controlling these headers."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3546:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var r=s(9729);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);