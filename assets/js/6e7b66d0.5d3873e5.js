"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[6207],{1608:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>g,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"programming/javascript/finalization-registry","title":"FinalizationRegistry","description":"Description","source":"@site/docs/programming/javascript/finalization-registry.md","sourceDirName":"programming/javascript","slug":"/programming/javascript/finalization-registry","permalink":"/guides/docs/programming/javascript/finalization-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/talkohavy/guides/docs/programming/javascript/finalization-registry.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mySidebar","previous":{"title":"- valueOf","permalink":"/guides/docs/programming/javascript/valueOf"},"next":{"title":"- Micro-Frontends","permalink":"/guides/docs/programming/micro-frontends"}}');var r=t(5813),a=t(3546);const s={},o="FinalizationRegistry",l={},c=[{value:"Description",id:"description",level:2},{value:"Usage",id:"usage",level:2},{value:"Avoid where possible",id:"avoid-where-possible",level:2}];function d(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"finalizationregistry",children:"FinalizationRegistry"})}),"\n",(0,r.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,r.jsxs)(n.p,{children:["A ",(0,r.jsx)(n.code,{children:"FinalizationRegistry"})," object lets you set a callback when a value is garbage-collected."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"FinalizationRegistry"})," provides a way to request that a ",(0,r.jsx)(n.em,{children:"cleanup callback"})," get called at some point when a value registered with the registry has been reclaimed (garbage-collected). (Cleanup callbacks are sometimes called ",(0,r.jsx)(n.em,{children:"finalizers"}),".)"]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"Note: Cleanup callbacks should not be used for essential program logic."})}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.p,{children:"You create the registry passing in the callback:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const registry = new FinalizationRegistry((heldValue) => {\n  // \u2026\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then you register any value you want a cleanup callback for by calling the register method, passing in the value and a held value for it:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'registry.register(target, "some value");\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The registry does not keep a strong reference to the value, as that would defeat the purpose (if the registry held it strongly, the value would never be reclaimed). In JavaScript, objects and non-registered symbols are garbage collectable, so they can be registered in a ",(0,r.jsx)(n.code,{children:"FinalizationRegistry"})," object as the target or the token."]}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"target"}),' is reclaimed, your cleanup callback may be called at some point with the held value you provided for it ("some value" in the above). The held value can be any value you like: a primitive or an object, even ',(0,r.jsx)(n.code,{children:"undefined"}),". If the held value is an object, the registry keeps a strong reference to it (so it can pass it to your cleanup callback later)."]}),"\n",(0,r.jsxs)(n.p,{children:["If you might want to unregister a registered target value later, you pass a third value, which is the ",(0,r.jsx)(n.em,{children:"unregistration token"})," you'll use later when calling the registry's ",(0,r.jsx)(n.code,{children:"unregister"})," function to unregister the value. The registry only keeps a weak reference to the unregister token."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'registry.register(target, "some value", target);\n// \u2026\n\n// some time later, if you don\'t care about `target` anymore, unregister it\nregistry.unregister(target);\n'})}),"\n",(0,r.jsx)(n.p,{children:"It doesn't have to be the same value, though; it can be a different one:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'registry.register(target, "some value", token);\n// \u2026\n\n// some time later\nregistry.unregister(token);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"avoid-where-possible",children:"Avoid where possible"}),"\n",(0,r.jsxs)(n.p,{children:["Correct use of ",(0,r.jsx)(n.code,{children:"FinalizationRegistry"})," takes careful thought, and it's best avoided if possible. It's also important to avoid relying on any specific behaviors not guaranteed by the specification. When, how, and whether garbage collection occurs is down to the implementation of any given JavaScript engine. Any behavior you observe in one engine may be different in another engine, in another version of the same engine, or even in a slightly different situation with the same version of the same engine. Garbage collection is a hard problem that JavaScript engine implementers are constantly refining and improving their solutions to."]}),"\n",(0,r.jsx)(n.p,{children:"Developers shouldn't rely on cleanup callbacks for essential program logic. Cleanup callbacks may be useful for reducing memory usage across the course of a program, but are unlikely to be useful otherwise."})]})}function g(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},3546:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(9729);const r={},a=i.createContext(r);function s(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);