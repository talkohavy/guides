"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[5982],{7968:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var s=i(1527),r=i(7252);const o={sidebar_label:"9. Docker",sidebar_position:7},l="Guide For Docker",c={id:"programming/docker",title:"Guide For Docker",description:"1. Overall Project Workflow Process",source:"@site/docs/programming/docker.md",sourceDirName:"programming",slug:"/programming/docker",permalink:"/guides/docs/programming/docker",draft:!1,unlisted:!1,editUrl:"https://github.com/talkohavy/guides/docs/programming/docker.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_label:"9. Docker",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"8. Storybook",permalink:"/guides/docs/programming/storybook"},next:{title:"10. Kubernetes",permalink:"/guides/docs/programming/kubernetes"}},a={},d=[{value:"1. Overall Project Workflow Process",id:"1-overall-project-workflow-process",level:2},{value:"- 1.1. Have a project ready",id:"--11-have-a-project-ready",level:3},{value:"- 1.2. Create a Dockerfile",id:"--12-create-a-dockerfile",level:3},{value:"- 1.3. build the image with docker-compose/docker build",id:"--13-build-the-image-with-docker-composedocker-build",level:3},{value:"- 1.4. Uploading the image to a registry",id:"--14-uploading-the-image-to-a-registry",level:3},{value:"- 1.5. Download and Run the image",id:"--15-download-and-run-the-image",level:3},{value:"2. Daily Use Workflow Process",id:"2-daily-use-workflow-process",level:2},{value:"\u2022 A: List all docker images on your machine",id:"-a-list-all-docker-images-on-your-machine",level:3},{value:"\u2022 B: Delete an image",id:"-b-delete-an-image",level:3},{value:"\u2022 C: List all containers",id:"-c-list-all-containers",level:3},{value:"\u2022 D: Delete a container",id:"-d-delete-a-container",level:3},{value:"\u2022 E: Run an image/container locally",id:"-e-run-an-imagecontainer-locally",level:3},{value:"\u2022 F: How do I debug a running container?",id:"-f-how-do-i-debug-a-running-container",level:3},{value:"\u2022 G: How do I expose a container to my localhost? (Port mapping)",id:"-g-how-do-i-expose-a-container-to-my-localhost-port-mapping",level:3},{value:"3. Docker Commands",id:"3-docker-commands",level:2},{value:"\u2022 Command 1: docker system prune",id:"-command-1-docker-system-prune",level:3},{value:"\u2022 Command 2: docker pull",id:"-command-2-docker-pull",level:3},{value:"\u2022 Command 3: docker build",id:"-command-3-docker-build",level:3},{value:"\u2022 Command 4: docker create",id:"-command-4-docker-create",level:3},{value:"\u2022 Command 5: docker run",id:"-command-5-docker-run",level:3},{value:"\u2022 Command 6: docker start / restart",id:"-command-6-docker-start--restart",level:3},{value:"\u2022 Command 7: docker stop / kill",id:"-command-7-docker-stop--kill",level:3},{value:"\u2022 Command 8: docker images",id:"-command-8-docker-images",level:3},{value:"\u2022 Command 9: docker ps",id:"-command-9-docker-ps",level:3},{value:"\u2022 Command 10: docker container rm",id:"-command-10-docker-container-rm",level:3},{value:"\u2022 Command 11: docker image rm",id:"-command-11-docker-image-rm",level:3},{value:"\u2022 Command 12: docker logs",id:"-command-12-docker-logs",level:3},{value:"\u2022 Command 13: exec - debugging",id:"-command-13-exec---debugging",level:3},{value:"4. How to create a Dockerfile",id:"4-how-to-create-a-dockerfile",level:2},{value:"\u2022 Instruction 1: FROM",id:"-instruction-1-from",level:3},{value:"\u2022 Instruction 2: ARG",id:"-instruction-2-arg",level:3},{value:"\u2022 Instruction 3: WORKDIR",id:"-instruction-3-workdir",level:3},{value:"\u2022 Instruction 4: COPY",id:"-instruction-4-copy",level:3},{value:"\u2022 Instruction 5: RUN",id:"-instruction-5-run",level:3},{value:"\u2022 Instruction 6: ENTRYPOINT",id:"-instruction-6-entrypoint",level:3},{value:"\u2022 Instruction 7: CMD",id:"-instruction-7-cmd",level:3},{value:"\u2022 Instruction 8: EXPOSE",id:"-instruction-8-expose",level:3},{value:"5. Docker-Compose commands",id:"5-docker-compose-commands",level:2},{value:"\u2022 Command 1: docker-compose build",id:"-command-1-docker-compose-build",level:3},{value:"\u2022 Command 2: docker-compose up",id:"-command-2-docker-compose-up",level:3},{value:"\u2022 Command 3: docker-compose down",id:"-command-3-docker-compose-down",level:3},{value:"\u2022 Command 4: docker-compose ps",id:"-command-4-docker-compose-ps",level:3},{value:"6. Docker-Compose file",id:"6-docker-compose-file",level:2},{value:"\u2022 Rule 1: services",id:"-rule-1-services",level:3},{value:"\u2022 Rule 2: services.image",id:"-rule-2-servicesimage",level:3},{value:"\u2022 Rule 3: services.build",id:"-rule-3-servicesbuild",level:3},{value:"\u2022 Rule 4: services.build.context (REQUIRED)",id:"-rule-4-servicesbuildcontext-required",level:3},{value:"\u2022 Rule 5: services.build.dockerfile",id:"-rule-5-servicesbuilddockerfile",level:3},{value:"\u2022 Rule 6: services.build.dockerfile_inline",id:"-rule-6-servicesbuilddockerfile_inline",level:3},{value:"\u2022 Rule 7: services.build.args",id:"-rule-7-servicesbuildargs",level:3},{value:"\u2022 Rule 8: services.build.privileged",id:"-rule-8-servicesbuildprivileged",level:3},{value:"\u2022 Rule 9: services.build.labels",id:"-rule-9-servicesbuildlabels",level:3},{value:"\u2022 Rule 10: services.build.no_cache",id:"-rule-10-servicesbuildno_cache",level:3},{value:"\u2022 Rule 11: services.build.pull",id:"-rule-11-servicesbuildpull",level:3},{value:"\u2022 Rule 12: services.build.shm_size",id:"-rule-12-servicesbuildshm_size",level:3},{value:"\u2022 Rule 13: services.build.secrets",id:"-rule-13-servicesbuildsecrets",level:3},{value:"\u2022 Rule 14: services.build.tags",id:"-rule-14-servicesbuildtags",level:3},{value:"\u2022 Rule 15: services.env_file",id:"-rule-15-servicesenv_file",level:3}];function t(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"guide-for-docker",children:"Guide For Docker"}),"\n",(0,s.jsx)(n.h2,{id:"1-overall-project-workflow-process",children:"1. Overall Project Workflow Process"}),"\n",(0,s.jsx)(n.h3,{id:"--11-have-a-project-ready",children:"- 1.1. Have a project ready"}),"\n",(0,s.jsx)(n.p,{children:"The first step would be to have a project ready to be deployed to production."}),"\n",(0,s.jsx)(n.h3,{id:"--12-create-a-dockerfile",children:"- 1.2. Create a Dockerfile"}),"\n",(0,s.jsxs)(n.p,{children:["Then, you would need to create a ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," for that project.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," instructs ",(0,s.jsx)(n.code,{children:"docker"})," how to build the image.",(0,s.jsx)(n.br,{}),"\n",'The image that\'s going be built, would then turn into a "virtual machine" (a container), with a certain folder structure.',(0,s.jsx)(n.br,{}),"\n","Within the ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," we instruct docker where to copy and what to copy to our ",(0,s.jsx)(n.em,{children:"to-be-created"})," virtual machine.",(0,s.jsx)(n.br,{}),"\n","The creation of the ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," is a one-time thing. Once you have one, it should n't change often, or even at all."]}),"\n",(0,s.jsx)(n.h3,{id:"--13-build-the-image-with-docker-composedocker-build",children:"- 1.3. build the image with docker-compose/docker build"}),"\n",(0,s.jsxs)(n.p,{children:["Any time the contents of your project changes, you need to build an image.\nWhether you do it with ",(0,s.jsx)(n.code,{children:"docker-compose"})," or with ",(0,s.jsx)(n.code,{children:"docker build"})," doesn't quite matter for your specific use-case, and here's why; Let's examine the differences between them."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"The main differences between them are:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"docker build"})," can only build a ",(0,s.jsx)(n.em,{children:"single"})," image, while ",(0,s.jsx)(n.code,{children:"docker-compose build"})," can build ",(0,s.jsx)(n.em,{children:"multiple"})," images."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"docker build"})," requires a ",(0,s.jsx)(n.strong,{children:"Dockerfile"}),", while ",(0,s.jsx)(n.code,{children:"docker-compose build"})," requires both a ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," and a ",(0,s.jsx)(n.strong,{children:"docker-compose.yaml"})," file."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"docker build"})," is more flexible, as you can use it to build any type of image, while ",(0,s.jsx)(n.code,{children:"docker-compose build"})," is designed for building multi-container applications."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"docker-compose build"})," is easier to use, as it takes care of all the details of building and running multiple containers."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["The benefits of using ",(0,s.jsx)(n.code,{children:"docker-compose"})," include:"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ease of use"}),": ",(0,s.jsx)(n.code,{children:"docker-compose"})," makes it easy to build and run multi-container applications. You can define all the services in your application in a single\ndocker-compose.yaml file, and then use the ",(0,s.jsx)(n.code,{children:"docker-compose up"})," command to start them all up."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flexibility"}),": ",(0,s.jsx)(n.code,{children:"docker-compose"})," is flexible enough to be used with a variety of different applications. You can use it to build simple applications with a few\ncontainers, or complex applications with dozens or even hundreds of containers."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Scalability"}),": ",(0,s.jsx)(n.code,{children:"docker-compose"})," makes it easy to scale your applications. You can start with a small number of containers, and then scale up your application by\nadding more containers as needed."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"--14-uploading-the-image-to-a-registry",children:"- 1.4. Uploading the image to a registry"}),"\n",(0,s.jsx)(n.p,{children:"** complete this part... **"}),"\n",(0,s.jsx)(n.h3,{id:"--15-download-and-run-the-image",children:"- 1.5. Download and Run the image"}),"\n",(0,s.jsxs)(n.p,{children:["After having a ready image, you'll want to have it running, right?",(0,s.jsx)(n.br,{}),"\n","In production, you'll probably use ",(0,s.jsx)(n.strong,{children:"kubernetes"})," as an orchestrating mechanism to running all the images together in a contained environment called a ",(0,s.jsx)(n.strong,{children:"cluster"}),".",(0,s.jsx)(n.br,{}),"\n","In development, you might also want to use ",(0,s.jsx)(n.strong,{children:"kubernetes"})," as well, but it's more likely that you'd want to run a single image, and make sure it works properly as a standalone.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"docker run"})," is for running a single image, for creating a single running container from that image, making sure it runs ok, connecting to it, run commands on it, etc.",(0,s.jsx)(n.br,{}),"\n","While you mostly be using ",(0,s.jsx)(n.code,{children:"docker run"})," for debugging purposes, know that ",(0,s.jsx)(n.code,{children:"kubernetes"})," also offers its own way of debugging. ",(0,s.jsx)(n.code,{children:"Kubernetes"})," allows you to debug any container living inside of a cluster.",(0,s.jsx)(n.br,{}),"\n","Well, technically, it's a way of debugging a container living inside of a pod, living inside of a deployment, living inside of a node, living inside of a cluster, but you get the idea.",(0,s.jsx)(n.br,{}),"\n","The only time in which ",(0,s.jsx)(n.code,{children:"docker run"})," is the better solution, is when you ",(0,s.jsx)(n.em,{children:"couldn't"})," get your deployment to initialize correctly, so there aren't any running pods to check.",(0,s.jsx)(n.br,{}),"\n","Using ",(0,s.jsx)(n.code,{children:"kubectl apply"})," on a kubernetes configuration yaml file, you could start/orchestrate several deployments."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using kubernetes"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f config\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using docker"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run ...\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-daily-use-workflow-process",children:"2. Daily Use Workflow Process"}),"\n",(0,s.jsx)(n.h3,{id:"-a-list-all-docker-images-on-your-machine",children:"\u2022 A: List all docker images on your machine"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker images\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-b-delete-an-image",children:"\u2022 B: Delete an image"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"IMAGE_ID=\ndocker image rm ${IMAGE_ID} -f\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-c-list-all-containers",children:"\u2022 C: List all containers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker ps -a\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-d-delete-a-container",children:"\u2022 D: Delete a container"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"CONTAINER_ID=\ndocker container rm ${CONTAINER_ID}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-e-run-an-imagecontainer-locally",children:"\u2022 E: Run an image/container locally"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -it --rm node sh\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-f-how-do-i-debug-a-running-container",children:"\u2022 F: How do I debug a running container?"}),"\n",(0,s.jsx)(n.p,{children:"Watching a running container's log just might be enough:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker logs <name-or-image-id>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["But if it's not, and you need to tap into an already running container, docker allows you access in a manner similar to SSH, using ",(0,s.jsx)(n.code,{children:"docker exec"})," command which was made for this purpose exactly."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker exec -it <container_name_or_id> bash\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-g-how-do-i-expose-a-container-to-my-localhost-port-mapping",children:"\u2022 G: How do I expose a container to my localhost? (Port mapping)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run redis -p 5678:5678\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-docker-commands",children:"3. Docker Commands"}),"\n",(0,s.jsx)("font",{size:6,children:"Table of contents"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-1-docker-system-prune",children:"\u2022 Command 1: docker system prune"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-2-docker-pull",children:"\u2022 Command 2: docker pull"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-3-docker-build",children:"\u2022 Command 3: docker build"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-4-docker-create",children:"\u2022 Command 4: docker create"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-5-docker-run",children:"\u2022 Command 5: docker run"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-6-docker-start--restart",children:"\u2022 Command 6: docker start / restart"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-7-docker-stop--kill",children:"\u2022 Command 7: docker stop / kill"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-8-docker-images",children:"\u2022 Command 8: docker images"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-9-docker-ps",children:"\u2022 Command 9: docker ps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-10-docker-container-rm",children:"\u2022 Command 10: docker container rm"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-11-docker-image-rm",children:"\u2022 Command 11: docker image rm"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-12-docker-logs",children:"\u2022 Command 12: docker logs"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#-command-13-exec---debugging",children:"\u2022 Command 13: exec - debugging"})}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-1-docker-system-prune",children:"\u2022 Command 1: docker system prune"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker pull [OPTIONS] NAME[:TAG|@DIGEST]\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["Remove all unused containers, networks, images (both ",(0,s.jsx)(n.em,{children:"dangling"})," and ",(0,s.jsx)(n.em,{children:"unreferenced"}),"), and optionally, volumes."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-2-docker-pull",children:"\u2022 Command 2: docker pull"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker pull [OPTIONS] <image-name>[:TAG|@DIGEST]\n"})}),"\n",(0,s.jsx)(n.p,{children:"Download an image from a registry."}),"\n",(0,s.jsxs)(n.p,{children:["If no tag is provided after the image-name, Docker Engine uses the ",":latest"," tag as a default."]}),"\n",(0,s.jsxs)(n.p,{children:["By default, ",(0,s.jsx)(n.code,{children:"docker pull"})," tries to pull an image from the website ",(0,s.jsx)(n.code,{children:"hub.docker.com"}),", also known as ",(0,s.jsx)(n.strong,{children:"Docker Hub"})," - the biggest docker image registry out there. All the images you'll ever create are a 100% images which were built on top of a ",(0,s.jsx)(n.em,{children:"base image"})," pulled from ",(0,s.jsx)(n.strong,{children:"Docker Hub"})," registry. Docker Hub contains many pre-built images that you can pull and try without needing to define and configure your own."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pull from a different registry"})}),"\n",(0,s.jsxs)(n.p,{children:["By default, docker pull pulls images from ",(0,s.jsx)(n.strong,{children:"Docker Hub"}),".",(0,s.jsx)(n.br,{}),"\n","It is also possible to manually specify the path of a registry to pull from. For example, if you have set up a local registry, you can specify its path to pull from it. A registry path is similar to a URL, but does not contain a protocol specifier (https://)."]}),"\n",(0,s.jsxs)(n.p,{children:["The following command pulls the ",(0,s.jsx)(n.code,{children:"testing/test-image"})," image from a local registry listening on port 5000 (myregistry.local:5000):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker image pull myregistry.local:5000/testing/test-image\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Concurrent downloads:"})}),"\n",(0,s.jsxs)(n.p,{children:["By default the Docker daemon will pull three layers of an image at a time. If you are on a low bandwidth connection this may cause timeout issues and you may want to lower this via the ",(0,s.jsx)(n.code,{children:"--max-concurrent-downloads"})," flag."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-3-docker-build",children:"\u2022 Command 3: docker build"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build .\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["A command to tell docker to build an image from a ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Dockerfile"})}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Usually, you will not be using this command of ",(0,s.jsx)(n.code,{children:"docker build"}),", since you'll be using it's brother ",(0,s.jsx)(n.code,{children:"docker-compose build"}),"."]})}),"\n",(0,s.jsxs)(n.p,{children:["By default, the ",(0,s.jsx)(n.code,{children:"docker build"})," command will look for a ",(0,s.jsx)(n.strong,{children:"Dockerfile"}),' at the directory at which the command was executed. The "." notatio is telling docker where to look for a ',(0,s.jsx)(n.strong,{children:"Dockerfile"}),". ",(0,s.jsx)(n.code,{children:"docker build"}),' requires at least 1 flag, or just a PATH (i.e. "."), in order to be used.',(0,s.jsx)(n.br,{}),"\n","Note that in the ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," there must be a ",(0,s.jsx)(n.strong,{children:"FROM"})," instruction which tells docker what is the ",(0,s.jsx)(n.em,{children:"base image"})," to be used. By default, docker will try to first pull the image from your local cache, and if not found there, it'll look for it on a remote registry."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used flags:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 1: -t"}),(0,s.jsx)(n.br,{}),"\n","You can use the ",(0,s.jsx)(n.code,{children:"-t"}),' flag to name, and optionally tag, an image. The most commonly used format is: "name',":tag",'".']}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 2: -f"}),(0,s.jsx)(n.br,{}),"\n","By default, ",(0,s.jsx)(n.code,{children:"docker build"})," looks for a file named exactly as ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," in the directory where the command was executed. You can override this behavior and use the ",(0,s.jsx)(n.code,{children:"-f"})," flag (or ",(0,s.jsx)(n.code,{children:"--file"}),") followed by a PATH to a custom named ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," found on a potentially different path."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 3: --no-cache"}),(0,s.jsx)(n.br,{}),"\n","By default, ",(0,s.jsx)(n.code,{children:"docker build"})," uses cache, and sometimes, you may encounter some weird issues caused due to it. The ",(0,s.jsx)(n.code,{children:"--no-cache"})," flag prevents caching when building the image."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 4: --pull | --pull=never"}),(0,s.jsx)(n.br,{}),"\n","By default, ",(0,s.jsx)(n.code,{children:"docker build"})," first looks up your local cache of image registry, and if it can't find an image there, it goes looking for it in a remote registry.",(0,s.jsx)(n.br,{}),"\n","With the ",(0,s.jsx)(n.code,{children:"--pull"})," flag set on, ",(0,s.jsx)(n.code,{children:"docker build"})," will ",(0,s.jsx)(n.strong,{children:"always"})," attempt to pull a newer version of the image found on the remote, and ignore what's on your local registry.",(0,s.jsx)(n.br,{}),"\n","With the ",(0,s.jsx)(n.code,{children:"--pull=never"})," flag set on, ",(0,s.jsx)(n.code,{children:"docker build"})," will ",(0,s.jsx)(n.strong,{children:"never"})," attempt pulling from a remote registry, and so if an image was not found locally, it would throw an error."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-4-docker-create",children:"\u2022 Command 4: docker create"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker create [OPTIONS] IMAGE [COMMAND] [ARG...]\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"docker create"})," command creates a new container from the specified image, without starting it."]}),"\n",(0,s.jsxs)(n.p,{children:["When creating a container, the docker daemon creates a writeable container layer over the specified image and prepares it for running the specified command. The container ID is then printed to STDOUT. This is similar to ",(0,s.jsx)(n.code,{children:"docker run -d"})," command, except the container is never started. You can then use the ",(0,s.jsx)(n.code,{children:"docker start"})," command to start the container at any point."]}),"\n",(0,s.jsxs)(n.p,{children:["This is useful when you want to set up a container configuration ahead of time so that it is ready to start when you need it. The initial status of the new container is ",(0,s.jsx)(n.code,{children:"created"}),"."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-5-docker-run",children:"\u2022 Command 5: docker run"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"Run a process in an isolated container."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Usually, you will not be ",(0,s.jsx)(n.code,{children:"docker run"}),", since you'll be using kubernetes to orchestrate your containers."]})})}),"\n",(0,s.jsxs)(n.p,{children:["Conceptually speaking, the ",(0,s.jsx)(n.code,{children:"docker run"})," command is actually made up of 3 separate commands running sequentially:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"docker pull"})," is used to pulling an image from a remote registry."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"docker create"})," is used to create a container out of an image."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"docker start"})," is used to start running an existing container."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"docker run"})," command ",(0,s.jsx)(n.strong,{children:"MUST"})," specify an IMAGE to derive the container from.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"docker run"})," command has the ability to override any of the rules set up within the configuration file, which is why it has the most flags, more option flags than any other docker command."]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["NOTE: To avoid having to use sudo with the docker command, your system administrator can create a Unix group called ",(0,s.jsx)(n.code,{children:"docker"})," and add users to it.\nAdd this command to your ",(0,s.jsx)(n.code,{children:"Dockerfile"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"RUN addgroup app && adduser -S -G app app\n"})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used flags:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"A sub-command: %alternative-startup-command%"}),(0,s.jsx)(n.br,{}),"\n","Right after the ",(0,s.jsx)(n.code,{children:"docker run"})," command you can specify an alternative startup command to execute, one that would override the startup command listed in the Dockerfile under the CMD key. Here's an example for how CMD looks like in a Dockerfile:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'CMD [ "pnpm", "run", "start-users" ]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["When using an alternative run, the command listed under CMD would be rendered null, and your command would run instead.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run redis echo hello world\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 1: -d"}),(0,s.jsx)(n.br,{}),"\n","Run in detached mode. Meaning, it would not occupy a terminal, keeping it busy, and printing logs onto it. The container would run in the background.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -d redis\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 2: --name"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Recommended!"})," Defining a name can be a handy way to add meaning to a container. Let's make an important distinction right now. When using ",(0,s.jsx)(n.code,{children:"docker run"})," you give the ",(0,s.jsx)(n.em,{children:"name of the image to run"}),". The ",(0,s.jsx)(n.code,{children:"--name"})," flag is for giving a ",(0,s.jsx)(n.em,{children:"name to the outcome running container"})," a name, so that later you could identify that running container.\nExample:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run <my-image-name> --name <my-container-name>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["Flag 3: [",":tag","]"]}),(0,s.jsx)(n.br,{}),"\n","You can specify a version of an image you'd like to run the container with by adding image[",":tag","] to the command.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run ubuntu:14.04\n"})}),"\n",(0,s.jsx)(n.p,{children:'By NOT specifying a tag, the command always tries to pull, build, and run the "latest" version of the image.'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 4: --rm"}),(0,s.jsx)(n.br,{}),"\n","By default a container's file system persists even after the container exits. This makes debugging a lot easier (since you can inspect the final state) and you retain all your data by default. But if you are running short-term foreground processes, these container file systems can really pile up. If instead you'd like ",(0,s.jsx)(n.strong,{children:"docker"})," to automatically clean up the container and remove the file system when the container exits, you can add the ",(0,s.jsx)(n.code,{children:"--rm"})," flag.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm <image-name>\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 5: -it"}),(0,s.jsx)(n.br,{}),"\n","For interactive processes (like a shell), you must use ",(0,s.jsx)(n.code,{children:"-i"})," ",(0,s.jsx)(n.code,{children:"-t"})," together in order to allocate a tty for the container process. ",(0,s.jsx)(n.code,{children:"-i"})," ",(0,s.jsx)(n.code,{children:"-t"})," is often written ",(0,s.jsx)(n.code,{children:"-it"})," as you'll see in later examples. Specifying ",(0,s.jsx)(n.code,{children:"-t"})," is forbidden when the client is receiving its standard input from a pipe, as in ",(0,s.jsx)(n.code,{children:"echo test | docker run -i busybox cat"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -it users-service\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 6: -p"}),(0,s.jsx)(n.br,{}),"\n","To expose a ",(0,s.jsx)(n.em,{children:"port"})," within the container to a port on your localhost.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run redis -p 5678:5678\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 7: --pull | --pull=never"}),(0,s.jsx)(n.br,{}),"\n","With the ",(0,s.jsx)(n.code,{children:"--pull"})," flag set on, ",(0,s.jsx)(n.code,{children:"docker run"})," will ",(0,s.jsx)(n.strong,{children:"always"})," attempt to pull a newer version of the image found on the remote, and ignore what's on your image-cache (local registry).",(0,s.jsx)(n.br,{}),"\n","With the ",(0,s.jsx)(n.code,{children:"--pull=never"})," flag set on, ",(0,s.jsx)(n.code,{children:"docker build"})," will ",(0,s.jsx)(n.strong,{children:"never"})," attempt pulling from a remote registry, and so if an image was not found locally, it would throw an error.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run redis --pull=never\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-6-docker-start--restart",children:"\u2022 Command 6: docker start / restart"}),"\n",(0,s.jsx)(n.p,{children:"Start a single stopped existing container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker start <container-name-or-id>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Restart a single running/stopped existing container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker restart <container-name-or-id>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"docker start"})," command is meant for starting an existing stopped container.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"docker restart"})," command is meant for restarting ",(0,s.jsx)(n.em,{children:"an existing already running container"})," OR ",(0,s.jsx)(n.em,{children:"an existing yet stopped container"}),"."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-7-docker-stop--kill",children:"\u2022 Command 7: docker stop / kill"}),"\n",(0,s.jsx)(n.p,{children:"Stop a single running container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker stop <container-name-or-id>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Stop 2+ running containers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker stop <container-name-or-id1> <container-name-or-id2>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Stop ALL running containers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker stop $(docker ps -a -q)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Kill a single running container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker kill <container-name-or-id>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"Meant for stopping an existing, currently running, container."}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"docker stop"})," command sends a ",(0,s.jsx)(n.code,{children:"SIGTERM"}),", which is short for terminate signal, to the primary process inside our container. ",(0,s.jsx)(n.code,{children:"SIGTERM"})," gives the running process some grace time to do its thing so it would be able to shut down gracefully, perhaps do some cleans ups, save some files, emit some messages, etc. After that grace period of time, ",(0,s.jsx)(n.code,{children:"docker stop"})," sends a ",(0,s.jsx)(n.code,{children:"SIGKILL"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"On the other hand..."}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"docker kill"})," command is also meant for an existing, currently running, container, however it sends a ",(0,s.jsx)(n.code,{children:"SIGKILL"}),", which is short for ",(0,s.jsx)(n.code,{children:"kill"})," signal, to the primary process inside our container. ",(0,s.jsx)(n.code,{children:"SIGKILL"})," essentially means ",(0,s.jsx)(n.em,{children:'"You have to shut down RIGHT NOW!'})," And you ",(0,s.jsx)(n.em,{children:"DO NOT"}),' get to do any additional work!".',(0,s.jsx)(n.br,{}),"\n","Ideally, we always stop a container using the ",(0,s.jsx)(n.code,{children:"docker stop"})," command."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-8-docker-images",children:"\u2022 Command 8: docker images"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker images\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"Lists all images found locally in you image-cache registry."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["If you want to list out all ",(0,s.jsx)(n.em,{children:"running containers"})," (not images), see ",(0,s.jsx)(n.code,{children:"docker ps"})," command."]})}),"\n",(0,s.jsxs)(n.p,{children:["An image will be listed more than once if it has multiple ",(0,s.jsx)(n.em,{children:"repository names"})," or ",(0,s.jsx)(n.em,{children:"tags"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used flags & options:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"option 1: image-name"}),(0,s.jsx)(n.br,{}),"\n","You can list images by their ",(0,s.jsx)(n.strong,{children:"name"}),", mentioned under the ",(0,s.jsx)(n.code,{children:"REPOSITORY"})," column. The returned result would include images who's name is an ",(0,s.jsx)(n.em,{children:"exact match"})," to the name provided.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker images redis\n"})}),"\n",(0,s.jsx)(n.p,{children:'In the above example, if two images exist with names "redis" & "redis-server", only "redis" would return as a result.'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:'Flag 1: --filter "before=image1" "since=image1"'}),(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"before"})," filter is telling docker to show only images created ",(0,s.jsx)(n.em,{children:"before"})," the image with given id or reference. ",(0,s.jsx)(n.code,{children:"since"})," does the exact opposite.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker images redis --filter "before=<image-id>"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-9-docker-ps",children:"\u2022 Command 9: docker ps"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker ps\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"Lists out containers on your machine."}),"\n",(0,s.jsxs)(n.p,{children:["By default, it lists out ",(0,s.jsx)(n.em,{children:"running containers only"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used options:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 1: -a | --all"}),(0,s.jsx)(n.br,{}),"\n","You can add the ",(0,s.jsx)(n.code,{children:"-a"})," flag to list all containers, and not just the running containers."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker ps -a\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 2: -f | --filter"}),(0,s.jsx)(n.br,{}),"\n","Examples:",(0,s.jsx)(n.br,{}),"\n","filter using ",(0,s.jsx)(n.code,{children:"status"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker ps --filter "status=exited" --filter "status=dead"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Possible ",(0,s.jsx)(n.code,{children:"status"}),"'es are: created | restarting | running | removing | paused | exited | dead."]}),"\n",(0,s.jsxs)(n.p,{children:["filter using ",(0,s.jsx)(n.code,{children:"name"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker ps --filter "name=some-name"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["filter using ",(0,s.jsx)(n.code,{children:"label"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker ps --filter "label=some-label"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-10-docker-container-rm",children:"\u2022 Command 10: docker container rm"}),"\n",(0,s.jsx)(n.p,{children:"Delete a SINGLE container: (or two)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker container rm %cntnr-name1/id1% %cntnr-name1/id2%\n"})}),"\n",(0,s.jsx)(n.p,{children:"Delete ALL containers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker container rm -f $(docker ps -aq)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["Delete a ",(0,s.jsx)(n.em,{children:"stopped"})," container."]}),"\n",(0,s.jsxs)(n.p,{children:["If you try to delete a running container, you'll get an error saying you can't delete a running container. So you have 2 options in this scenario. Either stop the container first, and then delete it, or just add a ",(0,s.jsx)(n.code,{children:"-f"})," (force) flag to your delete command.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"$(docker ps -aq)"})," part lists out the ids of all the containers, both ",(0,s.jsx)(n.em,{children:"running"})," and ",(0,s.jsx)(n.em,{children:"not running"}),"."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-11-docker-image-rm",children:"\u2022 Command 11: docker image rm"}),"\n",(0,s.jsx)(n.p,{children:"Delete a SINGLE image:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"TAG_ID=\ndocker image rm ${TAG_ID} -f\n"})}),"\n",(0,s.jsx)(n.p,{children:"Delete a 2+ images:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker image rm <name/id-of-image1> <name/id-of-image2> ...\n"})}),"\n",(0,s.jsx)(n.p,{children:"Delete ALL images:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker image rm -f $(docker image ls -q)\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"Delete an image."}),"\n",(0,s.jsxs)(n.p,{children:["If you try to delete an image, which currently has a container made from it that exists (either running or not running), you'll get an error. In this scenario you have 2 options: You can stop the running container, delete the container, and then delete the image, or you can simply add a ",(0,s.jsx)(n.code,{children:"-f"})," (force) flag to the delete command. This ",(0,s.jsx)(n.code,{children:"force"})," flag will first stop the running container, delete it, and then delete the image.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"$(docker image ls -q)"})," part lists out the ids of all images on your machine."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-12-docker-logs",children:"\u2022 Command 12: docker logs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker logs <name-or-image-id>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["Shows the logs of a ",(0,s.jsx)(n.em,{children:"running"})," container."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used options:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 1: -n | --tail"}),(0,s.jsx)(n.br,{}),"\n","Number of lines to show from the end of the logs."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker logs --tail 50\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 2: -f | --follow"}),(0,s.jsx)(n.br,{}),"\n","Follow log output."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker logs --tail 50 --follow\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 3: --since & --until"}),(0,s.jsx)(n.br,{}),"\n","Show logs since and/or until timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m for 42 minutes)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker logs -f --until=2s test\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.h3,{id:"-command-13-exec---debugging",children:"\u2022 Command 13: exec - debugging"}),"\n",(0,s.jsx)(n.p,{children:"General form:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"TAG_NAME=\ndocker exec -it ${CONTAINER_ID} %COMMAND%\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Most commonly used with ",(0,s.jsx)(n.code,{children:"sh"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker exec -it ${TAG_NAME} sh\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["We can use the ",(0,s.jsx)(n.code,{children:"exec"})," command to execute an additional command inside of a running container."]}),"\n",(0,s.jsxs)(n.p,{children:["The two most important flags of docker are: ",(0,s.jsx)(n.code,{children:"-i"})," ",(0,s.jsx)(n.code,{children:"-t"}),".",(0,s.jsx)(n.br,{}),"\n","You might see them in the combined form of: ",(0,s.jsx)(n.code,{children:"-it"}),".",(0,s.jsx)(n.br,{}),"\n","When we do ",(0,s.jsx)(n.code,{children:"docker exec -it"})," , the ",(0,s.jsx)(n.code,{children:"-i"})," flag means: when we execute this new command inside the container, we want to attach our terminal to the std-in channel of that new running process we execute. So by adding on the ",(0,s.jsx)(n.code,{children:"-i"}),' flag we\'re saying "make sure that any stuff that I type in gets directed to std-in of redis-cli".',(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"-t"})," flag is what kinda makes all this text show up a little bit pretty.",(0,s.jsx)(n.br,{}),"\n","Alright well... in reality it's doing a little bit more than that, but at the end of the day the real effect of the dash t is flag is to make sure that all the text that you are entering in and that is coming out shows up in a nicely formatted manner on your screen.",(0,s.jsx)(n.br,{}),"\n","So we've learned about the importance of the -it flags.",(0,s.jsx)(n.br,{}),"\n","Now let's talk about another use of the ",(0,s.jsx)(n.code,{children:"docker exec -it"})," command, which is probably going to be the most common one you'll be using on your own personal projects. A very common thing you'll want to do when using docker is to get shell access or terminal access to your running container. In other words, you're going to want to run commands inside of your container without having to re-run ",(0,s.jsx)(n.code,{children:"docker exec"})," again and again all day.",(0,s.jsx)(n.br,{}),"\n","The next command is how you can open up a shell in the context of your running container."]}),"\n",(0,s.jsx)(n.p,{children:"This is what you need:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it ${TAG_NAME} sh\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["What does ",(0,s.jsx)(n.code,{children:"sh"})," mean?"]})}),"\n",(0,s.jsxs)(n.p,{children:["bash, powershell, zsh, and sh are all ",(0,s.jsx)(n.strong,{children:"command processors"}),".",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"sh"})," is the name of a program, and it is a program that's being executed inside of that container. ",(0,s.jsx)(n.code,{children:"sh"})," is a command processor or a shell. It's something that allows us to type commands in and have them be executed inside that container. You are already making use of a program very much like ",(0,s.jsx)(n.code,{children:"sh"})," on your own computer Traditionally, a LOT of different containers you're going to be working with are probably going to have the ",(0,s.jsx)(n.code,{children:"sh"})," program already included. Some more complete versions of containers or images are going to also have the bash command processor as well. So in some cases you can make use of bash directly, and in the vast majority you're probably going to use the sh to start up a command prompt and start typing in commands."]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-how-to-create-a-dockerfile",children:"4. How to create a Dockerfile"}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," is a text document needed for the ",(0,s.jsx)(n.code,{children:"docker build"})," process.",(0,s.jsx)(n.br,{}),"\n","A ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," contains all the instructions a user could call on the command line to assemble an image. A ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," must begin with a ",(0,s.jsx)(n.code,{children:"FROM"})," instruction."]}),"\n",(0,s.jsxs)(n.p,{children:["When you call the command ",(0,s.jsx)(n.code,{children:"docker build"})," (or ",(0,s.jsx)(n.code,{children:"docker-compose build"}),"), docker builds your image by reading the instructions from a target ",(0,s.jsx)(n.strong,{children:"Dockerfile"}),". Docker then runs the instructions inside it in a sequential order."]}),"\n",(0,s.jsxs)(n.p,{children:["Here is a basic ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," you can copy:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'FROM node\n\nCMD ["echo", "hello world"]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)("font",{size:"5",Dockerfile:!0,Instructions:!0})})}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-1-from",children:"\u2022 Instruction 1: FROM"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"FROM node:19-alpine3.16\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"FROM"})," instruction initializes a new build stage and sets the base image for subsequent instructions."]}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," must begin with a ",(0,s.jsx)(n.code,{children:"FROM"})," instruction. ",(0,s.jsx)(n.code,{children:"FROM"})," may appear after globally scoped ",(0,s.jsx)(n.code,{children:"ARG"}),"'s, comments, or parser directives. The ",(0,s.jsx)(n.code,{children:"FROM"})," instruction specifies the parent image."]}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-2-arg",children:"\u2022 Instruction 2: ARG"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"ARG %name%[=%default value%]\nARG CODE_VERSION=latest\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"ARG"})," instruction defines a variable that users can pass at build-time to the builder with the ",(0,s.jsx)(n.code,{children:"docker build"})," command using the ",(0,s.jsx)(n.code,{children:"--build-arg"})," flag."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build --build-arg <var-name>=<value>\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"warning",children:[(0,s.jsx)(n.p,{children:"If a user specifies a build argument that was not defined in the Dockerfile, the build outputs a warning."}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sh",children:"[Warning] One or more build-args [foo] were not consumed.\nLOOK OUT!!!\nIt is not recommended to use build-time variables for passing secrets like GitHub keys, user credentials etc. Build-time variable values are visible to any user of the image with the docker history command.\nRefer to the RUN --mount=type=secret section to learn about secure ways to use secrets when building images.\n"})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Setting a default values to an ARG"})}),"\n",(0,s.jsxs)(n.p,{children:["Typically, an ",(0,s.jsx)(n.strong,{children:"ARG"}),"'s value is set from out side, and the value is used inside like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"FROM busybox\nARG user1\nARG buildNumber\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can set a ",(0,s.jsx)(n.em,{children:"default value"})," to and ",(0,s.jsx)(n.strong,{children:"ARG"}),", in case an outside value wasn't provided:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"FROM busybox\nARG user1=some-user\nARG buildNumber=1\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If an ",(0,s.jsx)(n.strong,{children:"ARG"})," instruction has a ",(0,s.jsx)(n.em,{children:"default value"}),", and if there is no value passed at build-time, the builder uses the default value you set."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Understanding how ARG and FROM interact:"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"FROM"})," instructions support variables that are declared by any ",(0,s.jsx)(n.strong,{children:"ARG"})," instructions that occur before the first ",(0,s.jsx)(n.strong,{children:"FROM"}),".\nAn ",(0,s.jsx)(n.strong,{children:"ARG"})," declared before a ",(0,s.jsx)(n.strong,{children:"FROM"})," is outside of a build stage, so it can't be used in any instruction after a ",(0,s.jsx)(n.strong,{children:"FROM"}),". To use the ",(0,s.jsx)(n.em,{children:"default value"})," of an ",(0,s.jsx)(n.strong,{children:"ARG"})," declared before the first ",(0,s.jsx)(n.strong,{children:"FROM"})," use an ",(0,s.jsx)(n.strong,{children:"ARG"})," instruction without a value inside of a build stage."]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"ARG VERSION=latest\nFROM busybox:$VERSION\nARG VERSION\nRUN echo $VERSION > image_version\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-3-workdir",children:"\u2022 Instruction 3: WORKDIR"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"WORKDIR /my-workspace\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description"})}),"\n",(0,s.jsxs)(n.p,{children:["If not specified, the default working directory is ",(0,s.jsx)(n.code,{children:"/"}),".",(0,s.jsx)(n.br,{}),"\n","The root folder of the running container contains these folders:",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"bin"}),", ",(0,s.jsx)(n.code,{children:"dev"}),", ",(0,s.jsx)(n.code,{children:"etc"}),", ",(0,s.jsx)(n.code,{children:"tmp"}),", ",(0,s.jsx)(n.code,{children:"var"}),", ",(0,s.jsx)(n.code,{children:"lib"}),", ",(0,s.jsx)(n.code,{children:"mnt"}),", ",(0,s.jsx)(n.code,{children:"srv"}),", ",(0,s.jsx)(n.code,{children:"usr"})," and more.",(0,s.jsx)(n.br,{}),"\n","It is somewhat likely in our project we'd have a folder with the same name, that would override some of the files and folders listed above.",(0,s.jsx)(n.br,{}),"\n","In order to avoid that,",(0,s.jsx)(n.br,{}),"\n","We use the COPY command, but in the target path (the second argument), we might wanna mention a nested directory, like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"COPY ./ ./my-workspace/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Instead of doing the above, we can use the ",(0,s.jsx)(n.strong,{children:"WORKDIR"})," instruction.\nThe ",(0,s.jsx)(n.strong,{children:"WORKDIR"})," instruction sets the working directory on the container for any COPY, ADD, RUN, CMD, and ENTRYPOINT instructions that follow it in the ",(0,s.jsx)(n.strong,{children:"Dockerfile"}),". And so now you can simply do:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"WORKDIR /my-workspace\nCOPY ./ ./\n"})}),"\n",(0,s.jsx)(n.p,{children:"Without worrying about overriding folders which already exists in the root of the container."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Some basic Rules about WORKDIR:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"WORKDIR"})," instruction sets the working directory on the container for any ",(0,s.jsx)(n.strong,{children:"COPY"}),", ",(0,s.jsx)(n.strong,{children:"ADD"}),", ",(0,s.jsx)(n.strong,{children:"RUN"}),", ",(0,s.jsx)(n.strong,{children:"CMD"}),", and ",(0,s.jsx)(n.strong,{children:"ENTRYPOINT"})," instructions that follow it in the ",(0,s.jsx)(n.strong,{children:"Dockerfile"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If the ",(0,s.jsx)(n.strong,{children:"WORKDIR"})," doesn't exist, it will be created, even if it isn't used in any of the subsequent Dockerfile instructions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"WORKDIR"})," instruction can be used multiple times in a Dockerfile. If a relative path is provided, it will be relative to the path of the previous ",(0,s.jsx)(n.strong,{children:"WORKDIR"})," instruction.",(0,s.jsx)(n.br,{}),"\n","Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"WORKDIR /a\nWORKDIR b\nWORKDIR c\nRUN pwd\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The output of the final pwd command in this ",(0,s.jsx)(n.strong,{children:"Dockerfile"})," would be /a/b/c."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The WORKDIR instruction can resolve environment variables previously set using ENV. You can only use environment variables explicitly set in the Dockerfile.\nExample:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"ENV DIRPATH=/path\nWORKDIR $DIRPATH/$DIRNAME\nRUN pwd\n"})}),"\n",(0,s.jsx)(n.p,{children:"The output of the final pwd command in this Dockerfile would be /path/$DIRNAME"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-4-copy",children:"\u2022 Instruction 4: COPY"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"COPY ../package.json ./package.json\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The first argument is the path to your local file system, and the second argument is the path that you want to copy stuff to inside the container.\nWhen using a relative path in the first argument, it is relative to the build's ",(0,s.jsx)(n.code,{children:"context"}),".",(0,s.jsx)(n.br,{}),"\n","For instance:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"lukcylove-monorepo: docker build .\n"})}),"\n",(0,s.jsxs)(n.p,{children:['Running the above command, the context would be "luckylove-monorepo".\nThe ',(0,s.jsx)(n.code,{children:"context"})," can also be defined within the docker-compose file, and then you can run:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"lukcylove-monorepo: docker-compose build\n"})}),"\n",(0,s.jsx)(n.p,{children:"And the context would be taken from there."}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-5-run",children:"\u2022 Instruction 5: RUN"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'RUN [ "pnpm", "run", "start" ]\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"RUN"})," instruction will execute any commands in a new layer on top of the current image and commit the results. The resulting committed image will be used for the next step in the Dockerfile.",(0,s.jsx)(n.br,{}),"\n","Layering ",(0,s.jsx)(n.strong,{children:"RUN"})," instructions and generating commits conforms to the core concepts of Docker where commits are cheap and containers can be created from any point in an image's history, much like source control."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Differences between the shell for and the exec form"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"RUN"})," has 2 forms:\nThe shell form: ",(0,s.jsx)(n.code,{children:"RUN %command%"})," (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)"]}),"\n",(0,s.jsxs)(n.p,{children:["The exec form: ",(0,s.jsx)(n.strong,{children:"RUN"}),' ["executable", "param1", "param2"] (exec form)']}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Some key notes:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"exec"})," form is preferred, since it makes it possible to avoid shell string munging, and to RUN commands using a base image that does not contain the specified shell executable."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"exec"})," form is parsed as a JSON array, which means that you must use double-quotes (\") around words not single-quotes (')."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The default shell for the shell form can be changed using the SHELL command."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Unlike the shell form, the exec form does not invoke a command shell. This means that normal shell processing does not happen.",(0,s.jsx)(n.br,{}),"\n","Take this piece of code for example:"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'CMD [ "echo", "$HOME" ]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The above code will not do variable substitution on ",(0,s.jsx)(n.code,{children:"$HOME"}),". If you want shell processing then either use the shell form or execute a shell directly, for example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'CMD [ "sh", "-c", "echo $HOME" ]\n'})}),"\n",(0,s.jsxs)(n.p,{children:["When using the ",(0,s.jsx)(n.code,{children:"exec"})," form and executing a shell directly, as in the case for the shell form, it is the shell that is doing the environment variable expansion, not docker."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the shell form you can use a backslash ",(0,s.jsx)(n.code,{children:"\\"})," to continue a single RUN instruction onto the next line."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Using the shell form for ",(0,s.jsx)(n.strong,{children:"ENTRYPOINT"})," likely means you're not propagating signals correctly to your app, which can cause problems, in particular in Kubernetes clusters. You can read more about it here in the article named \"Why Your Dockerized Application Isn't Receiving Signals.\" Link --\x3e ",(0,s.jsx)(n.a,{href:"https://hynek.me/articles/docker-signals/",children:"https://hynek.me/articles/docker-signals/"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-6-entrypoint",children:"\u2022 Instruction 6: ENTRYPOINT"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"ENTRYPOINT\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-7-cmd",children:"\u2022 Instruction 7: CMD"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'CMD [ "pnpm", "run", "start" ]\n```dockerfile\n'})}),"\n",(0,s.jsx)(n.h3,{id:"-instruction-8-expose",children:"\u2022 Instruction 8: EXPOSE"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"EXPOSE 3000\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"EXPOSE"})," instruction informs Docker that the container listens on the specified network ports at runtime."]}),"\n",(0,s.jsxs)(n.admonition,{type:"warning",children:[(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"EXPOSE"})," instruction ",(0,s.jsx)(n.em,{children:"DOES NOT"})," actually publish the port!"]}),(0,s.jsxs)(n.p,{children:["It merely functions as a type of documentation between the person who builds the image, and the person who runs the container, about which ports are intended to be published. To actually publish the port when running the container, use the ",(0,s.jsx)(n.code,{children:"-p"})," flag on docker run to publish and map one or more ports, or the ",(0,s.jsx)(n.code,{children:"-P"})," flag to publish all exposed ports and map them to high-order ports."]})]}),"\n",(0,s.jsxs)(n.p,{children:["You can specify whether the port listens on TCP or UDP, and the default is TCP if the protocol is not specified.",(0,s.jsx)(n.br,{}),"\n","By default, ",(0,s.jsx)(n.strong,{children:"EXPOSE"})," assumes TCP. You can also specify UDP:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"EXPOSE 80/udp\nTo expose on both TCP and UDP, include two lines:\nEXPOSE 80/tcp\nEXPOSE 80/udp\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In this case, if you use ",(0,s.jsx)(n.code,{children:"-P"})," with docker run, the port will be exposed once for TCP and once for UDP. Remember that ",(0,s.jsx)(n.code,{children:"-P"})," uses an ephemeral high-ordered host port on the host, so the port will not be the same for TCP and UDP.\nRegardless of the EXPOSE settings, you can override them at runtime by using the ",(0,s.jsx)(n.code,{children:"-p"})," flag. For example"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run -p 80:80/tcp -p 80:80/udp ...\n"})}),"\n",(0,s.jsx)(n.p,{children:'Just like we said the container has its own file system, it also has its own isolated set of ports that can receive traffic. But by default, no incoming traffic to your computer is going to be directed into your container. In order to connect between ports from your local machine to those inside the container, we have to set up an explicit port mapping. A port mapping essentially says "any time that someone makes a request to a given port on your local network, take that request and automatically forward it to some port inside the container". One thing to make sure we understand - this is only talking about incoming requests! Your docker container can by default make requests on its own behalf.'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-docker-compose-commands",children:"5. Docker-Compose commands"}),"\n",(0,s.jsx)(n.h3,{id:"-command-1-docker-compose-build",children:"\u2022 Command 1: docker-compose build"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose build\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["Services are built once and then tagged, by default as project_service.",(0,s.jsx)(n.br,{}),"\n","If the Compose file specifies an image name (i.e. services: my-service-name: image: some-name), the image is tagged with that name, substituting any variables beforehand. See variable interpolation."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used flags:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 1: --no-cache"}),(0,s.jsx)(n.br,{}),"\n","Prevent caching when building the image."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 2: -f | --file"}),(0,s.jsx)(n.br,{}),"\n","Actually, the -f flag belongs to docker-compose command, so it's actually use before the sub-command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"docker-compose -f ./path/to/docker-compose.yaml build\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 3: -t"}),(0,s.jsx)(n.br,{}),"\n","A flag used for tagging the image. With docker, we had no way for tagging our image within the Dockerfile. We had to do so using the -t flag, and then providing the tag for the image. With docker-compose, we can have tags in our docker-compose file, so it basically rendered null the use for the -t flag, but it still can be used to override whatever is in the docker-compose file."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-command-2-docker-compose-up",children:"\u2022 Command 2: docker-compose up"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose up\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsxs)(n.p,{children:["Flags for this command ",(0,s.jsx)(n.strong,{children:"MUST"})," appear AFTER the ",(0,s.jsx)(n.code,{children:"up"})," command!",(0,s.jsx)(n.br,{}),"\n","Example:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d --build\n"})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"..."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Commonly used flags:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 1: -d"}),(0,s.jsx)(n.br,{}),"\n","Run in detached mode."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Flag 2: --build"}),(0,s.jsx)(n.br,{}),"\n","Force a re-build. Meaning, create a new image and THEN, run a container from it. Don't use an existing image."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-command-3-docker-compose-down",children:"\u2022 Command 3: docker-compose down"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose down\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"This command stops and removes an application's containers (is it?)."}),"\n",(0,s.jsx)(n.h3,{id:"-command-4-docker-compose-ps",children:"\u2022 Command 4: docker-compose ps"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker-compose ps\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Description:"})}),"\n",(0,s.jsx)(n.p,{children:"Show all running containers relevant to the current application."}),"\n",(0,s.jsxs)(n.p,{children:["The command ",(0,s.jsx)(n.code,{children:"docker-compose ps"})," shows you all the running containers relevant to ",(0,s.jsx)(n.em,{children:"THIS APPLICATION"}),'. This is in contrast to running it "cousin", ',(0,s.jsx)(n.code,{children:"docker ps"}),", which shows you all the running containers, across ",(0,s.jsx)(n.em,{children:"ALL APPLICATIONS"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6-docker-compose-file",children:"6. Docker-Compose file"}),"\n",(0,s.jsx)(n.h3,{id:"-rule-1-services",children:"\u2022 Rule 1: services"}),"\n",(0,s.jsxs)(n.p,{children:["A Compose file ",(0,s.jsx)(n.strong,{children:"MUST"})," declare a ",(0,s.jsx)(n.code,{children:"services"})," key in the root.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"services"})," value is an object (a map) whose keys are string representations of ",(0,s.jsx)(n.em,{children:"service names"}),", and whose values are ",(0,s.jsx)(n.em,{children:"service definitions"}),".",(0,s.jsx)(n.br,{}),"\n","A ",(0,s.jsx)(n.em,{children:"service definition"})," contains the configuration that is applied to each container started for that service.",(0,s.jsx)(n.br,{}),"\n","Each service MAY also include a ",(0,s.jsx)(n.code,{children:"build"})," section, which defines how to create the Docker image for the service.",(0,s.jsx)(n.br,{}),"\n","Compose implementations ",(0,s.jsx)(n.em,{children:"may"})," support building docker images using this service definition.\nIf not implemented, the ",(0,s.jsx)(n.code,{children:"build"})," section ",(0,s.jsx)(n.em,{children:"should"})," be ignored and the Compose file ",(0,s.jsx)(n.strong,{children:"MUST"})," still be considered valid.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"build"})," support is an OPTIONAL aspect of the Compose specification, and is described in detail in the Build support documentation."]}),"\n",(0,s.jsxs)(n.p,{children:["Each Service defines runtime constraints and requirements to run its containers.\nThe ",(0,s.jsx)(n.code,{children:"deploy"})," section groups these constraints and allows the platform to adjust the deployment strategy to best match containers' needs with available resources. Deploy support is an OPTIONAL aspect of the Compose specification, and is described in detail in the Deployment support documentation. If not implemented the Deploy section SHOULD be ignored and the Compose file MUST still be considered valid."]}),"\n",(0,s.jsx)(n.h3,{id:"-rule-2-servicesimage",children:"\u2022 Rule 2: services.image"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"image"})," specifies the image to start the container from.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"image"})," ",(0,s.jsx)(n.strong,{children:"MUST"})," follow the Open Container Specification\xa0addressable image format, as ",(0,s.jsx)(n.code,{children:"[%registry%/][%project%/]%image%[:%tag%|@%digest%]"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"image: redis\nimage: redis:5\nimage: redis@sha256:0ed5d5928d4737458944eb604cc8509e245c3e19d02ad83935398bc4b991aac7\nimage: library/redis\nimage: docker.io/library/redis\nimage: my_private.registry:5000/redis\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-3-servicesbuild",children:"\u2022 Rule 3: services.build"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["build\n",(0,s.jsx)(n.code,{children:"build"})," an OPTIONAL build subsection on services\n",(0,s.jsx)(n.code,{children:"build"})," specifies the build configuration for creating container image from source.\nWhen a Build subsection is present for a service, it is valid for a Compose file to miss an ",(0,s.jsx)(n.code,{children:"Image"})," attribute for corresponding service, as Compose implementation can build image from source."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"build.context v.s. build = context\nBuild can be either specified as a single string defining a context path, or as a detailed build definition.\nIn the former case, the whole path is used as a Docker context to execute a docker build, looking for a canonical Dockerfile at context root. Context path can be absolute or relative, and if so relative path MUST be resolved from Compose file parent folder. As an absolute path prevent the Compose file to be portable, Compose implementation SHOULD warn user accordingly."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"build.dockerfile\nIn the later case, build arguments can be specified, including an alternate Dockerfile location. This one can be absolute or relative path. If Dockerfile path is relative, it MUST be resolved from context path. As an absolute path prevent the Compose file to be portable, Compose implementation SHOULD warn user if an absolute alternate Dockerfile path is used."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Consistency with Image\nWhen service definition do include both ",(0,s.jsx)(n.code,{children:"Image"})," attribute and a ",(0,s.jsx)(n.code,{children:"Build"})," section, Compose implementation can't guarantee a pulled image is strictly equivalent to building the same image from sources. Without any explicit user directives, Compose implementation with Build support MUST first try to pull Image, then build from source if image was not found on registry. Compose implementation MAY offer options to customize this behavior by user request."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Illustrative sample"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\nfrontend:\nimage: awesome/webapp\nbuild: ./webapp\n\nbackend:\nimage: awesome/database\nbuild:\ncontext: backend\ndockerfile: ../backend.Dockerfile\n\ncustom:\nbuild: ~/custom\n"})}),"\n",(0,s.jsx)(n.p,{children:"When used to build service images from source, such a Compose file will create three docker images:\n\u2022 awesome/webapp docker image is built using webapp sub-directory within Compose file parent folder as docker build context. Lack of a Dockerfile within this folder will throw an error.\n\u2022 awesome/database docker image is built using backend sub-directory within Compose file parent folder. backend.Dockerfile file is used to define build steps, this file is searched relative to context path, which means for this sample .. will resolve to Compose file parent folder, so backend.Dockerfile is a sibling file.\n\u2022 a docker image is built using custom directory within user's HOME as docker context. Compose implementation warn user about non-portable path used to build image."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Build Definition\nThe ",(0,s.jsx)(n.code,{children:"build"})," element define configuration options that are applied by Compose implementations to build Docker image from source. ",(0,s.jsx)(n.code,{children:"build"})," can be specified either as a string containing a path to the build context or a detailed structure:\nUsing this string syntax, only the build context can be configured as either:\n\u2022 a relative path to the Compose file's parent folder. This path MUST be a directory and contain a Dockerfile"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\nwebapp:\nbuild: ./dir\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u2022 a git repository URL. Git URLs accept context configuration in their fragment section, separated by a colon (:). The first part represents the reference that Git\nwill check out, and can be either a branch, a tag, or a remote reference. The second part represents a subdirectory inside the repository that will be used as a\nbuild context.\nservices:\nwebapp:\nbuild: ",(0,s.jsx)(n.a,{href:"https://github.com/mycompany/example.git#branch_or_tag:subdirectory",children:"https://github.com/mycompany/example.git#branch_or_tag:subdirectory"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-rule-4-servicesbuildcontext-required",children:"\u2022 Rule 4: services.build.context (REQUIRED)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"context"})," defines either a path to a directory containing a Dockerfile, or a url to a git repository.\nWhen the value supplied is a relative path, it MUST be interpreted as relative to the location of the Compose file. Compose implementations MUST warn user about absolute path used to define build context as those prevent Compose file from being portable."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"This:\nbuild:\ncontext: ./dir\nV.S. this:\nservices:\nwebapp:\nbuild: https://github.com/mycompany/webapp.git\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-5-servicesbuilddockerfile",children:"\u2022 Rule 5: services.build.dockerfile"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"dockerfile"})," allows to set an alternate Dockerfile. A relative path MUST be resolved from the build context. Compose implementations MUST warn user about absolute path used to define Dockerfile as those prevent Compose file from being portable. When set, ",(0,s.jsx)(n.code,{children:"dockerfile_inline"})," attribute is not allowed and a Compose Implementation SHOULD reject any Compose file having both set."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"build:\ncontext: .\ndockerfile: webapp.Dockerfile\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-6-servicesbuilddockerfile_inline",children:"\u2022 Rule 6: services.build.dockerfile_inline"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"dockerfile_inline"})," allows to define Dockerfile content as inlined string in a Compose file. When set, ",(0,s.jsx)(n.code,{children:"dockerfile"})," attribute is not allowed and a Compose Implementation SHOULD reject any Compose file having both set.\nUse of YAML multi-line string syntax is recommended to define Dockerfile content:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:"build:\ncontext: .\ndockerfile_inline: |\nFROM baseimage\nRUN some command\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-7-servicesbuildargs",children:"\u2022 Rule 7: services.build.args"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"args"})," define build arguments, i.e. Dockerfile ",(0,s.jsx)(n.code,{children:"ARG"})," values.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"args"})," can be set in Compose file under the ",(0,s.jsx)(n.code,{children:"build"})," key to define some arguments.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"args"})," can be set a mapping or a list:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"// Way number 1:\nbuild:\ncontext: .\nargs:\nGIT_COMMIT: %some-value%\n// Way number 2:\nbuild:\ncontext: .\nargs: - GIT_COMMIT=%some-value%\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"-- HARDCODED:"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"args"})," can be hardcoded:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"build:\ncontext: .\nargs: - VERDION=0.0.1\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"-- PASSED FROM OUTSIDE:"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"args"})," can be passed from outside:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"build:\ncontext: .\nargs:\n  # The names do not need to match! First VERSION is the inner name, second VERSION is the outer name.\n  - VERSION=${VERSION:-0.0.1}\n"})}),"\n",(0,s.jsx)(n.p,{children:"In which, you would call the build sub-command like so:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"VERSION=1.2.3 docker-compose build --no-cache\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-8-servicesbuildprivileged",children:"\u2022 Rule 8: services.build.privileged"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"privileged"})," configures the service image to build with elevated privileges. Support and actual impacts are platform-specific.\nbuild:\ncontext: .\nprivileged: true"]}),"\n",(0,s.jsx)(n.h3,{id:"-rule-9-servicesbuildlabels",children:"\u2022 Rule 9: services.build.labels"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"labels"})," add metadata to the resulting image. ",(0,s.jsx)(n.code,{children:"labels"})," can be set either as an array or a map.\nThis:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'build:\ncontext: .\nlabels:\ncom.example.description: "Accounting webapp"\ncom.example.department: "Finance"\ncom.example.label-with-empty-value: ""\n'})}),"\n",(0,s.jsx)(n.p,{children:"V.S. this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'build:\ncontext: .\nlabels: - "com.example.description=Accounting webapp" - "com.example.department=Finance" - "com.example.label-with-empty-value"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-10-servicesbuildno_cache",children:"\u2022 Rule 10: services.build.no_cache"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"no_cache"})," disables image builder cache and enforce a full rebuild from source for all image layers. This only applies to layers declared in the Dockerfile, referenced images COULD be retrieved from local image store whenever tag has been updated on registry (see pull)."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\nusers-service:\nimage: users-service\nbuild:\nno_cache: true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-11-servicesbuildpull",children:"\u2022 Rule 11: services.build.pull"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"pull"})," require the image builder to pull referenced images (FROM Dockerfile directive), even if those are already available in the local image store."]}),"\n",(0,s.jsx)(n.h3,{id:"-rule-12-servicesbuildshm_size",children:"\u2022 Rule 12: services.build.shm_size"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"shm_size"})," set the size of the shared memory (/dev/shm partition on Linux) allocated for building Docker image. Specify as an integer value representing the number of bytes or as a string expressing a byte value."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Byte values:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"2b"}),"\n",(0,s.jsx)(n.li,{children:"1024kb"}),"\n",(0,s.jsx)(n.li,{children:"2048k"}),"\n",(0,s.jsx)(n.li,{children:"300m"}),"\n",(0,s.jsx)(n.li,{children:"1gb"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"build:\ncontext: .\nshm_size: '2gb'\n"})}),"\n",(0,s.jsx)(n.p,{children:"V.S. this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"build:\ncontext: .\nshm_size: 10000000\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-rule-13-servicesbuildsecrets",children:"\u2022 Rule 13: services.build.secrets"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Docker Secrets"})," are only available in ",(0,s.jsx)(n.code,{children:"Swarm mode"}),", so standalone containers can not use this feature.\nA given secret is only accessible to those services which have been granted explicit access to it, and while they're running."]}),"\n",(0,s.jsx)(n.h3,{id:"-rule-14-servicesbuildtags",children:"\u2022 Rule 14: services.build.tags"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"tags"})," defines a list of tag mappings that MUST be associated to the build image.\nThis list comes in addition of the ",(0,s.jsx)(n.code,{children:"image"})," property defined in the service section\ntags:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['"myimage',":mytag",'"']}),"\n",(0,s.jsxs)(n.li,{children:['"registry/username/myrepos',":my-other-tag",'"']}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"-rule-15-servicesenv_file",children:"\u2022 Rule 15: services.env_file"}),"\n",(0,s.jsxs)(n.p,{children:["Defining an ",(0,s.jsx)(n.code,{children:"env_file"})," inside the yaml will take environment variables from the file and inject them into the container. That makes it visible to your application, but cannot be used for variables inside your yaml that you want docker-compose to expand since that variable expansion happens before the env_file contents are parsed."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\n  users-service:\n  env_file: .env\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When both ",(0,s.jsx)(n.code,{children:"env_file"})," and ",(0,s.jsx)(n.code,{children:"environment"})," are set for a service, values set by ",(0,s.jsx)(n.code,{children:"environment"})," have precedence."]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},7252:(e,n,i)=>{i.d(n,{Z:()=>c,a:()=>l});var s=i(959);const r={},o=s.createContext(r);function l(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);