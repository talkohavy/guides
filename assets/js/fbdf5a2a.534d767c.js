"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[7944],{3839:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var t=i(6070),s=i(5710);const o={slug:"vite-library-mode",title:"Create a Component Library Fast \ud83d\ude80 (using Vite's library mode)",authors:["talkohavy"],tags:["vite","react","typescript","tutorial"]},l=void 0,r={permalink:"/guides/blog/vite-library-mode",editUrl:"https://github.com/talkohavy/guides/blog/2024-08-10-vite-library-mode.md",source:"@site/blog/2024-08-10-vite-library-mode.md",title:"Create a Component Library Fast \ud83d\ude80 (using Vite's library mode)",description:"If you are managing multiple React applications and want consistency across your user interfaces, sooner or later you'll find that you need a component library.",date:"2024-08-10T00:00:00.000Z",tags:[{inline:!0,label:"vite",permalink:"/guides/blog/tags/vite"},{inline:!0,label:"react",permalink:"/guides/blog/tags/react"},{inline:!0,label:"typescript",permalink:"/guides/blog/tags/typescript"},{inline:!0,label:"tutorial",permalink:"/guides/blog/tags/tutorial"}],readingTime:16.02,hasTruncateMarker:!1,authors:[{name:"Tal Kohavy",title:"Full Stack Developer",url:"https://github.com/talkohavy",imageURL:"https://avatars.githubusercontent.com/u/51020442",key:"talkohavy",page:null}],frontMatter:{slug:"vite-library-mode",title:"Create a Component Library Fast \ud83d\ude80 (using Vite's library mode)",authors:["talkohavy"],tags:["vite","react","typescript","tutorial"]},unlisted:!1,nextItem:{title:"Welcome",permalink:"/guides/blog/welcome"}},a={authorsImageUrls:[void 0]},d=[{value:"Before we start",id:"before-we-start",level:2},{value:"\ud83c\udf33 Fully tree shakeable",id:"-fully-tree-shakeable",level:3},{value:"\ud83e\udd91 Compiled CSS modules",id:"-compiled-css-modules",level:3},{value:"\ud83d\ude0e TypeScript",id:"-typescript",level:3},{value:"1. Setup a new Vite project",id:"1-setup-a-new-vite-project",level:2},{value:"2. Basic build setup",id:"2-basic-build-setup",level:2},{value:"TypeScript and library mode",id:"typescript-and-library-mode",level:3},{value:"Building the types",id:"building-the-types",level:3},{value:"3. What is a React component library without components?",id:"3-what-is-a-react-component-library-without-components",level:2},{value:"4. Add some styles",id:"4-add-some-styles",level:2},{value:"\u26f4\ufe0f Ship your style",id:"\ufe0f-ship-your-style",level:3},{value:"Import the CSS",id:"import-the-css",level:3},{value:"Split up the CSS",id:"split-up-the-css",level:3},{value:"4. A few last steps before you can publish the package",id:"4-a-few-last-steps-before-you-can-publish-the-package",level:2},{value:"Main file",id:"main-file",level:3},{value:"Define the files to publish",id:"define-the-files-to-publish",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Side effects",id:"side-effects",level:3},{value:"Ensure that the package is built",id:"ensure-that-the-package-is-built",level:3},{value:"5. Demo page and deployment",id:"5-demo-page-and-deployment",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"If you are managing multiple React applications and want consistency across your user interfaces, sooner or later you'll find that you need a component library."}),"\n",(0,t.jsx)(n.p,{children:"When I first wanted to create a React component library, it took me a lot of time to find a setup that met all my requirements and wasn't too complicated."}),"\n",(0,t.jsx)(n.p,{children:"A guide like this would've spared me a great amount of energy wrestling with this stuff myself. I hope it can help you as much as it would have helped me."}),"\n",(0,t.jsx)(n.p,{children:"This post covers setting up and publishing a React component library, including configuring your build process and publishing your package to npm so you and/or others can use it."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"I've done my best to keep all configurations simple and concise, using default settings whenever possible."})}),"\n",(0,t.jsx)(n.p,{children:"When you are done, you can install your library like any other npm package:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install @username/my-component-library\n"})}),"\n",(0,t.jsx)(n.p,{children:"And use it like:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import { Button } from '@username/my-component-library';\n\nfunction MyComponent() {\n  return <Button>Click me!</Button>\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"before-we-start",children:"Before we start"}),"\n",(0,t.jsx)(n.p,{children:"Before we dig into the implementation details, I would like to elaborate on some technical details regarding the setup of the library."}),"\n",(0,t.jsx)(n.h3,{id:"-fully-tree-shakeable",children:"\ud83c\udf33 Fully tree shakeable"}),"\n",(0,t.jsx)(n.p,{children:"For me it was particularly important that only necessary code ends up in the final application. When you import a component, it only includes the necessary JS and CSS styles. Pretty cool, right?"}),"\n",(0,t.jsx)(n.h3,{id:"-compiled-css-modules",children:"\ud83e\udd91 Compiled CSS modules"}),"\n",(0,t.jsxs)(n.p,{children:["The components are styled with ",(0,t.jsx)(n.a,{href:"https://github.com/css-modules/css-modules",children:"CSS modules"}),". When building the library, these styles will get transformed to normal CSS style sheets. This means that the consuming application will not even be required to support CSS modules."]}),"\n",(0,t.jsx)(n.p,{children:"As a bonus compiling the CSS modules avoids a compatibility issue and the package can be consumed in both, environments that support named imports for CSS modules, and environments that don't."}),"\n",(0,t.jsxs)(n.p,{children:["(In the future I want to extend this tutorial to use ",(0,t.jsx)(n.a,{href:"https://vanilla-extract.style",children:"vanilla-extract"})," instead.)"]}),"\n",(0,t.jsx)(n.h3,{id:"-typescript",children:"\ud83d\ude0e TypeScript"}),"\n",(0,t.jsx)(n.p,{children:'While the library is written in TypeScript, it can be consumed in any "normal" JavaScript project as well. If you never used TypeScript before, give it a try. It not only forces you to write cleaner code, but also helps your AI coding assistant make better suggestions \ud83d\ude09'}),"\n",(0,t.jsx)(n.p,{children:"OK enough reading, now let's have some fun!"}),"\n",(0,t.jsx)(n.h2,{id:"1-setup-a-new-vite-project",children:"1. Setup a new Vite project"}),"\n",(0,t.jsxs)(n.p,{children:["If you have never worked with ",(0,t.jsx)(n.a,{href:"https://vitejs.dev",children:"Vite"}),", think of it as a replacement for ",(0,t.jsx)(n.a,{href:"https://medium.com/@dawid.niegrebecki/create-react-app-is-dead-what-to-use-instead-fcdd46b70295",children:"Create React App"}),". Just a few commands and you are ready to go."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm create vite@latest\n? Project name: \u203a my-component-library\n? Select a framework: \u203a React\n? Select a variant: \u203a TypeScript\ncd my-component-library\nnpm i\n"})}),"\n",(0,t.jsx)(n.p,{children:"That's it, your new Vite/React project is ready to go."}),"\n",(0,t.jsx)(n.p,{children:"Here are 4 things I recommend you to do right after installing Vite:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Early first commit\nCommitting regularly is a very good habit. And there is one point in time where it is especially helpful, right after you created a new project and BEFORE you type the first character in your project."}),"\n",(0,t.jsx)(n.li,{children:"Create a .nvmrc file\nWorking with different versions of Node on the same project might cause unnecessary trouble. So the second thing I do after setting up a node project is to create a .nvmrc file in the project root."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'node --version > .nvmrc\ngit add .nvmrc\ngit commit -m "created .nvmrc file"\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Install node's types\nIf working with TypeScript I also install the types package for node. Sooner or later you will need this."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install @types/node -D\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Add a jsconfig.json\nIf you are going to use an editor that uses LSP (VSCode, Sublime Text, etc.) make sure you have a ",(0,t.jsx)(n.code,{children:"jsconfig.json"})," (or ",(0,t.jsx)(n.code,{children:"tsconfig.json"}),") file for your project. Not having this file might bring you into trouble."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"2-basic-build-setup",children:"2. Basic build setup"}),"\n",(0,t.jsxs)(n.p,{children:["You can now run ",(0,t.jsx)(n.code,{children:"npm run dev"})," and browse to the url provided by Vite. While working on your library, this is a place where you can easily import your library and actually see your components. Think of all code inside the ",(0,t.jsx)(n.code,{children:"src"})," folder as your demo page."]}),"\n",(0,t.jsxs)(n.p,{children:["The actual library code will reside in another folder. Let's create this folder and name it ",(0,t.jsx)(n.code,{children:"lib"}),". You could also name it differently, but ",(0,t.jsx)(n.code,{children:"lib"})," is a solid choice."]}),"\n",(0,t.jsxs)(n.p,{children:["The main entry point of your library will be a file named ",(0,t.jsx)(n.code,{children:"main.ts"})," inside of ",(0,t.jsx)(n.code,{children:"lib"}),". When installing the library you can import everything that is exported from this file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:" \ud83d\udcc2 my-component-library\n// diff-add-start\n\u2523 \ud83d\udcc2 lib\n\u2503 \u2517 \ud83d\udcdc main.ts\n// diff-add-end\n  \u2523 \ud83d\udcc2 public\n  \u2523 \ud83d\udcc2 src\n  \u2026\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:(0,t.jsx)("font",{size:"6",children:"Vite Library Mode"})})}),"\n",(0,t.jsxs)(n.p,{children:["At this time, if you build the project with ",(0,t.jsx)(n.code,{children:"npm run build"})," Vite will transpile the code inside ",(0,t.jsx)(n.code,{children:"src"})," to the ",(0,t.jsx)(n.code,{children:"dist"})," folder. This is default Vite behavior."]}),"\n",(0,t.jsxs)(n.p,{children:["For now you will use the demo page for development purposes only. So there is no need to transpile this part of the project yet. Instead you want to transpile and ship the code inside of ",(0,t.jsx)(n.code,{children:"lib"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["This is where Vite's ",(0,t.jsx)(n.em,{children:"Library Mode"})," comes into play. It was designed specifically for building/transpiling libraries. To activate this mode, simply specify your library entry point in ",(0,t.jsx)(n.code,{children:"vite.config.ts"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Like so:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:"showLineNumbers",children:"import { defineConfig } from 'vite'\n// diff-add-next-line\nimport { resolve } from 'path'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n// diff-add-start\n  build: {\n    lib: {\n      entry: resolve(__dirname, 'lib/main.ts'),\n      formats: ['es']\n    }\n  }\n// diff-add-end\n})\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["\ud83d\udca1 The default formats are ",(0,t.jsx)(n.code,{children:"'es'"})," and ",(0,t.jsx)(n.code,{children:"'umd'"}),". For your component library 'es' is all you need. This also removes the necessity for adding the ",(0,t.jsx)(n.code,{children:"name"})," property."]}),(0,t.jsxs)(n.p,{children:["\ud83d\udca1 If your TypeScript linter complains about ",(0,t.jsx)(n.code,{children:"'path'"})," and ",(0,t.jsx)(n.code,{children:"__dirname"})," just install the types for node: ",(0,t.jsx)(n.code,{children:"npm i @types/node -D"})]})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud83d\udcd8 Library mode ",(0,t.jsx)(n.a,{href:"https://vitejs.dev/guide/build.html#library-mode",children:"docs"})]}),"\n",(0,t.jsxs)(n.li,{children:["\ud83d\udcd8 ",(0,t.jsx)(n.code,{children:"lib"})," mode ",(0,t.jsx)(n.a,{href:"https://vitejs.dev/config/build-options.html#build-lib",children:"docs"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"typescript-and-library-mode",children:"TypeScript and library mode"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"tsconfig.json"})," created by Vite only includes the folder ",(0,t.jsx)(n.code,{children:"src"}),". To enable TypeScript for your newly created ",(0,t.jsx)(n.code,{children:"lib"})," folder as well you need to add it to the TypeScript configuration file like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:'// diff-add-next-line\n"include": ["src"],\n// diff-remove-next-line\n"include": ["src", "lib"],\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Although TypeScript needs to be enabled for both the ",(0,t.jsx)(n.code,{children:"src"})," and ",(0,t.jsx)(n.code,{children:"lib"})," folders, it is better to not include ",(0,t.jsx)(n.code,{children:"src"})," when building the library."]}),"\n",(0,t.jsxs)(n.p,{children:["To ensure only the ",(0,t.jsx)(n.code,{children:"lib"})," directory is included during the build process you can create a separate TypeScript configuration file specifically for building."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\ud83d\udca1 Implementing this separate configuration helps avoid TypeScript errors when you import components directly from the ",(0,t.jsx)(n.code,{children:"dist"})," folder on the demo page and those components haven't been built yet."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:" \ud83d\udcc2my-component-library\n  \u2523 ...\n  \u2523 \ud83d\udcdctsconfig.json\n// diff-add-next-line\n\u2523 \ud83d\udcdctsconfig-build.json\n  ...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The only difference is that the build config includes only the ",(0,t.jsx)(n.code,{children:"lib"})," directory, whereas the default configuration includes both ",(0,t.jsx)(n.code,{children:"lib"})," and ",(0,t.jsx)(n.code,{children:"src"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"\ud83d\udcdctsconfig-build.json"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "extends": "./tsconfig.json",\n  "include": ["lib"]\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To use ",(0,t.jsx)(n.code,{children:"tsconfig-build.json"})," for building you need to pass the configuration file to ",(0,t.jsx)(n.code,{children:"tsc"})," in the build script in your package.json:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'  "scripts": {\n     ...\n// diff-remove-next-line\n  "build": "tsc && vite build",\n// diff-add-next-line\n  "build": "tsc -p ./tsconfig-build.json && vite build",\n  }\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Finally you will also need to copy the file ",(0,t.jsx)(n.code,{children:"vite-env.d.ts"})," from ",(0,t.jsx)(n.code,{children:"src"})," to ",(0,t.jsx)(n.code,{children:"lib"}),". Without this file Typescript will miss some types definitions provided by Vite when building (because we don't include ",(0,t.jsx)(n.code,{children:"src"})," anymore)."]}),"\n",(0,t.jsxs)(n.p,{children:["You can now execute ",(0,t.jsx)(n.code,{children:"npm run build"})," once more and this is what you will see in your dist folder:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2dist\n  \u2523 \ud83d\udcdcmy-component-library.js\n  \u2517 \ud83d\udcdcvite.svg\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\ud83d\udca1 The name of the output file is identical with the ",(0,t.jsx)(n.code,{children:"name"})," property in your package.json per default. This can be changed in the Vite config (",(0,t.jsx)(n.code,{children:"build.lib.fileName"}),") but we will do something else about this later."]})}),"\n",(0,t.jsxs)(n.p,{children:["The file ",(0,t.jsx)(n.code,{children:"vite.svg"})," is in your ",(0,t.jsx)(n.code,{children:"dist"})," folder because Vite copies all files from the ",(0,t.jsx)(n.code,{children:"public"})," directory to the output folder. Let's disable this behavior:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"showLineNumbers",children:"export default defineConfig({\n  // ...\n  build: {\n// diff-add-next-line\n    copyPublicDir: false,\n  },\n});\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["You can read a more detailed explanation here: ",(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/75276160/why-is-the-file-vite-svg-in-the-dist-folder-when-building-with-vite-library",children:"Why is the file vite.svg in the dist folder?"})]})}),"\n",(0,t.jsx)(n.h3,{id:"building-the-types",children:"Building the types"}),"\n",(0,t.jsxs)(n.p,{children:["As this is a Typescript library you also want to ship type definitions with your package. Fortunately there is a Vite plugin that does exactly this: ",(0,t.jsx)(n.a,{href:"https://github.com/qmhc/vite-plugin-dts",children:"vite-plugin-dts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i vite-plugin-dts -D\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Per default ",(0,t.jsx)(n.code,{children:"dts"})," will generate types for both ",(0,t.jsx)(n.code,{children:"src"})," and ",(0,t.jsx)(n.code,{children:"lib"})," because both folders are included in the project's ",(0,t.jsx)(n.code,{children:".tsconfig"}),". This is why we need to pass one configuration parameter: ",(0,t.jsx)(n.code,{children:"include: ['lib']"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"title=vite.config.ts",children:"// diff-add-next-line\nimport dts from 'vite-plugin-dts';\n\n// ...\nexport default defineConfig({\n  // ...\n  plugins: [\n    react(),\n    // diff-add-next-line\n  dts({ include: ['lib'] }),\n  ],\n  // ...\n});\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\ud83d\udca1 It would also work to ",(0,t.jsx)(n.code,{children:"exclude: ['src']"})," or use a different Typescript config file for building."]})}),"\n",(0,t.jsxs)(n.p,{children:["To test things out, let's add some actual code to your library. Open ",(0,t.jsx)(n.code,{children:"lib/main.ts"})," and export something, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",metastring:"title=lib/main.ts",children:"export function helloAnything(thing: string): string {\n  return `Hello ${thing}!`;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then run ",(0,t.jsx)(n.code,{children:"npm run build"})," to transpile your code. If the content of your ",(0,t.jsx)(n.code,{children:"dist"})," folder looks like below you should be all set \ud83e\udd73:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2dist\n  \u2523 \ud83d\udcdcmain.d.ts\n  \u2517 \ud83d\udcdcmy-component-library.js\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"\ud83d\udca1 Don't be shy, open the files and see what the program did for you!"})}),"\n",(0,t.jsx)(n.h2,{id:"3-what-is-a-react-component-library-without-components",children:"3. What is a React component library without components?"}),"\n",(0,t.jsxs)(n.p,{children:["We didn't do all of this just to export a ",(0,t.jsx)(n.code,{children:"helloAnything"})," function. So let's add some meat \ud83c\udf56 (or tofu \ud83c\udf31 or both) to our library."]}),"\n",(0,t.jsx)(n.p,{children:"Let's go with two very common basic components: A button, and a label."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2my-component-library\n  \u2523 \ud83d\udcc2lib\n +\u2503 \u2523 \ud83d\udcc2components\n +\u2503 \u2503 \u2523 \ud83d\udcc2Button\n +\u2503 \u2503 \u2503 \u2523 \ud83d\udcc2Button.tsx\n +\u2503 \u2503 \u2503 \u2517 \ud83d\udcdcindex.ts\n +\u2503 \u2503 \u2517 \ud83d\udcc2Label\n +\u2503 \u2503 \u2503 \u2523 \ud83d\udcc2Label.tsx\n +\u2503 \u2503   \u2517 \ud83d\udcdcindex.ts\n  \u2503 \u2517 \ud83d\udcdcmain.ts\n  \u2026\n"})}),"\n",(0,t.jsx)(n.p,{children:"And a very basic implementation for these components:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=lib/components/Button/Button.tsx",children:"export default function Button(props: React.ButtonHTMLAttributes<HTMLButtonElement>) {\n  return <button type='button' {...props} />;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=lib/components/Label/Label.tsx",children:"export function Label(props: React.LabelHTMLAttributes<HTMLLabelElement>) {\n  return <label {...props} />;\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Finally export the components from the library's main file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=lib/main.ts",children:"export { Button } from './components/Button';\nexport { Label } from './components/Label';\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you ",(0,t.jsx)(n.code,{children:"npm run build"})," again you will notice that the transpiled file ",(0,t.jsx)(n.code,{children:"my-component-library.js"})," now has ",(0,t.jsx)(n.strong,{children:"78kb"}),' \ud83d\ude2e (a bit less because I removed "Input" from my example)']}),"\n",(0,t.jsxs)(n.p,{children:["The implementation of the components above contains React JSX code and therefore ",(0,t.jsx)(n.code,{children:"react"})," (and ",(0,t.jsx)(n.code,{children:"react/jsx-runtime"}),") gets bundled as well."]}),"\n",(0,t.jsx)(n.p,{children:"As this library will be used in projects that have React installed anyways, you can externalize this dependencies to remove the code from bundle:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"export default defineConfig({\n  // ...\n  build: {\n   // ...\n// diff-add-start\n   rollupOptions: {\n       external: ['react', 'react/jsx-runtime'],\n   },\n// diff-add-end\n  },\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-add-some-styles",children:"4. Add some styles"}),"\n",(0,t.jsx)(n.p,{children:"As mentioned in the beginning, this library will use CSS modules to style the components."}),"\n",(0,t.jsxs)(n.p,{children:["CSS modules are supported by Vite per default. All you have to do is to create CSS files that end with ",(0,t.jsx)(n.code,{children:".module.css"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2my-component-library\n  \u2523 \ud83d\udcc2lib\n  \u2503 \u2523 \ud83d\udcc2components\n  \u2503 \u2503 \u2523 \ud83d\udcc2Button\n  \u2503 \u2503 \u2503 \u2523 \ud83d\udcc2Button.tsx\n  \u2503 \u2503 \u2503 \u2523 \ud83d\udcdcindex.ts\n+ \u2503 \u2503 \u2503 \u2517 \ud83d\udcc2Button.module.css\n  \u2503 \u2503 \u2517 \ud83d\udcc2Label\n  \u2503 \u2503   \u2523 \ud83d\udcc2Label.tsx\n  \u2503 \u2503   \u2523 \ud83d\udcdcindex.ts\n+ \u2503 \u2503   \u2517 \ud83d\udcc2Label.module.css\n  \u2503 \u2517 \ud83d\udcdcmain.ts\n  \u2026\n"})}),"\n",(0,t.jsx)(n.p,{children:"And add some basic CSS classes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-css",metastring:"title=lib/components/Button/Button.module.css",children:".button {\n    padding: 1rem;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-css",metastring:"title=lib/components/Label/Label.module.css",children:".label {\n    font-weight: bold;\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"And import/use them inside your components eg:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"import styles from './styles.module.css';\n\nexport function Button(props: React.ButtonHTMLAttributes<HTMLButtonElement>) {\n  const { className, ...restProps } = props;\n  return <button type='button' className={`${className} ${styles.button}`} {...restProps} />;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\ufe0f-ship-your-style",children:"\u26f4\ufe0f Ship your style"}),"\n",(0,t.jsx)(n.p,{children:"After transpiling your library you will notice that there is a new file in your distribution folder:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:" \ud83d\udcc2dist\n  \u2523 \u2026\n  \u2523 \ud83d\udcdcmy-component-library.js\n# diff-add-next-line\n\u2517 \ud83d\udcdcstyle.css\n"})}),"\n",(0,t.jsx)(n.p,{children:"But there are two issues with this file:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"You need to manually import the file in the consuming application."}),"\n",(0,t.jsx)(n.li,{children:"It is one file that contains all styles for all components."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"import-the-css",children:"Import the CSS"}),"\n",(0,t.jsx)(n.p,{children:"CSS files just can't easily be imported in JavaScript. Therefore, the CSS file is generated separately, allowing the library user to decide how to handle the file."}),"\n",(0,t.jsx)(n.p,{children:"But what if we were to assume that the application using the library has a bundler configuration that can handle CSS imports?"}),"\n",(0,t.jsxs)(n.p,{children:["For this to work, the transpiled JavaScript bundle must contain an import statement for the CSS file. We are going to use yet another Vite plugin (",(0,t.jsx)(n.a,{href:"https://github.com/emosheeep/vite-plugin-lib-inject-css/tree/master/packages/vite-plugin-lib-inject-css",children:"vite-plugin-lib-inject-css"}),") that does exactly what we need with zero configuration."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i vite-plugin-lib-inject-css -D\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"// diff-add-next-line\nimport { libInjectCss } from 'vite-plugin-lib-inject-css';\n\nexport default defineConfig({\n  // ...\n  plugins: [\n    react(),\n// diff-add-next-line\n    libInjectCss(),\n    dts({ include: ['lib'] }),\n  ],\n  // ...\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Build the library and take a look at the top of your bundled JavaScript file (",(0,t.jsx)(n.code,{children:"dist/my-component-library.js"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=dist/my-component-library.js",children:"import './main.css';\n\n// ...\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"\ud83d\udca1 You may notice that the CSS filename has changed from style.css to main.css. This change occurs because the plugin generates a separate CSS file for each chunk, and in this case the name of the chunk comes from the filename of the entry file."})}),"\n",(0,t.jsx)(n.h3,{id:"split-up-the-css",children:"Split up the CSS"}),"\n",(0,t.jsxs)(n.p,{children:["But there's still the second problem: when you import something from your library, ",(0,t.jsx)(n.code,{children:"main.css"})," is also imported and all the CSS styles end up in your application bundle. Even if you only import the button."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"libInjectCSS"})," plugin generates a separate CSS file for each chunk and includes an import statement at the beginning of each chunk's output file."]}),"\n",(0,t.jsx)(n.p,{children:"So if you split up the JavaScript code, you end up having separate CSS files that only get imported when the according JavaScript files are imported."}),"\n",(0,t.jsxs)(n.p,{children:["One way of doing this would be to turn every file into an Rollup entry point. And, it couldn't be better, there is a recommended way of doing this right in the ",(0,t.jsx)(n.a,{href:"https://rollupjs.org/configuration-options/#input",children:"Rollup documentation"}),":"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"\ud83d\udcd8 If you want to convert a set of files to another format while maintaining the file structure and export signatures, the recommended way\u2014instead of using output.preserveModules that may tree-shake exports as well as emit virtual files created by plugins\u2014is to turn every file into an entry point."})}),"\n",(0,t.jsx)(n.p,{children:"So let's add this to your configuration."}),"\n",(0,t.jsxs)(n.p,{children:["First install ",(0,t.jsx)(n.code,{children:"glob"})," as it will be required:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i glob -D\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then change your Vite config to this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"/* eslint-disable*/\n// diff-remove-next-line\nimport { resolve } from 'path';\n// diff-add-start\nimport { extname, relative, resolve } from 'path';\nimport { glob } from 'glob';\nimport { fileURLToPath } from 'node:url';\n// diff-add-end\n// ...\nexport default defineConfig({\n  // ...\n    rollupOptions: {\n      external: ['react', 'react/jsx-runtime'],\n\n// diff-add-start\n     input: Object.fromEntries(\n         glob.sync('lib/**/*.{ts,tsx}', {\n             ignore: ['lib/**/*.d.ts'],\n       }).map(file => [\n         // The name of the entry point lib/nested/foo.ts becomes nested/foo\n         relative(\n             'lib',\n           file.slice(0, file.length - extname(file).length),\n         ),\n         // The absolute path to the entry file lib/nested/foo.ts becomes /project/lib/nested/foo.ts\n         fileURLToPath(new URL(file, import.meta.url)),\n       ]),\n     ),\n// diff-add-end\n    },\n   // ...\n});\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\ud83d\udca1 The glob library helps you to specify a set of filenames. In this case it selects all files ending with ",(0,t.jsx)(n.code,{children:".ts"})," or ",(0,t.jsx)(n.code,{children:".tsx"})," and ignores ",(0,t.jsx)(n.code,{children:"*.d.ts"})," files."]})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"How to use Storybook for my library?"})}),"\n",(0,t.jsxs)(n.p,{children:["To install Storybook run ",(0,t.jsx)(n.code,{children:"npx storybook@latest init"})," and start adding your stories."]}),"\n",(0,t.jsxs)(n.p,{children:["If you add stories inside the ",(0,t.jsx)(n.code,{children:"lib"})," folder you also need to make sure to exclude all ",(0,t.jsx)(n.code,{children:".stories.tsx"})," files from the glob pattern so the stories don't end up in your bundle."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"glob.sync('lib/**/*.{ts,tsx}', { ignore: 'lib/**/*.stories.tsx' });\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Now you end up with a bunch of JavaScript and CSS files in the root of your ",(0,t.jsx)(n.code,{children:"dist"})," folder. It works, but it doesn't look particularly pretty, does it?"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=vite.config.ts",children:"export default defineConfig({\n\n  rollupOptions: {\n    // ...\n// diff-add-start\n     output: {\n       assetFileNames: 'assets/[name][extname]',\n       entryFileNames: '[name].js',\n     },\n// diff-add-end\n    },\n    // ...\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Transpile the library again and all JavaScript files should now be in the same organized folder structure you have created in ",(0,t.jsx)(n.code,{children:"lib"})," alongside with their type definitions. And the CSS files are inside a new folder called assets."]}),"\n",(0,t.jsxs)(n.p,{children:["Transpile the library again and all JavaScript files should now be in the same organized folder structure that you created in ",(0,t.jsx)(n.code,{children:"lib"}),' along with their types. And the CSS files are in a new folder called "assets". \ud83d\ude4c']}),"\n",(0,t.jsx)(n.p,{children:'Notice that the name of the main file has changed from "my-component-library.js" to "main.js". That\'s great!'}),"\n",(0,t.jsx)(n.h2,{id:"4-a-few-last-steps-before-you-can-publish-the-package",children:"4. A few last steps before you can publish the package"}),"\n",(0,t.jsx)(n.p,{children:"Your build setup is now ready, there are just a few things to consider before releasing your package."}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"package.json"})," file will get published along with your package files. And you need to make sure it contains all important information about the package."]}),"\n",(0,t.jsx)(n.h3,{id:"main-file",children:"Main file"}),"\n",(0,t.jsxs)(n.p,{children:["Every npm package has a primary entry point, per default this file is ",(0,t.jsx)(n.code,{children:"index.js"})," in the root of the package."]}),"\n",(0,t.jsxs)(n.p,{children:["Your library's primary entry point is now located at ",(0,t.jsx)(n.code,{children:"dist/main.js"}),", so this needs to be set in your ",(0,t.jsx)(n.code,{children:"package.json"}),". The same applies to the type's entry point: ",(0,t.jsx)(n.code,{children:"dist/main.d.ts"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n  "name": "my-component-library",\n  "private": true,\n  "version": "0.0.0",\n  "type": "module",\n// diff-add-start\n  "main": "dist/main.js",\n  "types": "dist/main.d.ts",\n// diff-add-end\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"define-the-files-to-publish",children:"Define the files to publish"}),"\n",(0,t.jsx)(n.p,{children:"You should also define which files should be packed into your distributed package."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n  "main": "dist/main.js",\n  "types": "dist/main.d.ts",\n// diff-add-start\n  "files": [\n    "dist"\n  ],\n// diff-add-end\n}\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\ud83d\udca1 Certain files like ",(0,t.jsx)(n.code,{children:"package.json"})," or ",(0,t.jsx)(n.code,{children:"README"})," are always included, regardless of settings."]})}),"\n",(0,t.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,t.jsxs)(n.p,{children:["Now take a look at your ",(0,t.jsx)(n.code,{children:"dependencies"}),": right now there should be only two ",(0,t.jsx)(n.code,{children:"react"})," and ",(0,t.jsx)(n.code,{children:"react-dom"})," and a couple of ",(0,t.jsx)(n.code,{children:"devDependencies"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["You can move those two to the ",(0,t.jsx)(n.code,{children:"devDependencies"})," as well. And additionally add them as ",(0,t.jsx)(n.code,{children:"peerDependencies"})," so the consuming application is aware that it must have React installed to use this package."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n// diff-remove-next-line\n"dependencies": {\n// diff-add-next-line\n"peerDependencies": {\n    "react": "^18.2.0",\n    "react-dom": "^18.2.0"\n  },\n  "devDependencies": {\n+   "react": "^18.2.0",\n+   "react-dom": "^18.2.0",\n  }\n}\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\ud83d\udca1 See this StackOverflow answer to learn more about the different types of dependencies: ",(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/18875674/whats-the-difference-between-dependencies-devdependencies-and-peerdependencie",children:"Link"})]})}),"\n",(0,t.jsx)(n.h3,{id:"side-effects",children:"Side effects"}),"\n",(0,t.jsx)(n.p,{children:"To prevent the CSS files from being accidentally removed by the consumer's tree-shaking efforts, you should also specify the generated CSS as side effects:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n// ...\n// diff-add-next-line\n"sideEffects": ["**/*.css"],\n// ...\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"ensure-that-the-package-is-built",children:"Ensure that the package is built"}),"\n",(0,t.jsx)(n.p,{children:"You can use the special lifecycle script prepublishOnly to guarantee that your changes are always built before the package is published:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:"title=package.json",children:'{\n  "scripts": {\n    "dev": "vite",\n    "build": "tsc && vite build",\n    // ...\n// diff-add-next-line\n  "prepublishOnly": "npm run build"\n  },\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"5-demo-page-and-deployment",children:"5. Demo page and deployment"}),"\n",(0,t.jsxs)(n.p,{children:["To just play around with your components on the demo page, you can simply import the components directly from the root of your project. This works because your ",(0,t.jsx)(n.code,{children:"package.json"})," points to the transpiled main file ",(0,t.jsx)(n.code,{children:"dist/main.ts"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title=src/App.tsx",children:"/* eslint-disable */\nimport { Button, Input, Label } from '../';\n\n// ...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To publish your package, you just need to run ",(0,t.jsx)(n.code,{children:"npm publish"}),". If you want to release your package to the public, you have to set ",(0,t.jsx)(n.code,{children:"private: false"})," in your ",(0,t.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You can read more about publishing your package, including installing it in a local project (without publishing) in these articles of mine:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.to/receter/the-minimal-setup-to-package-and-reuse-your-react-components-1063#publishinstall-your-package",children:"Publish/install your package"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://dev.to/receter/automatically-publish-your-node-package-to-npm-with-pnpm-and-github-actions-22eg",children:"Automatically publish you package with GitHub actions"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},5710:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var t=i(758);const s={},o=t.createContext(s);function l(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);