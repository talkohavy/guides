<!doctype html>
<html lang="he" dir="rtl" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-programming/devops/circleci/circleci" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">CircleCI | ✨ Super Guides ✨</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://talkohavy.github.io/guides/he/img/programmers-playbook.png"><meta data-rh="true" name="twitter:image" content="https://talkohavy.github.io/guides/he/img/programmers-playbook.png"><meta data-rh="true" property="og:url" content="https://talkohavy.github.io/guides/he/docs/programming/devops/circleci/"><meta data-rh="true" property="og:locale" content="he"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="he"><meta data-rh="true" name="docsearch:language" content="he"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CircleCI | ✨ Super Guides ✨"><meta data-rh="true" name="description" content="4. Docker &amp; Docker Images"><meta data-rh="true" property="og:description" content="4. Docker &amp; Docker Images"><link data-rh="true" rel="icon" href="/guides/he/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://talkohavy.github.io/guides/he/docs/programming/devops/circleci/"><link data-rh="true" rel="alternate" href="https://talkohavy.github.io/guides/docs/programming/devops/circleci/" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://talkohavy.github.io/guides/he/docs/programming/devops/circleci/" hreflang="he"><link data-rh="true" rel="alternate" href="https://talkohavy.github.io/guides/docs/programming/devops/circleci/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/guides/he/blog/rss.xml" title="✨ Super Guides ✨ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/guides/he/blog/atom.xml" title="✨ Super Guides ✨ Atom Feed"><link rel="stylesheet" href="/guides/he/assets/css/styles.16516d16.css">
<script src="/guides/he/assets/js/runtime~main.6111b80a.js" defer="defer"></script>
<script src="/guides/he/assets/js/main.0b19e071.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/guides/he/img/logo.svg"><link rel="preload" as="image" href="/guides/he/img/logo_dark.svg"><div role="region" aria-label="דלג לתוכן הראשי"><a class="skipToContent_RhID" href="#__docusaurus_skipToContent_fallback">דלג לתוכן הראשי</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/guides/he/"><div class="navbar__logo"><img src="/guides/he/img/logo.svg" alt="My Site Logo" class="themedComponent_csNk themedComponent--light_r8P4"><img src="/guides/he/img/logo_dark.svg" alt="My Site Logo" class="themedComponent_csNk themedComponent--dark_wf4g"></div><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" alt="Developer Guides" href="/guides/he/docs/programming/">Guides</a><a class="navbar__item navbar__link" href="/guides/he/blog/">Blogs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_DmOC"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>עברית</a><ul class="dropdown__menu"><li><a href="/guides/docs/programming/devops/circleci/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/guides/he/docs/programming/devops/circleci/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="he">עברית</a></li></ul></div><a href="https://github.com/talkohavy/guides/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_wmnB colorModeToggle_fWli"><button class="clean-btn toggleButton_bQZa toggleButtonDisabled_C1et" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_gSzX lightToggleIcon_lEcB"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_gSzX darkToggleIcon_YXBX"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_gSzX systemToggleIcon_fupr"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_F4dl"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_a9oO"><div class="docsWrapper_Om3E"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_PY_U" type="button"></button><div class="docRoot_NTCh"><main class="docMainContainer_lJ4u docMainContainerEnhanced_ijDW"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_unNH"><div class="docItemContainer_knny"><article><div class="tocCollapsible_kUQr theme-doc-toc-mobile tocMobile_NpYS"><button type="button" class="clean-btn tocCollapsibleButton_r0H2">בעמוד זה</button></div><div class="theme-doc-markdown markdown"><header><h1>CircleCI</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="4-docker--docker-images">4. Docker &amp; Docker Images<a href="#4-docker--docker-images" class="hash-link" aria-label="קישור ישיר אל 4. Docker &amp; Docker Images" title="קישור ישיר אל 4. Docker &amp; Docker Images" translate="no">​</a></h2>
<p>In the config example above, you might have come across a key called <code>docker</code>:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cimg/node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tag</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<p>The docker keyword MUST contain the <code>image</code> keyword, and the image&#x27;s keyword needs an image. That image could be a downloadable image from docker hub, or it could be onde circleci&#x27;s custom images.
Now, it should be obvious to you, that in order to run your tests remotely, you first need a remote machine, right? And that machine could be anything! Windows, Macos, or Linux.
But your code is probably written for a specific OS, right?
So in order to be able to run your code remotely, that machine, whatever it maybe, HAS TO run your code inside a docker! And it&#x27;s UP TO YOU to tell it which docker image of an operating system YOUR PROJECT NEEDS!</p>
<div class="theme-admonition theme-admonition-info admonition_KwDl alert alert--info"><div class="admonitionHeading_F3Br"><span class="admonitionIcon_zF0T"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_fiQM"><p>Note! Legacy images with the prefix &quot;circleci/&quot; were deprecated on December 31, 2021. For faster builds, upgrade your projects with next-generation convenience images. They are those which start with &quot;cimg/...&quot;</p></div></div>
<p>Luckily, CircleCI maintains a fleet of images for various programming languages, databases, and operating systems. CircleCI basically gives you a machine that would run a docker container from an image with the operating system of your choice, PLUS some extra stuff that circleci needs in order to live.
You can find all of circleci custom images over at:</p>
<p><a href="https://circleci.com/developer/images?imageType=docker" target="_blank" rel="noopener noreferrer" class="">https://circleci.com/developer/images?imageType=docker</a></p>
<p>We are going to use <code>cimg/node:18.8.0</code></p>
<p><strong>Note</strong>! This image is designed to supersede the legacy CircleCI Node.js image, <code>circleci/node</code>.</p>
<p><code>cimg/node</code> is a Docker image created by CircleCI with continuous integration builds in mind. Each tag contains a version of Node.js, npm, yarn v1, and any binaries and tools that are required for builds to complete successfully in a CircleCI environment.</p>
<ul>
<li class=""><strong>Tag Version</strong></li>
</ul>
<p>Basically, what we&#x27;re using is this <code>cimg/node:&lt;node-version&gt;</code></p>
<p><code>&lt;node-version&gt;</code> - The version of Node.js to use. This can be a full SemVer point release, such as 10.16.3, or just the minor release, such as 12.6, or a version alias.
There are two version aliases: one is &quot;current&quot; and the other is &quot;lts&quot;.
The alias &quot;current&quot; will always point to the latest, and the alias &quot;lts&quot; will always point to long term releases that Node.js has as according to their website.
<strong>Keep in mind</strong>! Using an alias tag will be less stable that specifying a full SemVer version. Breaking changes in node version could break your code without you knowing about it.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="5-checkout">5. Checkout<a href="#5-checkout" class="hash-link" aria-label="קישור ישיר אל 5. Checkout" title="קישור ישיר אל 5. Checkout" translate="no">​</a></h2>
<p>One of the most important directives, that would be present in nearly 99% of all your jobs, and for the most part it would come as early in the beginning of a job.
Checkout performs a <code>git clone</code> to your source code, and copies all the relevant files.</p>
<p>How it knows what to clone?</p>
<p>This is one of those things that are done behind the scenes, and this was done when you first connected between circleci and github/bitbucket. By connecting them, you basically allowed circleci to peek into your repository, and gave it access to clone it.</p>
<ul>
<li class=""><strong>From the docs</strong>:</li>
</ul>
<blockquote>
<p>A special step used to check out source code to the configured path (defaults to the working_directory). The reason this is a special step is because it is more of a helper function designed to make checking out code easy for you. If you require doing git over HTTPS you should not use this step as it configures git to checkout over ssh.</p>
</blockquote>
<p>If path already exists and is:</p>
<ul>
<li class="">a git repo - step will not clone whole repo, instead will fetch origin</li>
<li class="">NOT a git repo - step will fail.</li>
</ul>
<p>In the case of checkout, the step type is just a string with no additional attributes:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span></code></pre></div></div>
<ul>
<li class="">Note: CircleCI does not check out submodules. If your project requires submodules, add run steps with appropriate commands as shown in the following example:</li>
</ul>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> git submodule sync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> git submodule update </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">init</span><br></span></code></pre></div></div>
<p>This command will automatically add the required authenticity keys for interacting with GitHub and Bitbucket over SSH, which is detailed further in our integration guide – this guide will also be helpful if you wish to implement a custom checkout command.</p>
<ul>
<li class="">Note: The checkout step will configure Git to skip automatic garbage collection. If you are caching your .git directory with restore_cache and would like to use garbage collection to reduce its size, you may wish to use a run step with command git gc before doing so.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="6-jobs--steps">6. Jobs &amp; Steps<a href="#6-jobs--steps" class="hash-link" aria-label="קישור ישיר אל 6. Jobs &amp; Steps" title="קישור ישיר אל 6. Jobs &amp; Steps" translate="no">​</a></h2>
<p>Even the most basic circleci <code>config.yml</code> file would have this trio of: workflow, jobs &amp; steps.
A CircleCI job is a collection of steps. All of the steps in the job are executed in a single unit, either within a fresh container, or a virtual machine. Jobs are orchestrated using workflows (soon to be discussed).
Inside the config.yml, we define all the jobs we want to run, for example <code>build</code> and <code>test</code>, and inside each of them, we specify 1 or more steps to be ran.
All jobs would be defined under the root key of <code>jobs</code>:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> run echo &quot;hello from build</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> run echo &quot;hello from test</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<p>Under <code>jobs</code>, you specify all your jobs, in an object-like manner.
Each job is referenced by a unique made-up <code>&lt;name&gt;</code> you provide.
Each job, MUST CONTAIN the <code>steps</code> directive, and the <code>docker</code> directive.
The <code>steps</code> is basically an array of commands to be executed sequentially.
Notice the docker part!
This is the first thing to sort out, since your code needs to be executed in some OS environment, so, if you think about it , before all the steps you define, there&#x27;s actually a step-zero, which is to set up and run an image / docker container.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="7-workflows">7. Workflows<a href="#7-workflows" class="hash-link" aria-label="קישור ישיר אל 7. Workflows" title="קישור ישיר אל 7. Workflows" translate="no">​</a></h2>
<p>A workflow gives you the ability to separate and orchestrate jobs.
You can refer to <code>workflows</code> as the similar concepts of &quot;pipelines&quot; or &quot;build stages.&quot;
Every config.yml file should have a <code>workflow</code> as a root key!
If you do not specify one, a default one would be created for you, which would run only… I think it&#x27;s the first job inside the <code>jobs</code> array. Anyway, never mind, just define it! Period!</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build_and_test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span></code></pre></div></div>
<p>In the example above, you see how the test job is executed after and only after the build job finishes. The second thing you might notice, is the second appearance of the keyword <code>jobs</code>. The <code>jobs</code> keyword appeared once before as a root level key, where we defined ALL of the project&#x27;s jobs, and now for a specific workflow, we can take just SOME of those jobs, and re-organize them in any way shape or form we like.
Which brings us to our next topic within workflows, with a direct link to workflows, which is sequential and parallel execution of jobs in a workflow.</p>
<ul>
<li class=""><strong>Sequential &amp; Parallel execution</strong></li>
</ul>
<p>The above example presented a sequential execution, and this was all thanks to the directive of <code>requires</code>: -<code>&lt;job-name&gt;</code>. The folks at circleci are calling it &quot;fan in&quot; &amp; &quot;fan out&quot;.
Here&#x27;s an example I like that shows both sequential and a parallel execution all-in-one:</p>
<div class="language-text codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-text codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">                                            ┌──────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              ┌─────────────┤   Job 1: Build       ├─────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             │         ✓            │             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             └──────────────────────┘             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             ┌──────────────────────┐             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             │                      │             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              ├─────────────┤   Job 2: Test        ├─────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌──────────────────────┐      │             │         ✓            │             │       ┌──────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │      │             └──────────────────────┘             │       │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Begin               ├──────┤                                                  ├───────┤   Job 5: Deploy      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                      │      │             ┌──────────────────────┐             │       │                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────┘      │             │                      │             │       └──────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              ├─────────────┤   Job 3: Lint        ├─────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             │         ✓            │             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             └──────────────────────┘             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             ┌──────────────────────┐             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              │             │                      │             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                              └─────────────┤   Job 4: Security    ├─────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            │         ✓            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                            └──────────────────────┘</span><br></span></code></pre></div></div>
<p>This could be achieved in the config.yml by:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build_and_test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job5</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="8-working-directory">8. Working Directory<a href="#8-working-directory" class="hash-link" aria-label="קישור ישיר אל 8. Working Directory" title="קישור ישיר אל 8. Working Directory" translate="no">​</a></h2>
<p>When defining a job, one of the properties you can give it is a directive called <code>working_directory</code>, that basically creates a folder, with a name you provide, a second after the container starts to run, to start running the steps of this particular job.
By default, when a docker container spins up to run a job, circleci creates this path:</p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">/home/circleci/project</span><br></span></code></pre></div></div>
<p>By providing a <code>working_directory</code>, like so;</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">working_directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/luckylove_frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> run echo &quot;hello from build</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<p>you could override the default name &quot;project&quot;, and have the path be:</p>
<div class="language-text codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-text codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">/home/circleci/luckylove_frontend</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="9-the-run-command">9. The RUN command<a href="#9-the-run-command" class="hash-link" aria-label="קישור ישיר אל 9. The RUN command" title="קישור ישיר אל 9. The RUN command" translate="no">​</a></h2>
<p>As we saw earlier, <code>checkout</code> is considered as a <code>step</code> inside a <code>job</code>.
However, most of the steps you&#x27;d want to run would be custom commands you&#x27;d write:
Like <code>pnpm install</code>, <code>pnpm run lint</code>, <code>pnpm run test</code>, <code>pnpm run start</code>, etc.
For that we have the <code>run</code> command, which could be considered as a step inside a job:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> run echo &quot;hello from build</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<p>The <code>run</code> command can actually split into 2 parts, <code>name</code> &amp; <code>command</code>:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 3: Install all project&#x27;s dependencies&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo &quot;hello from build</span><span class="token tag" style="color:#00009f">!</span><span class="token plain">&quot;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="10-executors">10. executors<a href="#10-executors" class="hash-link" aria-label="קישור ישיר אל 10. executors" title="קישור ישיר אל 10. executors" translate="no">​</a></h2>
<p>As you saw in the example above, we had a <code>build</code> job, and a <code>test</code> job.
Both jobs ran the same docker image of cimg/node:18.8.0.
CircleCI tries its best to remove repetitive code from the configuration file, and hence came the <code>executors</code> directive. The <code>executors</code> directive is a root key inside the config.yml file, in which you (the developer) would specify a certain image with its tag (i.e. cimg/node:18.8.0) and then later on for every job that requires it, you can simply say:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">+executors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">nodejs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cimg/node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">+ executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">working_directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/luckylove_frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cimg/node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">18.7.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">+ executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">working_directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/luckylove_frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cimg/node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">18.7.0</span><br></span></code></pre></div></div>
<p>It&#x27;s is much cleaner that way, and more human-readable.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="11-persist_to_workspace--attach_workspace">11. persist_to_workspace &amp; attach_workspace<a href="#11-persist_to_workspace--attach_workspace" class="hash-link" aria-label="קישור ישיר אל 11. persist_to_workspace &amp; attach_workspace" title="קישור ישיר אל 11. persist_to_workspace &amp; attach_workspace" translate="no">​</a></h2>
<p>CircleCI maintains a workspace for you, with a volume of I think 15GB.
Then it gives you the two directives that actively go together, which are:
<code>persist_to_workspace</code> &amp; <code>attach_workspace</code>.The first one says: &quot;hey, at the end of this job? I&#x27;m gonna save the container&#x27;s state and make an image out of it for you guys(1) to use&quot;.
(1) guys = other jobs
From the docs: persist_to_workspace is a special step used to persist a temporary file to be used by another job in the workflow. persist_to_workspace adopts the storage settings from the storage customization controls on the CircleCI web app. If no custom setting is provided, persist_to_workspace defaults to 15 days.</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">persist_to_workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> foo/bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> baz</span><br></span></code></pre></div></div>
<p>After this step completes, the following directories are added to the workspace:</p>
<div class="language-text codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-text codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/dir/foo/bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/dir/baz</span><br></span></code></pre></div></div>
<p>As you see, <code>persist_to_workspace</code> gives you access to 2 more directives: <code>root</code> &amp; <code>paths</code>.
<code>root</code> is the root of the workspace circleci maintains for you, and the <code>path</code> is the path to copy to the workspace.
Here&#x27;s a good example for paths key:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">persist_to_workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/workspace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> target/application.jar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build/*</span><br></span></code></pre></div></div>
<p><code>persist_to_workspace</code> even accepts a name:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">persist_to_workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 5: persist to workspace&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">...</span><br></span></code></pre></div></div>
<p>You could also (NOT RECOMMENDED!) copy everything, including node_modules:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">persist_to_workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .</span><br></span></code></pre></div></div>
<p>And then do:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">attach_workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          at</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> .</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="12-manually-approved-job-a-hold-job">12. Manually Approved Job (A hold job)<a href="#12-manually-approved-job-a-hold-job" class="hash-link" aria-label="קישור ישיר אל 12. Manually Approved Job (A hold job)" title="קישור ישיר אל 12. Manually Approved Job (A hold job)" translate="no">​</a></h2>
<p>If your deployment strategy requires a manual approval step, you can include a hold/approve job within your workflow. A manual approval button will then be available from the workflows map in the CircleCI web app.
Workflows can be configured to wait for manual approval of a job before continuing to the next job. Anyone who has push access to the repository can click the Approval button to continue the workflow. To do this, add a job to the jobs list with the key type: approval. Let’s look at a commented config example.</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt; your config for the build, test1, test2, and deploy jobs &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build-test-and-approval-deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build  </span><span class="token comment" style="color:#999988;font-style:italic"># your custom job from your config, that builds your code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">test1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># your custom job; runs test suite 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># test1 will not run until the `build` job is completed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">test2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># another custom job; runs test suite 2,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># test2 is dependent on the success of job `test1`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt;&lt; A job that will require manual approval in the CircleCI web application.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> approval </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;&lt;&lt; This key-value pair will set your workflow to a status of &quot;On Hold&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># We only run the &quot;hold&quot; job when test2 has succeeded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> test2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># On approval of the `hold` job, any successive job that requires the `hold` job will run.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># In this case, a user is manually triggering the deploy job.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> hold</span><br></span></code></pre></div></div>
<p>The outcome of the above example is that the deploy: job will not run until you click the hold job in the Workflows page of the CircleCI app and then click Approve. In this example the purpose of the hold job is to wait for approval to begin deployment. A job can be approved for up to 90 days after being issued.
Some things to keep in mind when using manual approval in a workflow:</p>
<ul>
<li class="">approval is a special job type that is only available to jobs under the workflow key</li>
<li class="">The hold job must be a unique name not used by any other job.</li>
<li class="">that is, your custom configured jobs, such as build or test1 in the example above wouldn’t be given a type: approval key.</li>
<li class="">The name of the job to hold is arbitrary - it could be wait or pause, for example, as long as the job has a type: approval key in it.</li>
<li class="">All jobs that are to run after a manually approved job must require: the name of that job. Refer to the deploy: job in the above example.</li>
<li class="">Jobs run in the order defined until the workflow processes a job with the type: approval key followed by a job on which it depends.</li>
</ul>
<p>By clicking on the pending job&#x27;s name (build, in the screenshot above), an approval dialog box appears requesting that you approve or cancel the holding job. After approving, the rest of the workflow runs as directed.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="13-storing-artifacts">13. Storing Artifacts<a href="#13-storing-artifacts" class="hash-link" aria-label="קישור ישיר אל 13. Storing Artifacts" title="קישור ישיר אל 13. Storing Artifacts" translate="no">​</a></h2>
<p>This document describes how to work with artifacts on CircleCI. Use artifacts to persist data after a job or pipeline has completed. For example, building documents or other assets, or saving test results for further inspection.</p>
<p><strong>- Artifacts Overview</strong></p>
<p>Artifacts persist data after a job is completed and may be used for storage of the outputs of your build process. For example, when a Java build/test process finishes, the output of the process is saved as a .jar file. CircleCI can store this file as an artifact, keeping it available after the process has finished.
Here&#x27;s how to do that:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">store_artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">package.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">store_artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> public/static/styles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      destination</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">styles</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="14-using-contexts">14. Using Contexts<a href="#14-using-contexts" class="hash-link" aria-label="קישור ישיר אל 14. Using Contexts" title="קישור ישיר אל 14. Using Contexts" translate="no">​</a></h2>
<p>Contexts provide a mechanism for securing and sharing environment variables across projects. The environment variables are defined as name/value pairs and are injected at runtime. This document describes creating and using contexts in CircleCI.
You can create and manage contexts on the Organization Settings page of the CircleCI web app. You must be an organization member to view, create, or edit contexts. After a context has been created, you can use the context key in the workflows section of a project
config.yml file to give any job(s) access to the environment variables associated with the context, as shown in the image below.</p>
<p>Org:</p>
<div class="language-text codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-text codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">Context: my-context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$MY_ENV_VAR = my_value</span><br></span></code></pre></div></div>
<p>Project:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> another</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">docker</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;image</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&lt;version TAG</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># use env var from Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo $MY_ENV_VAR</span><br></span></code></pre></div></div>
<p>Job Output:</p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">echo $MY_ENV_VAR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*******</span><br></span></code></pre></div></div>
<p>Here&#x27;s an example from your code:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build_and_test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> luckylove</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requires</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    executor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    working_directory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ~/luckylove_frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 0: check context variables&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo $TOP_SECRET</span><br></span></code></pre></div></div>
<p>As you can see, I gave the <code>build</code> jobs the context of <code>luckylove</code> only at runtime! At the time of defining it, it had no clue what its context is gonna be.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="15-circleci-cli">15. CircleCI CLI<a href="#15-circleci-cli" class="hash-link" aria-label="קישור ישיר אל 15. CircleCI CLI" title="קישור ישיר אל 15. CircleCI CLI" translate="no">​</a></h2>
<p>The CircleCI command line interface (CLI) brings CircleCI&#x27;s advanced and powerful tools to your terminal. The CLI is supported on cloud and server v3.x+ installations.
The CLI requires installation, so if it&#x27;s not installed for you, head over to google and search &quot;circleci cli&quot;, and run the installation guide.</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="command-1-upgrade-circleci-version">Command 1: upgrade circleci version<a href="#command-1-upgrade-circleci-version" class="hash-link" aria-label="קישור ישיר אל Command 1: upgrade circleci version" title="קישור ישיר אל Command 1: upgrade circleci version" translate="no">​</a></h3>
<p><strong>The command:</strong></p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain"># windows &amp; linux:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># macos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew upgrade circleci</span><br></span></code></pre></div></div>
<br>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="command-2-setup">Command 2: setup<a href="#command-2-setup" class="hash-link" aria-label="קישור ישיר אל Command 2: setup" title="קישור ישיר אל Command 2: setup" translate="no">​</a></h3>
<p><strong>The command:</strong></p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">circleci setup</span><br></span></code></pre></div></div>
<p><strong>Description:</strong></p>
<p>This command will create a <code>.circleci</code> folder inside your user folder, right next to your .ssh folder, and will contain all the cli configurations there. The set up process will prompt you for configuration settings. If you are using the CLI with CircleCI cloud (which you are), use the default CircleCI host.</p>
<br>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="command-3-config-validate">Command 3: config validate<a href="#command-3-config-validate" class="hash-link" aria-label="קישור ישיר אל Command 3: config validate" title="קישור ישיר אל Command 3: config validate" translate="no">​</a></h3>
<p><strong>The command:</strong></p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">circleci config validate</span><br></span></code></pre></div></div>
<p><strong>Description:</strong></p>
<p>Validates that the circleci config you have is valid. Run this command when inside of your <code>.circleci/</code> folder. Using this command, you can avoid pushing additional commits with bad / invalid configuration file. Instead, run a validation for your config file using the CLI locally.</p>
<br>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="command-4-config-process">Command 4: config process<a href="#command-4-config-process" class="hash-link" aria-label="קישור ישיר אל Command 4: config process" title="קישור ישיר אל Command 4: config process" translate="no">​</a></h3>
<p><strong>The command:</strong></p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">circleci config process</span><br></span></code></pre></div></div>
<p><strong>Description:</strong></p>
<p>Running the following command validates your config, but will also your configuration stripped from comment (at the top), and once again WITH the comment (at the bottom), i.e. in its original form. It&#x27;s useful if you&#x27;re using orbs.</p>
<br>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="command-5-local-execute">Command 5: local execute<a href="#command-5-local-execute" class="hash-link" aria-label="קישור ישיר אל Command 5: local execute" title="קישור ישיר אל Command 5: local execute" translate="no">​</a></h3>
<p><strong>The command:</strong></p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">circleci local execute --job JOB_NAME</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_KwDl alert alert--warning"><div class="admonitionHeading_F3Br"><span class="admonitionIcon_zF0T"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_fiQM"><p>As of 2022, circleci doesn&#x27;t support running on Windows</p></div></div>
<p><strong>Description:</strong></p>
<p>The CLI allows you to run a single job from CircleCI on your desktop using Docker. This can only be used to run jobs (not workflows!). The CLI will use Docker to pull down the requirements for the build and then execute your CI steps locally.</p>
<p>Limitations of running jobs locally:</p>
<p>Although running jobs locally with circleci is very helpful, there are some limitations.</p>
<ul>
<li class="">Machine executor: We haven&#x27;t covered this, but basically there&#x27;s a section on circleci called &quot;Execution Environments&quot;, where they tell you that you can execute circleci either inside docker containers (which is what I chose), or you can do so by using a Linux VM. To use docker, we specified the key <code>docker</code> under the name of a job. To use a Linux VM, we need to specify the key <code>machine</code> under the name of a job. So now let&#x27;s go back to the restriction: &quot;With a linux machine You cannot use the machine executor in local jobs. This is because the machine executor requires an extra VM to run its jobs&quot;.</li>
<li class="">Add SSH keys: It is currently not possible to add SSH keys using the add_ssh_keys CLI command.</li>
<li class="">Workflows: The CLI tool does not provide support for running workflows. By nature, workflows leverage running jobs concurrently on multiple machines allowing you to achieve faster, more complex builds. Because the CLI is only running on your machine, it can only run single jobs (which make up parts of a workflow).</li>
<li class="">Caching and online-only Commands: Caching is not currently supported in local jobs. When you have either a save_cache or restore_cache step in your config, circleci will skip them and display a warning. Furthermore, not all commands may work on your local machine as they do online. If a step is not available on a local build you will see an error in the console. For example, running a store_artifacts step locally will not upload artifacts and throw an error.</li>
<li class="">Environment variables: For security reasons, encrypted environment variables configured in the web application will not be imported into local builds. As an alternative, you can specify environment variables to the CLI with the -e flag. See the output of the following command for more information: <code>circleci help build</code>. If you have multiple environment variables, you must use the flag for each variable, for example: <code>circleci build -e VAR1=FOO -e VAR2=BAR</code>.</li>
</ul>
<br>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="command-6-context-management">Command 6: context management<a href="#command-6-context-management" class="hash-link" aria-label="קישור ישיר אל Command 6: context management" title="קישור ישיר אל Command 6: context management" translate="no">​</a></h3>
<ul>
<li class=""><code>create</code>: Create a new context</li>
<li class=""><code>delete</code>: Delete the named context</li>
<li class=""><code>list</code>: List all contexts</li>
<li class=""><code>remove-secret</code>: Remove an environment variable from the named context</li>
<li class=""><code>show</code>: Show a context with all its keys (values will be redacted!)</li>
<li class=""><code>store-secret</code>: Store a new environment variable in the named context</li>
</ul>
<p>The above list include &quot;sub-commands&quot; in the CLI, which would be executed like so:</p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">// Examples:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context create github OrgName contextName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context create contextName --org-id &quot;your-org-id-here&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Command 2: list all contexts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context list &lt;vcs-type&gt; &lt;org-name&gt; [flags]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Examples:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context list bitbucket talkohavy --token 6802</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Command 3: show context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context show bitbucket talkohavy luckylove --token 6802</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Command 4: store a new secret inside a context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context store-secret &lt;vcs-type&gt; &lt;org-name&gt; &lt;context-name&gt; &lt;secret name&gt; [flags]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// By hitting Enter, you&#x27;ll be prompted with:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter secret value and press enter:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Command 5: Remove secret from context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci context remove-secret &lt;vcs-type&gt; &lt;org-name&gt; &lt;context-name&gt; &lt;secret name&gt; [flags]</span><br></span></code></pre></div></div>
<p><strong>The command:</strong></p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">circleci context create</span><br></span></code></pre></div></div>
<p><strong>Description:</strong></p>
<p>A</p>
<br>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="16-skip-following-steps-inside-a-job">16. Skip Following Steps Inside A Job<a href="#16-skip-following-steps-inside-a-job" class="hash-link" aria-label="קישור ישיר אל 16. Skip Following Steps Inside A Job" title="קישור ישיר אל 16. Skip Following Steps Inside A Job" translate="no">​</a></h2>
<p>You can skip the following steps inside a job by using the command:</p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">circleci-agent step halt</span><br></span></code></pre></div></div>
<p>inside of an early step of a job.
It&#x27;s best to wrap that command inside of a wrapper bash/sh file with extra logic of ifs and elses, and then execute that file from within the config.yml as one of the job&#x27;s steps.</p>
<p>• Usage Example:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 1: skip the following steps&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> circleci</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent step halt</span><br></span></code></pre></div></div>
<p>Or a more complex one:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;should skip 2e2e&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        commit_message=$(git log -1 HEAD --pretty=format:%s)</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        echo $commit_message</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        if [[ $commit_message == *&quot;skip-2e2e&quot;* ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          circleci-agent step halt</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        fi</span><br></span></code></pre></div></div>
<p>• Question: &quot;Why not use exit 0 or exit 1?&quot;</p>
<p>Good question! That&#x27;s because &quot;exit 1&quot; would flag the step inside that job as &quot;errored&quot;, and terminology-wise, that not the case. And with &quot;exit 0&quot; only halts the following lines inside a step from being executed, while the following step would be executed just fine. Also note, that &quot;exit1&quot; not only fails the step! It fails the job, and it fails the workflow (as it should!).</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="16-manually-cancel-a-workflow">16. Manually Cancel a Workflow<a href="#16-manually-cancel-a-workflow" class="hash-link" aria-label="קישור ישיר אל 16. Manually Cancel a Workflow" title="קישור ישיר אל 16. Manually Cancel a Workflow" translate="no">​</a></h2>
<p>You can manually cancel a workflow in a way that would present so in the circleci UI.</p>
<p>This could be done by sending a <code>cancel</code> command via a curl request of the following form:</p>
<div class="language-bash codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-bash codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token plain">curl --request POST --url https://circleci.com/api/v2/workflow/$CIRCLE_WORKFLOW_ID/cancel --header &quot;Circle-Token: ${MY_CIRCLE_TOKEN}&quot;</span><br></span></code></pre></div></div>
<p>Notice the use of <code>$CIRCLE_WORKFLOW_ID</code>, which is a built-in env variable that circleci injects (among other env vars), which helps us identify the workflow in progress, as well as providing means for authentication (our API token).</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 0.25: cancel the entire workflow&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;curl -X POST --url https://circleci.com/api/v2/workflow/$CIRCLE_WORKFLOW_ID/cancel -- &quot;Circle-Token: ${MY_CIRCLE_TOKEN}&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">circleci</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agent step halt</span><br></span></code></pre></div></div>
<p>A few things to notice here:</p>
<ul>
<li class="">We are using a token, created in the UI, under the &quot;User Settings&quot; menu, under &quot;Person API Tokens&quot;.</li>
<li class="">We then copied the contents of said token, and created a context variable down at the UI, under the &quot;Organization Settings&quot; menu.</li>
<li class="">In order for the &quot;build&quot; job to recognize the token sitting inside the context, we gave it access to the context within the workflow.</li>
<li class="">Canceling a workflow does not mean that the current job is going to halt, rather than continue to completion. That&#x27;s why the command to <code>cancel a workflow</code> and the command to <code>halt a job</code> usually go together! That&#x27;s why I always put them together. But if you find a reason to cancel a workflow, yet to run a job to its completion, then simply remove the <code>halt a job</code> command.</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="17-caching">17. Caching<a href="#17-caching" class="hash-link" aria-label="קישור ישיר אל 17. Caching" title="קישור ישיר אל 17. Caching" translate="no">​</a></h2>
<p>I just learned that you can use: <code>{{ .Branch }}</code> inside the <code>config.yml</code> to print out the current branch name that you are on. This is a circleci built-in env variable.</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="-saving-cache">• Saving Cache<a href="#-saving-cache" class="hash-link" aria-label="קישור ישיר אל • Saving Cache" title="קישור ישיר אל • Saving Cache" translate="no">​</a></h3>
<p>To save a cache of a file or directory, add the save_cache step to a job in your .circleci/config.yml file:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">save_cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">project/my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dependencies</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">directory</span><br></span></code></pre></div></div>
<p>The path for directories is relative to the <code>working_directory</code> of your job. You can specify an absolute path if you choose.</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="-restoring-cache">• Restoring Cache<a href="#-restoring-cache" class="hash-link" aria-label="קישור ישיר אל • Restoring Cache" title="קישור ישיר אל • Restoring Cache" translate="no">​</a></h3>
<p>CircleCI restores caches in the order of keys listed in the restore_cache step. Each cache key is namespaced to the project and retrieval is prefix-matched. The cache is restored from the first matching key. If there are multiple matches, the most recently generated cache is used.</p>
<p>In the example below, two keys are provided</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">restore_cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># name: Restore NPM Package Cache # &lt;optional key&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Find a cache corresponding to this specific package-lock.json checksum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># when this file is changed, this key will fail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> v1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">npm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deps</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> checksum &quot;package</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock.json&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Find the most recently generated cache used from any branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> v1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">npm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">deps</span><span class="token punctuation" style="color:#393A34">-</span><br></span></code></pre></div></div>
<p>Because the second key is less specific than the first, it is more likely there will be differences between the current state and the most recently generated cache. When a dependency tool runs, it would discover outdated dependencies and update them. This is referred to as a partial cache restore.</p>
<p>Each line in the keys: list manages one cache (each line does not correspond to its own cache). The list of keys (<code>v1-npm-deps-{{ checksum &quot;package-lock.json&quot; }}</code> and <code>v1-npm-deps-</code>), in this example, represent a single cache. When it is time to restore the cache, CircleCI first validates the cache based on the first (and most specific) key, and then steps through the other keys looking for any other cache key changes.</p>
<p>The first key concatenates the checksum of package-lock.json file into the string <code>v1-npm-deps-</code>. If this file changed in your commit, CircleCI would see a new cache key.</p>
<p>The next key does not have a dynamic component to it. It is simply a static string: <code>v1-npm-deps-</code>. If you would like to invalidate your cache manually, you can bump v1 to v2 in your .circleci/config.yml file. In this case, you would now have a new cache key v2-npm-deps, which triggers the storing of a new cache.</p>
<p>A full example:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">restore_cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restore NPM Package Cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> npm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">packages</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> checksum &quot;package</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock.lock&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install Dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">save_cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Save Npm Package Cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> yarn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">packages</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> checksum &quot;package</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock.lock&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .npm/cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .npm/unplugged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#...</span><br></span></code></pre></div></div>
<p>Or...</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">restore_cache_and_install</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 1: enable corepack&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sudo corepack enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">restore_cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Restore pnpm cache folders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Branch </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> checksum &quot;pnpm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock.yaml&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Branch </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 2: Remove prepare script&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm pkg delete scripts.prepare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step 3: Install project dependencies&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pnpm install </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shamefully</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hoist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  save_cache_node_modules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">save_cache</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Step X: save cache folders&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> node</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">v2</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> .Branch </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> checksum &quot;pnpm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lock.yaml&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./projects/e2e/node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./packages/api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">server/node_modules</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="18-multi-line-run-command">18. Multi-Line Run Command<a href="#18-multi-line-run-command" class="hash-link" aria-label="קישור ישיר אל 18. Multi-Line Run Command" title="קישור ישיר אל 18. Multi-Line Run Command" translate="no">​</a></h2>
<p>Each <code>run</code> declaration represents a new shell. It is possible to specify a multi-line command, each line of which will be run in the same shell:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      echo Running test</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      mkdir -p /tmp/test-results</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      make test</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="19-the-when-attribute">19. The When Attribute<a href="#19-the-when-attribute" class="hash-link" aria-label="קישור ישיר אל 19. The When Attribute" title="קישור ישיר אל 19. The When Attribute" translate="no">​</a></h2>
<p>By default, CircleCI will execute job steps one at a time, in the order that they are defined in config.yml, until a step fails (returns a non-zero exit code). After a command fails, no further job steps will be executed.</p>
<p>Adding the when attribute to a job step allows you to override this default behavior, and selectively run or skip steps depending on the status of the job.</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="-value-1-on_success">• Value 1: on_success<a href="#-value-1-on_success" class="hash-link" aria-label="קישור ישיר אל • Value 1: on_success" title="קישור ישיר אל • Value 1: on_success" translate="no">​</a></h3>
<p>The default value of on_success means that the step will run only if all of the previous steps have been successful (returned exit code 0).</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="-value-2-always">• Value 2: always<a href="#-value-2-always" class="hash-link" aria-label="קישור ישיר אל • Value 2: always" title="קישור ישיר אל • Value 2: always" translate="no">​</a></h3>
<p>A value of always means that the step will run regardless of the exit status of previous steps. This is useful if you have a task that you want to run regardless of whether the previous steps are successful or not. For example, you might have a job step that needs to upload logs or code-coverage data somewhere.</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="-value-3-on_fail">• Value 3: on_fail<a href="#-value-3-on_fail" class="hash-link" aria-label="קישור ישיר אל • Value 3: on_fail" title="קישור ישיר אל • Value 3: on_fail" translate="no">​</a></h3>
<p>A value of on_fail means that the step will run only if one of the preceding steps has failed (returns a non-zero exit code). It is common to use on_fail if you want to store some diagnostic data to help debug test failures, or to run custom notifications about the failure, such as sending emails or triggering alerts in chat-rooms.</p>
<h3 class="anchor anchorTargetStickyNavbar_HzJc" id="-specials-on_store_artifacts--store_test_results">• Specials: on_store_artifacts &amp; store_test_results<a href="#-specials-on_store_artifacts--store_test_results" class="hash-link" aria-label="קישור ישיר אל • Specials: on_store_artifacts &amp; store_test_results" title="קישור ישיר אל • Specials: on_store_artifacts &amp; store_test_results" translate="no">​</a></h3>
<p>Note: Some steps, such as store_artifacts and store_test_results will always run, even if a step has failed (returned a non-zero exit code) previously. The when attribute, store_artifacts and store_test_results are not run if the job has been killed by a cancel request or has reached the runtime timeout limit.</p>
<h2 class="anchor anchorTargetStickyNavbar_HzJc" id="20-the-when-step">20. The When Step<a href="#20-the-when-step" class="hash-link" aria-label="קישור ישיר אל 20. The When Step" title="קישור ישיר אל 20. The When Step" translate="no">​</a></h2>
<p>Entirely different thing from the when attribute!!</p>
<p>Look at the structure:</p>
<div class="language-yaml codeBlockContainer_t5rX theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_ebpF"><pre tabindex="0" class="prism-code language-yaml codeBlock_HcQS thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Ed7A"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># conditional steps may also be defined in `commands:`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">job_with_optional_custom_checkout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">custom_checkout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">machine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2004</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">202107</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">02</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">when</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;&lt;parameters.custom_checkout</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo &quot;my custom checkout&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">unless</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;&lt;parameters.custom_checkout</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build-test-deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">job_with_optional_custom_checkout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">custom_checkout</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;any non-empty string is truthy&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> job_with_optional_custom_checkout</span><br></span></code></pre></div></div>
<p>The <code>when</code> step is a conditional step which consists of a step with the key <code>when</code> or <code>unless</code>. Under the <code>when</code> key are the (required!) sub-keys <code>condition</code> and <code>steps</code>. The purpose of the when step is customizing commands and job configuration to run on custom conditions (determined at config-compile time) that are checked before a workflow runs.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_b5tu"><a href="https://github.com/talkohavy/guides/docs/programming/devops/circleci/circleci.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_J7lz" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ערוך דף זה</a></div><div class="col lastUpdated_Fgxj"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="רשימת דוקומנטאציה"></nav></div></div><div class="col col--3"><div class="tableOfContents_M5x2 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#4-docker--docker-images" class="table-of-contents__link toc-highlight">4. Docker &amp; Docker Images</a></li><li><a href="#5-checkout" class="table-of-contents__link toc-highlight">5. Checkout</a></li><li><a href="#6-jobs--steps" class="table-of-contents__link toc-highlight">6. Jobs &amp; Steps</a></li><li><a href="#7-workflows" class="table-of-contents__link toc-highlight">7. Workflows</a></li><li><a href="#8-working-directory" class="table-of-contents__link toc-highlight">8. Working Directory</a></li><li><a href="#9-the-run-command" class="table-of-contents__link toc-highlight">9. The RUN command</a></li><li><a href="#10-executors" class="table-of-contents__link toc-highlight">10. executors</a></li><li><a href="#11-persist_to_workspace--attach_workspace" class="table-of-contents__link toc-highlight">11. persist_to_workspace &amp; attach_workspace</a></li><li><a href="#12-manually-approved-job-a-hold-job" class="table-of-contents__link toc-highlight">12. Manually Approved Job (A hold job)</a></li><li><a href="#13-storing-artifacts" class="table-of-contents__link toc-highlight">13. Storing Artifacts</a></li><li><a href="#14-using-contexts" class="table-of-contents__link toc-highlight">14. Using Contexts</a></li><li><a href="#15-circleci-cli" class="table-of-contents__link toc-highlight">15. CircleCI CLI</a><ul><li><a href="#command-1-upgrade-circleci-version" class="table-of-contents__link toc-highlight">Command 1: upgrade circleci version</a></li><li><a href="#command-2-setup" class="table-of-contents__link toc-highlight">Command 2: setup</a></li><li><a href="#command-3-config-validate" class="table-of-contents__link toc-highlight">Command 3: config validate</a></li><li><a href="#command-4-config-process" class="table-of-contents__link toc-highlight">Command 4: config process</a></li><li><a href="#command-5-local-execute" class="table-of-contents__link toc-highlight">Command 5: local execute</a></li><li><a href="#command-6-context-management" class="table-of-contents__link toc-highlight">Command 6: context management</a></li></ul></li><li><a href="#16-skip-following-steps-inside-a-job" class="table-of-contents__link toc-highlight">16. Skip Following Steps Inside A Job</a></li><li><a href="#16-manually-cancel-a-workflow" class="table-of-contents__link toc-highlight">16. Manually Cancel a Workflow</a></li><li><a href="#17-caching" class="table-of-contents__link toc-highlight">17. Caching</a><ul><li><a href="#-saving-cache" class="table-of-contents__link toc-highlight">• Saving Cache</a></li><li><a href="#-restoring-cache" class="table-of-contents__link toc-highlight">• Restoring Cache</a></li></ul></li><li><a href="#18-multi-line-run-command" class="table-of-contents__link toc-highlight">18. Multi-Line Run Command</a></li><li><a href="#19-the-when-attribute" class="table-of-contents__link toc-highlight">19. The When Attribute</a><ul><li><a href="#-value-1-on_success" class="table-of-contents__link toc-highlight">• Value 1: on_success</a></li><li><a href="#-value-2-always" class="table-of-contents__link toc-highlight">• Value 2: always</a></li><li><a href="#-value-3-on_fail" class="table-of-contents__link toc-highlight">• Value 3: on_fail</a></li><li><a href="#-specials-on_store_artifacts--store_test_results" class="table-of-contents__link toc-highlight">• Specials: on_store_artifacts &amp; store_test_results</a></li></ul></li><li><a href="#20-the-when-step" class="table-of-contents__link toc-highlight">20. The When Step</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/guides/he/docs/programming/">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_sI6Z"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_sI6Z"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_sI6Z"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/guides/he/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_sI6Z"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>