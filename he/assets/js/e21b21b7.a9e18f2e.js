"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[3381],{9855:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"programming/devops/circleci/using-contexts","title":"Using Contexts","description":"1. What is a Context?","source":"@site/docs/programming/devops/circleci/using-contexts.md","sourceDirName":"programming/devops/circleci","slug":"/programming/devops/circleci/using-contexts","permalink":"/guides/he/docs/programming/devops/circleci/using-contexts","draft":false,"unlisted":false,"editUrl":"https://github.com/talkohavy/guides/docs/programming/devops/circleci/using-contexts.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mySidebar","previous":{"title":"- Getting Started","permalink":"/guides/he/docs/programming/devops/circleci/getting-started"},"next":{"title":"- Data Persistence","permalink":"/guides/he/docs/programming/devops/circleci/data-persistence"}}');var i=t(5813),s=t(3546);const c={},r="Using Contexts",a={},d=[{value:"1. What is a Context?",id:"1-what-is-a-context",level:2},{value:"2. Create a context",id:"2-create-a-context",level:2},{value:"3. Project Restriction",id:"3-project-restriction",level:2},{value:"4. Add Environment variables",id:"4-add-environment-variables",level:2},{value:"5. Referencing a context in the <code>config.yaml</code>",id:"5-referencing-a-context-in-the-configyaml",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"using-contexts",children:"Using Contexts"})}),"\n",(0,i.jsx)(n.h2,{id:"1-what-is-a-context",children:"1. What is a Context?"}),"\n",(0,i.jsxs)(n.p,{children:["Contexts provide a ",(0,i.jsx)(n.strong,{children:"mechanism for securing and sharing environment variables"})," across projects. The environment variables are defined as name/value pairs. ",(0,i.jsx)(n.strong,{children:"The environment variables are injected at runtime"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["This document describes creating and using contexts in CircleCI. You can create and manage contexts on the ",(0,i.jsx)(n.strong,{children:"Organization Settings"})," page of the CircleCI web app. You must be an organization member to view, create, or edit contexts. After a context has been created, you can use the ",(0,i.jsx)(n.code,{children:"context"})," key in the workflows section of a project ",(0,i.jsx)(n.code,{children:"config.yml"})," file to give any job(s) access to the environment variables associated with the context."]}),"\n",(0,i.jsx)(n.h2,{id:"2-create-a-context",children:"2. Create a context"}),"\n",(0,i.jsxs)(n.p,{children:["In CircleCI web app, go to the ",(0,i.jsx)(n.strong,{children:"Organization Settings"})," page. There, choose ",(0,i.jsx)(n.strong,{children:"Contexts"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"This page will show you a list of all existing contexts, and a button that allows you to create a new one."}),"\n",(0,i.jsxs)(n.p,{children:["When creating a new one, you'll need to provide a ",(0,i.jsx)(n.strong,{children:"name"}),". That name will be used in your ",(0,i.jsx)(n.code,{children:"config.yaml"})," file."]}),"\n",(0,i.jsx)(n.h2,{id:"3-project-restriction",children:"3. Project Restriction"}),"\n",(0,i.jsxs)(n.p,{children:["By default, a ",(0,i.jsx)(n.code,{children:"context"})," with no restrictions is available to all projects."]}),"\n",(0,i.jsxs)(n.p,{children:["You have an option in the web app to choose repos that are allowed to use this ",(0,i.jsx)(n.code,{children:"context"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"4-add-environment-variables",children:"4. Add Environment variables"}),"\n",(0,i.jsxs)(n.p,{children:["Inside a ",(0,i.jsx)(n.code,{children:"context"}),", you'll have a button for adding a new environment variable."]}),"\n",(0,i.jsx)(n.p,{children:"The format, as mentioned, is key/value."}),"\n",(0,i.jsxs)(n.h2,{id:"5-referencing-a-context-in-the-configyaml",children:["5. Referencing a context in the ",(0,i.jsx)(n.code,{children:"config.yaml"})]}),"\n",(0,i.jsx)(n.p,{children:"Here's an example from your code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".circleci/config.yml"',children:"version: 2.1\n\nexecutors:\n  nodejs-executor:\n    docker:\n      - image: cimg/node:22.16.0\n    resource_class: large\n\n# -----------\n# Define Jobs\n# -----------\njobs:\n  # Job name\n\xa0 build:\n\xa0 \xa0 executor: nodejs-executor\n\xa0 \xa0 working_directory: ~/app\n    # list of steps\n\xa0 \xa0 steps:\n\xa0 \xa0 \xa0 - run:\n\xa0 \xa0 \xa0 \xa0 \xa0 name: \"Step: check context variables\"\n\xa0 \xa0 \xa0 \xa0 \xa0 command: echo $ENV_VAR_FROM_CONTEXT\n\n# ----------------\n# Define Workflows\n# ----------------\nworkflows:\n  # Workflow name\n\xa0 'Build & Test':\n    # List of jobs\n\xa0 \xa0 jobs:\n\xa0 \xa0 \xa0 - build:\n\xa0 \xa0 \xa0 \xa0 \xa0 context: luckylove\n"})}),"\n",(0,i.jsx)(n.p,{children:"Let's break it down:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["When we define ",(0,i.jsx)(n.code,{children:"job"})," ",(0,i.jsx)(n.code,{children:"A"}),", we don't give it a ",(0,i.jsx)(n.code,{children:"context"})," yet."]}),"\n",(0,i.jsxs)(n.li,{children:["When we use a ",(0,i.jsx)(n.code,{children:"job"})," in a ",(0,i.jsx)(n.code,{children:"workflow"}),", we can then apply the ",(0,i.jsx)(n.code,{children:"context"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Why like this?"}),"\n",(0,i.jsx)(n.p,{children:"It would make sense to define a job once, and then run it once with context A, and then once again with context B. Therefore, we do not assign context on a job, only on a job invocation."}),"\n",(0,i.jsxs)(n.p,{children:["In short, ",(0,i.jsx)(n.code,{children:"contexts"})," are being applied to ",(0,i.jsx)(n.code,{children:"jobs"})," only at runtime! At the time of definition, the ",(0,i.jsx)(n.code,{children:"job"})," had no clue what its ",(0,i.jsx)(n.code,{children:"context"})," is going to be."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},3546:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>r});var o=t(9729);const i={},s=o.createContext(i);function c(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);