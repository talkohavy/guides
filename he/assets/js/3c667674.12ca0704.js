"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[5807],{4090:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"programming/socket-io/under-the-hood-engine-io","title":"What Engine.IO brings to the table?","description":"1. Handshake","source":"@site/docs/programming/socket-io/under-the-hood-engine-io.md","sourceDirName":"programming/socket-io","slug":"/programming/socket-io/under-the-hood-engine-io","permalink":"/guides/he/docs/programming/socket-io/under-the-hood-engine-io","draft":false,"unlisted":false,"editUrl":"https://github.com/talkohavy/guides/docs/programming/socket-io/under-the-hood-engine-io.md","tags":[],"version":"current","frontMatter":{},"sidebar":"mySidebar","previous":{"title":"- SocketIO vs WebSockets","permalink":"/guides/he/docs/programming/socket-io/socketio-vs-websockets"},"next":{"title":"- Under the Hood - Socket.IO","permalink":"/guides/he/docs/programming/socket-io/under-the-hood-socket-io"}}');var s=t(5813),o=t(3546);const r={},c="What Engine.IO brings to the table?",a={},h=[{value:"1. Handshake",id:"1-handshake",level:2},{value:"2. Upgrade mechanism",id:"2-upgrade-mechanism",level:2},{value:"3. Disconnection detection",id:"3-disconnection-detection",level:2},{value:"4. Heartbeat mechanism",id:"4-heartbeat-mechanism",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"what-engineio-brings-to-the-table",children:"What Engine.IO brings to the table?"})}),"\n",(0,s.jsx)(n.h2,{id:"1-handshake",children:"1. Handshake"}),"\n",(0,s.jsx)(n.p,{children:"At the beginning of the Engine.IO connection, the server sends some information:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "sid": "FSDjX-WRwSA4zTZMALqx",\n  "upgrades": ["websocket"],\n  "pingInterval": 25000,\n  "pingTimeout": 20000\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.code,{children:"sid"})," is the ID of the session, it must be included in the ",(0,s.jsx)(n.code,{children:"sid"})," query parameter in all subsequent HTTP requests"]}),"\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.code,{children:"upgrades"}),' array contains the list of all "better" transports that are supported by the server']}),"\n",(0,s.jsxs)(n.li,{children:["the ",(0,s.jsx)(n.code,{children:"pingInterval"})," and ",(0,s.jsx)(n.code,{children:"pingTimeout"})," values are used in the ",(0,s.jsx)(n.a,{href:"#heartbeat-mechanism",children:"heartbeat mechanism"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"2-upgrade-mechanism",children:"2. Upgrade mechanism"}),"\n",(0,s.jsx)(n.p,{children:"By default, the client establishes the connection with the HTTP long-polling transport."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"But, why?"})}),"\n",(0,s.jsxs)(n.p,{children:["While WebSocket is clearly the best way to establish a bidirectional communication, experience has shown that ",(0,s.jsx)(n.strong,{children:"it is not always possible to establish a WebSocket connection"}),", due to ",(0,s.jsx)(n.strong,{children:"corporate proxies, personal firewall, antivirus software"}),"..."]}),"\n",(0,s.jsxs)(n.p,{children:["From the user perspective, ",(0,s.jsx)(n.strong,{children:"an unsuccessful WebSocket connection can translate in up to 10 seconds of waiting"})," for the realtime application to begin exchanging data. ",(0,s.jsx)(n.strong,{children:"This hurts user experience"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["To summarize, ",(0,s.jsx)(n.strong,{children:"Engine.IO focuses on reliability and user experience first"}),", and marginal potential UX improvements and increased server performance second."]}),"\n",(0,s.jsx)(n.p,{children:"To upgrade, the client will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ensure its outgoing buffer is empty"}),"\n",(0,s.jsx)(n.li,{children:"put the current transport in read-only mode"}),"\n",(0,s.jsx)(n.li,{children:"try to establish a connection with the other transport"}),"\n",(0,s.jsx)(n.li,{children:"if successful, close the first transport"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"3-disconnection-detection",children:"3. Disconnection detection"}),"\n",(0,s.jsx)(n.p,{children:"The Engine.IO connection is considered as closed when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"one HTTP request (either GET or POST) fails (for example, when the server is shutdown)"}),"\n",(0,s.jsx)(n.li,{children:"the WebSocket connection is closed (for example, when the user closes the tab in its browser)"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"socket.disconnect()"})," is called on the server-side or on the client-side"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There is also a heartbeat mechanism which checks that the connection between the server and the client is still up and running."}),"\n",(0,s.jsx)(n.h2,{id:"4-heartbeat-mechanism",children:"4. Heartbeat mechanism"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["At a given interval (the ",(0,s.jsx)(n.code,{children:"pingInterval"})," value sent in the handshake) the server sends a PING packet."]}),"\n",(0,s.jsxs)(n.li,{children:["The client has a few seconds (the ",(0,s.jsx)(n.code,{children:"pingTimeout"})," value) to send a PONG packet back."]}),"\n",(0,s.jsx)(n.li,{children:"If the server does not receive a PONG packet back, it will consider that the connection is closed."}),"\n",(0,s.jsxs)(n.li,{children:["Conversely, if the client does not receive a PING packet within ",(0,s.jsx)(n.code,{children:"pingInterval + pingTimeout"}),", it will consider the connection as closed."]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},3546:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var i=t(9729);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);