"use strict";(self.webpackChunkdocusaurus_guides=self.webpackChunkdocusaurus_guides||[]).push([[2544],{7132:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var s=i(6070),t=i(5710);const o={},a="How to publish your NPM Package",c={id:"programming/npm",title:"How to publish your NPM Package",description:"0. TLDR",source:"@site/docs/programming/npm.md",sourceDirName:"programming",slug:"/programming/npm",permalink:"/guides/he/docs/programming/npm",draft:!1,unlisted:!1,editUrl:"https://github.com/talkohavy/guides/docs/programming/npm.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"- Node",permalink:"/guides/he/docs/programming/node"},next:{title:"- Regex",permalink:"/guides/he/docs/programming/regex"}},r={},l=[{value:"0. TLDR",id:"0-tldr",level:2},{value:"- A. Init a project",id:"--a-init-a-project",level:3},{value:"- B. Connect project to GitHub",id:"--b-connect-project-to-github",level:3},{value:"- C. Add some content to",id:"--c-add-some-content-to",level:3},{value:"- D. Create an .npmrc file",id:"--d-create-an-npmrc-file",level:3},{value:"- E. create an .npmignore",id:"--e-create-an-npmignore",level:3},{value:"- F. Create a build.config.js file",id:"--f-create-a-buildconfigjs-file",level:3},{value:"- G. install Changesets/cli",id:"--g-install-changesetscli",level:3},{value:"- H. Edit your package.json",id:"--h-edit-your-packagejson",level:3},{value:"- I. Your new workflow",id:"--i-your-new-workflow",level:3},{value:"1. Init a project package.json",id:"1-init-a-project-packagejson",level:2},{value:"2. Connect project to GitHub",id:"2-connect-project-to-github",level:2},{value:"3. Add some content to the Package",id:"3-add-some-content-to-the-package",level:2},{value:"4. Develop a build process",id:"4-develop-a-build-process",level:2},{value:"5. npm login, npm logout, .npmrc &amp; .npmignore",id:"5-npm-login-npm-logout-npmrc--npmignore",level:2},{value:"- A. npm login &amp; .npmrc",id:"--a-npm-login--npmrc",level:3},{value:"- B. npm logout",id:"--b-npm-logout",level:3},{value:"- C. .npmignore",id:"--c-npmignore",level:3},{value:"- D. npm login Deep Dive",id:"--d-npm-login-deep-dive",level:3},{value:"6. Versioning",id:"6-versioning",level:2},{value:"7. The role of package.json",id:"7-the-role-of-packagejson",level:2},{value:"- A. <strong>REQUIRED</strong> keys within your <code>package.json</code>",id:"--a-required-keys-within-your-packagejson",level:3},{value:"- B. <strong>IMPORTANT</strong> keys inside your <code>package.json</code>",id:"--b-important-keys-inside-your-packagejson",level:3},{value:"- C. <strong>Nice to have</strong> keys inside your <code>package.json</code>",id:"--c-nice-to-have-keys-inside-your-packagejson",level:3},{value:"8. Publishing a package to an npm registry",id:"8-publishing-a-package-to-an-npm-registry",level:2},{value:"9. A publish&#39;s output - Deep Dive Strategy",id:"9-a-publishs-output---deep-dive-strategy",level:2},{value:"- A. A second package.json",id:"--a-a-second-packagejson",level:3},{value:"- B. A README.md file",id:"--b-a-readmemd-file",level:3},{value:"- C. main, types &amp; exports pointing",id:"--c-main-types--exports-pointing",level:3},{value:"- D. A complete build process",id:"--d-a-complete-build-process",level:3},{value:"- E. The publish command as a script",id:"--e-the-publish-command-as-a-script",level:3},{value:"10. Typescript Types",id:"10-typescript-types",level:2},{value:"- A. Emitting Pure Javascript",id:"--a-emitting-pure-javascript",level:3},{value:"- B. Emitting .js &amp; .d.ts files",id:"--b-emitting-js--dts-files",level:3},{value:"- C. Using ONLY .ts files",id:"--c-using-only-ts-files",level:3},{value:"11. Auto-Completion &amp; Auto-Suggestion",id:"11-auto-completion--auto-suggestion",level:2},{value:"12. Versioning Helper - Changesets/cli",id:"12-versioning-helper---changesetscli",level:2},{value:"- A. Getting Started",id:"--a-getting-started",level:3},{value:"- B. Add new scripts to package.json",id:"--b-add-new-scripts-to-packagejson",level:3},{value:"- C. Add copy changeset to your copy flow",id:"--c-add-copy-changeset-to-your-copy-flow",level:3},{value:"- D. Versioning Flow - How to use",id:"--d-versioning-flow---how-to-use",level:3},{value:"Step 1: Make changes &amp; commit them",id:"step-1-make-changes--commit-them",level:4},{value:"Step 2: Run the changeset ADD command",id:"step-2-run-the-changeset-add-command",level:4},{value:"Step 3: Run the changeset STATUS command",id:"step-3-run-the-changeset-status-command",level:4},{value:"Step 4: Run the changeset VERSION command",id:"step-4-run-the-changeset-version-command",level:4},{value:"Step 5: Run the changeset PUBLISH command",id:"step-5-run-the-changeset-publish-command",level:4},{value:"13. Finalize Process - test &amp; build",id:"13-finalize-process---test--build",level:2},{value:"999. Check locally using <code>pnpm link --global</code>",id:"999-check-locally-using-pnpm-link---global",level:2},{value:"\u2022 Step 1: Run <code>pnpm link</code> on the to-be-published package",id:"-step-1-run-pnpm-link-on-the-to-be-published-package",level:3},{value:"\u2022 Step 2: Run <code>pnpm link pkg-name</code> on the tester project",id:"-step-2-run-pnpm-link-pkg-name-on-the-tester-project",level:3}];function d(e){const n={admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"how-to-publish-your-npm-package",children:"How to publish your NPM Package"}),"\n",(0,s.jsx)(n.h2,{id:"0-tldr",children:"0. TLDR"}),"\n",(0,s.jsx)(n.h3,{id:"--a-init-a-project",children:"- A. Init a project"}),"\n",(0,s.jsx)(n.p,{children:"Open terminal, create a folder, give it a meaningful name, and then run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm init\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or if it should be scoped:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm init --scope=talkohavy\n"})}),"\n",(0,s.jsx)(n.h3,{id:"--b-connect-project-to-github",children:"- B. Connect project to GitHub"}),"\n",(0,s.jsx)(n.p,{children:"This step is mandatory. Every npm package needs to be connected to a remote git repo."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"git remote add origin git@github.com:talkohavy/<name>.git\ngit push -u origin master\n"})}),"\n",(0,s.jsx)(n.h3,{id:"--c-add-some-content-to",children:"- C. Add some content to"}),"\n",(0,s.jsx)(n.p,{children:"Here are some good options:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["An ",(0,s.jsx)(n.code,{children:"src"})," folder with an ",(0,s.jsx)(n.code,{children:"index.js"})]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.strong,{children:"_test_"})," folder"]}),"\n",(0,s.jsx)(n.li,{children:"A README.md file"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"--d-create-an-npmrc-file",children:"- D. Create an .npmrc file"}),"\n",(0,s.jsxs)(n.p,{children:["Create an ",(0,s.jsx)(n.code,{children:".npmrc"})," file in the root project."]}),"\n",(0,s.jsx)(n.p,{children:"Its contents should be:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"registry=https://registry.example.com/\n//registry.npmjs.org/:_authToken=npm_some-long-hash\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You'll of course need to create an ",(0,s.jsx)(n.strong,{children:"access token"})," on npm's website, under your profile. The token always starts with \"npm_\", so it's easy to recognize."]}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:["Make sure to NOT commit the ",(0,s.jsx)(n.code,{children:".npmrc"})," file! The token is highly sensitive!",(0,s.jsx)(n.br,{}),"\n","You must add it to your ",(0,s.jsx)(n.code,{children:".gitignore"}),"!"]})}),"\n",(0,s.jsx)(n.h3,{id:"--e-create-an-npmignore",children:"- E. create an .npmignore"}),"\n",(0,s.jsxs)(n.p,{children:["At the root of your project create am ",(0,s.jsx)(n.code,{children:".npmignore"})," file.",(0,s.jsx)(n.br,{}),"\n","Inside it put:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:".changeset/\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["When we'll create a ",(0,s.jsx)(n.code,{children:"dist"})," folder, we will cd into it, and run the publish command from there. When we do, we will use ",(0,s.jsx)(n.code,{children:"changeset"}),"'s publish command, which checks the ",(0,s.jsx)(n.code,{children:"config.json"})," file under ",(0,s.jsx)(n.code,{children:".changeset/"})," folder, so we need to copy it into our dist. However, we don't want to include it in our published files, so we exclude it here."]})}),"\n",(0,s.jsx)(n.h3,{id:"--f-create-a-buildconfigjs-file",children:"- F. Create a build.config.js file"}),"\n",(0,s.jsxs)(n.p,{children:["This fil will serve as your ",(0,s.jsx)(n.code,{children:"build"})," script.",(0,s.jsx)(n.br,{}),"\n","At the root of your project, create a ",(0,s.jsx)(n.code,{children:"build.config.js"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import { execSync } from 'child_process';\nimport fs, { cpSync } from 'fs';\n\n/**\n * @typedef {{\n *   main: string,\n *   types: string,\n *   private?: string | boolean,\n *   scripts?: Record<string, string>,\n *   publishConfig: {\n *     access: string\n *   },\n * }} PackageJson\n */\n\nconst outDirName = 'dist';\n\nbuildPackageConfig();\n\nasync function buildPackageConfig() {\n  cleanDistDirectory();\n\n  buildWithTsc();\n\n  copyReadmeFile();\n\n  copyChangesetDirectory();\n\n  copyNpmIgnore();\n\n  copyAndManipulatePackageJsonFile();\n\n  console.log('DONE !!!');\n}\n\nfunction cleanDistDirectory() {\n  console.log('- Step 1: clear the dist directory');\n  execSync('rm -rf dist');\n}\n\nfunction buildWithTsc() {\n  console.log('- Step 2: build with vite');\n  execSync('tsc -p ./tsconfig.build.json');\n}\n\nfunction copyReadmeFile() {\n  console.log('- Step 3: copy the README.md file');\n  const readStreamReadmeMd = fs.createReadStream('./README.md');\n  const writeStreamReadmeMd = fs.createWriteStream(`./${outDirName}/README.md`);\n  readStreamReadmeMd.pipe(writeStreamReadmeMd);\n}\n\nfunction copyAndManipulatePackageJsonFile() {\n  console.log('- Step 4: copy & manipulate the package.json file');\n  // Step 1: get the original package.json file\n  /** @type {PackageJson} */\n  const packageJson = JSON.parse(fs.readFileSync('./package.json').toString());\n\n  // Step 2: Remove all scripts\n  delete packageJson.scripts;\n  console.log('-- deleted `scripts` key');\n\n  // Step 3: Change from private to public\n  delete packageJson.private;\n  packageJson.publishConfig.access = 'public';\n  console.log('-- changed from private to public');\n  console.log('-- changed publishConfig access to public');\n\n  // Step 4: remove 'outDirName/' from \"main\" & \"types\"\n  packageJson.main = packageJson.main.replace(`${outDirName}/`, '');\n  packageJson.types = packageJson.types.replace(`${outDirName}/`, '');\n\n  // Step 5: create new package.json file in the output folder\n  fs.writeFileSync(`./${outDirName}/package.json`, JSON.stringify(packageJson));\n  console.log('-- package.json file written successfully!');\n}\n\nfunction copyChangesetDirectory() {\n  console.log('- Step 5: copy the .changeset directory');\n  cpSync('.changeset', `${outDirName}/.changeset`, { recursive: true });\n}\n\nfunction copyNpmIgnore() {\n  console.log('- Step 6: copy the .npmignore file');\n  cpSync('.npmignore', `${outDirName}/.npmignore`);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"--g-install-changesetscli",children:"- G. install Changesets/cli"}),"\n",(0,s.jsxs)(n.p,{children:["The flow of versioning is made easy with a tool like ",(0,s.jsx)(n.code,{children:"changesets/cli"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Install it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @changesets/cli\n"})}),"\n",(0,s.jsx)(n.p,{children:"Init it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm changeset init\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Change the content of ",(0,s.jsx)(n.code,{children:".changeset/config.json"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"{4,7-8} showLineNumbers",children:'{\n  "$schema": "https://unpkg.com/@changesets/config@3.0.2/schema.json",\n  "changelog": "@changesets/cli/changelog",\n  "commit": true,\n  "fixed": [],\n  "linked": [],\n  "access": "public",\n  "baseBranch": "master",\n  "updateInternalDependencies": "patch",\n  "ignore": []\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Add the scripts:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "clean": "rm -rf node_modules",\n    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",\n    "format-check": "prettier . --check --config .prettierrc.mjs --ignore-path .prettierignore",\n    "format": "prettier . --write --log-level silent --config .prettierrc.json --ignore-path .prettierignore",\n    "test": "node --test",\n    "build": "node build.config.js",\n    "cs-add": "pnpm changeset add",\n    "cs-bump": "npm run test && pnpm changeset version && npm run cs-bump-reset-format-commit",\n    "cs-bump-reset-format-commit": "git reset head~1 && npm run format && git add . && git commit -m \'RELEASING: Releasing 1 package(s)\'",\n    "cs-status": "pnpm changeset status --verbose",\n    "cs-publish": "pnpm run build && cd dist && pnpm changeset publish",\n    "prepublishOnly": "npm run build"\n  },\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"--h-edit-your-packagejson",children:"- H. Edit your package.json"}),"\n",(0,s.jsxs)(n.p,{children:["Change these keys in your ",(0,s.jsx)(n.code,{children:"package.json"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:"{3,6-7,9-11} showLineNumbers",children:'{\n  "name": "@talkohavy/dashboard",\n  "private": true,\n  "version": "0.0.0",\n  "type": "module",\n  "main": "dist/main.js",\n  "types": "dist/main.d.ts",\n  "scripts": {},\n  "publishConfig": {\n    "registry": "https://registry.npmjs.org/",\n    "access": "restricted"\n  },\n  "devDependencies": {},\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"--i-your-new-workflow",children:"- I. Your new workflow"}),"\n",(0,s.jsxs)(n.p,{children:["\u2022 Step 1: Open a ",(0,s.jsx)(n.code,{children:"side-branch"}),", make changes & commit them.\n\u2022 Step 2: Run the command ",(0,s.jsx)(n.code,{children:"npm run cs-add"}),", choose a semver, and add a short description.\n\u2022 Step 3: Run the command ",(0,s.jsx)(n.code,{children:"npm run cs-add"}),", choose a semver, and add a short description of what has been done.\n\u2022 Step 4: Make a pull request to the ",(0,s.jsx)(n.code,{children:"master"})," branch.\n\u2022 Step 5: It's up to the master branch (the CICD pipeline) to bump the version, with ",(0,s.jsx)(n.code,{children:"npm run cs-bump"}),". This creates a new commit.\n\u2022 Step 6: Also, it's up to the master branch (the CICD pipeline) to publish the version, with ",(0,s.jsx)(n.code,{children:"npm run cs-publish"}),". This does NOT create a new commit."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"publish"})," command of changesets looks at the ",(0,s.jsx)(n.code,{children:"config.json"})," file under ",(0,s.jsx)(n.code,{children:".changesets"}),", and makes a publish based on the instruction given to it there."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-init-a-project-packagejson",children:"1. Init a project package.json"}),"\n",(0,s.jsx)(n.p,{children:"Create a new folder, and init a git project (Give it a meaningful name)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm init\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can prefix your packages, just like @redux-toolkit or @babel did, with @some-name at the beginning.",(0,s.jsx)(n.br,{}),"\n","If you wish to ",(0,s.jsx)(n.em,{children:"prefix"})," your package, you can do so manually ",(0,s.jsx)(n.em,{children:"post"})," initialization, or you can do so ",(0,s.jsx)(n.em,{children:"during"})," the init process, using the ",(0,s.jsx)(n.code,{children:"scope"})," flag:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm init --scope=talkohavy\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will have your package scoped.",(0,s.jsx)(n.br,{}),"\n",'For example, the above package would get a prefix of "@talkohavy/" added to its name.']}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-connect-project-to-github",children:"2. Connect project to GitHub"}),"\n",(0,s.jsx)(n.p,{children:"This step is mandatory. Every npm package needs to be connected to a remote git repo."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"git init\ngit add .\ngit commit -m 'first commit'\ngit remote add origin git@github.com:talkohavy/<name>.git\ngit push -u origin master\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-add-some-content-to-the-package",children:"3. Add some content to the Package"}),"\n",(0,s.jsx)(n.p,{children:"Create the following structure:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["An ",(0,s.jsx)(n.code,{children:"src"})," directory with an ",(0,s.jsx)(n.code,{children:"index.js"})]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.strong,{children:"_test_"})," folder"]}),"\n",(0,s.jsx)(n.li,{children:"A README.md file"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"And later on:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"build.config.js"}),"\n",(0,s.jsx)(n.li,{children:"jsconfig.json"}),"\n",(0,s.jsx)(n.li,{children:".npmrc"}),"\n",(0,s.jsx)(n.li,{children:"Changesets-cli"}),"\n",(0,s.jsx)(n.li,{children:"Eslint"}),"\n",(0,s.jsx)(n.li,{children:"Prettier"}),"\n",(0,s.jsx)(n.li,{children:"Husky"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-develop-a-build-process",children:"4. Develop a build process"}),"\n",(0,s.jsxs)(n.p,{children:["While you ",(0,s.jsx)(n.em,{children:"can"})," serve the root of the project as the package itself, it is not recommended. There are a lot of things you'll need to blacklist from ending up in the final output being packaged up and be published to npm."]}),"\n",(0,s.jsx)(n.p,{children:"Even if you'll go with the whitelist approach, instead of the blacklist approach, by using the \"files\" within the package.json, it is still recommended to avoid serving the root directory (whether its the src or some dist folder). This is because whitelisting is something you need to maintain, and every time you'll add a new feature you'll need to go inside the package.json and update it there."}),"\n",(0,s.jsxs)(n.p,{children:["Instead, we will go with the ",(0,s.jsx)(n.code,{children:"divide & conquer"})," approach."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"divide & conquer"})," approach dictates that the repo used to develop the package will be separated from the package that will be shipped to npm."]}),"\n",(0,s.jsx)(n.p,{children:"Any package that is designed to be published will have the following steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Clear the dist folder (",(0,s.jsx)(n.code,{children:"rm -rf dist"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Build the project (minify/compile/transpile, i.e. ",(0,s.jsx)(n.code,{children:"tsc -p tsconfig.json"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Copy & manipulate the ",(0,s.jsx)(n.code,{children:"package.json"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The benefits of the ",(0,s.jsx)(n.code,{children:"divide & conquer"})," approach:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"You don't have to whitelist anything."}),"\n",(0,s.jsx)(n.li,{children:"You don't have to blacklist anything."}),"\n",(0,s.jsx)(n.li,{children:"package.json include ONLY what it needs to thanks to the act of manipulation."}),"\n",(0,s.jsx)(n.li,{children:"Complete control of the package's structure - the output's end result."}),"\n",(0,s.jsx)(n.li,{children:"Complete separation between structures (the root and the package)."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The name ",(0,s.jsx)(n.code,{children:"divide & conquer"})," isn't an industry term, rather than a name I gave to this approach."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"5-npm-login-npm-logout-npmrc--npmignore",children:"5. npm login, npm logout, .npmrc & .npmignore"}),"\n",(0,s.jsx)(n.h3,{id:"--a-npm-login--npmrc",children:"- A. npm login & .npmrc"}),"\n",(0,s.jsx)(n.p,{children:"Publishing a package to npm requires you to be logged into npm."}),"\n",(0,s.jsx)(n.p,{children:"You can log into npm by running:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm login\n"})}),"\n",(0,s.jsx)(n.p,{children:"After running this command you'll be asked to hit enter, and a browser will open up. There, you'll have to enter a 6-digit otp, which appears on an authenticator up you have connected to your npm account beforehand."}),"\n",(0,s.jsx)(n.p,{children:"But what about CI/CD?"}),"\n",(0,s.jsxs)(n.p,{children:["A CI/CD process can't run ",(0,s.jsx)(n.code,{children:"npm login"}),".",(0,s.jsx)(n.br,{}),"\n","This is where ",(0,s.jsx)(n.code,{children:".npmrc"})," comes into the picture.",(0,s.jsx)(n.br,{}),"\n","A configuration file for npm."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:".npmrc"})," file can be:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"per project (found at the project's root directory)"}),"\n",(0,s.jsx)(n.li,{children:"per user (found at the ~/.npmrc)"}),"\n",(0,s.jsx)(n.li,{children:"global config file (found at $PREFIX/etc/npmrc)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:".npmrc"})," file will contain a ",(0,s.jsx)(n.em,{children:"token"})," which will be used to publish our package without having to log in using the ",(0,s.jsx)(n.code,{children:"npm login"})," command."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"registry=https://registry.example.com/\n//registry.npmjs.org/:_authToken=npm_some-long-hash\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You'll of course need to create an ",(0,s.jsx)(n.strong,{children:"access token"})," on npm's website, under your profile. The token always starts with \"npm_\", so it's easy to recognize."]}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:["Make sure to NOT commit the ",(0,s.jsx)(n.code,{children:".npmrc"})," file! The token is highly sensitive!",(0,s.jsx)(n.br,{}),"\n","You must add it to your ",(0,s.jsx)(n.code,{children:".gitignore"}),"!"]})}),"\n",(0,s.jsx)(n.h3,{id:"--b-npm-logout",children:"- B. npm logout"}),"\n",(0,s.jsxs)(n.p,{children:["Just as there is a command of ",(0,s.jsx)(n.code,{children:"npm login"})," to get you logged in, there's also a command to logout:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm logout\n"})}),"\n",(0,s.jsxs)(n.p,{children:["It is ",(0,s.jsx)(n.strong,{children:"SUPER"})," important to know this command and understand what it does under the hood, because it's not so straightforward."]}),"\n",(0,s.jsxs)(n.p,{children:["Not only that ",(0,s.jsx)(n.code,{children:"npm logout"})," logs you out, it also ",(0,s.jsx)(n.strong,{children:"DELETES"}),' the .npmrc file. So if you find yourself asking "where did my npmrc file go?", it could very much be that you ran ',(0,s.jsx)(n.code,{children:"npm logout"}),", which deleted your file."]}),"\n",(0,s.jsxs)(n.p,{children:["Another important piece of information is: if you had a token that should last a year, and you just committed an ",(0,s.jsx)(n.code,{children:"npm logout"}),", you have invalidated your token permanently! And it can no longer be used!"]}),"\n",(0,s.jsx)(n.p,{children:"To sum it up, npm logout does 2 things:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["It deleted the line which includes the token from your .npmrc file.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If your ",(0,s.jsx)(n.code,{children:".npmrc"})," file contains only that 1 line with the token, the .npmrc file is deleted for good."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"It invalidates the token."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"--c-npmignore",children:"- C. .npmignore"}),"\n",(0,s.jsxs)(n.p,{children:["You can use the ",(0,s.jsx)(n.code,{children:".npmignore"})," to blacklist files and folders from getting to the final package output that'll be published on npm."]}),"\n",(0,s.jsxs)(n.p,{children:["However, since we'll be using the ",(0,s.jsx)(n.code,{children:"divide & conquer"})," approach, the use of ",(0,s.jsx)(n.code,{children:".npmignore"})," will be minimal, if any."]}),"\n",(0,s.jsx)(n.h3,{id:"--d-npm-login-deep-dive",children:"- D. npm login Deep Dive"}),"\n",(0,s.jsxs)(n.p,{children:["When you run ",(0,s.jsx)(n.code,{children:"npm login"}),", an ",(0,s.jsx)(n.code,{children:".npmrc"})," file is created (or is being updated if it already exists) with a fresh new token. This means that if a previous existing (either by ",(0,s.jsx)(n.code,{children:"npm login"})," or by copy-pasting a generated ",(0,s.jsx)(n.em,{children:"Access Token"})," from npm), it is now gone. Erased."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6-versioning",children:"6. Versioning"}),"\n",(0,s.jsx)(n.p,{children:"A common error you'll bump into is when you'll try to re-publish a package using the same version already registered on npm."}),"\n",(0,s.jsxs)(n.p,{children:["Before running the ",(0,s.jsx)(n.code,{children:"publish"})," command, you'll need to bump the version.",(0,s.jsx)(n.br,{}),"\n","In fact, that's the ",(0,s.jsx)(n.em,{children:"only"})," change that's required by npm in order to be able to publish a new release."]}),"\n",(0,s.jsx)(n.p,{children:"To bump a version there are 3 commands ou can use:"}),"\n",(0,s.jsx)(n.p,{children:"When doing a bugfix:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm version patch -m 'Upgrade to %s: some-message'\n"})}),"\n",(0,s.jsx)(n.p,{children:"When adding a new feature:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm version minor -m 'Upgrade to %s: some-message'\n"})}),"\n",(0,s.jsx)(n.p,{children:"When doing a breaking-change:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm version major -m 'Upgrade to %s: some-message'\n"})}),"\n",(0,s.jsx)(n.p,{children:"In order to run either one of these, your git tree must be clean. If it's not, you'll get an error telling you to stash your changes and then try again."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"7-the-role-of-packagejson",children:"7. The role of package.json"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"package.json"})," file plays a huge role when it comes to publishing a package on npm."]}),"\n",(0,s.jsx)(n.p,{children:"It contains keys/fields, that could make or break the publish's output."}),"\n",(0,s.jsxs)(n.h3,{id:"--a-required-keys-within-your-packagejson",children:["- A. ",(0,s.jsx)(n.strong,{children:"REQUIRED"})," keys within your ",(0,s.jsx)(n.code,{children:"package.json"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"name"}),"\n",(0,s.jsx)(n.li,{children:"version"}),"\n",(0,s.jsx)(n.li,{children:"main"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Your ",(0,s.jsx)(n.code,{children:"package.json"})," MUST include a ",(0,s.jsx)(n.code,{children:"name"}),", a ",(0,s.jsx)(n.code,{children:"version"}),", and a ",(0,s.jsx)(n.code,{children:"main"}),".",(0,s.jsx)(n.br,{}),"\n","While the lack of ",(0,s.jsx)(n.code,{children:"name"}),", a ",(0,s.jsx)(n.code,{children:"version"})," would fail the ",(0,s.jsx)(n.em,{children:"publish"})," process, the lack of main would not. However, you would not be able to import ",(0,s.jsx)(n.em,{children:"anything"})," from the end result package! You would even get a runtime error if you try."]}),"\n",(0,s.jsxs)(n.h3,{id:"--b-important-keys-inside-your-packagejson",children:["- B. ",(0,s.jsx)(n.strong,{children:"IMPORTANT"})," keys inside your ",(0,s.jsx)(n.code,{children:"package.json"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"exports"}),"\n",(0,s.jsx)(n.li,{children:"files"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"exports"})," field in package.json is a relatively new addition to the npm ecosystem. It allows you as the package's author to explicitly define which modules are available for consumption when the package is imported. This helps in providing a more controlled and secure interface, limiting access to internal files that shouldn't be exposed to end-users.",(0,s.jsx)(n.br,{}),"\n","The ",(0,s.jsx)(n.code,{children:"exports"})," field ",(0,s.jsx)(n.strong,{children:"OVERRIDES"})," whatever that is written under the ",(0,s.jsx)(n.code,{children:"main"})," key, and can replace it entirely."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  // "main": "lib/index.js", // <--- not needed now that exports exists. Has no affect.\n  "exports": {\n    ".": {\n      "import": "./lib/index.js",\n      "require": "./lib/index.cjs"\n    }\n  },\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"files"})," key is mean for whitelisting. Only files specified under files will end up in the end-result output of the publish."]}),"\n",(0,s.jsxs)(n.h3,{id:"--c-nice-to-have-keys-inside-your-packagejson",children:["- C. ",(0,s.jsx)(n.strong,{children:"Nice to have"})," keys inside your ",(0,s.jsx)(n.code,{children:"package.json"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"repository"}),"\n",(0,s.jsxs)(n.li,{children:["publishConfig","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"registry"}),"\n",(0,s.jsx)(n.li,{children:"access"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"license (MIT, ISC, etc.)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"8-publishing-a-package-to-an-npm-registry",children:"8. Publishing a package to an npm registry"}),"\n",(0,s.jsx)(n.p,{children:"Now that everything is set, it's time we upload/publish our package to our npm registry."}),"\n",(0,s.jsx)(n.p,{children:"You can publish the package by running the command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm publish\n"})}),"\n",(0,s.jsx)(n.p,{children:"To help you visualize what exactly is going to be publish, you can run a dry-run publish command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm publish --dry-run\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will spit out all sorts of useful information."}),"\n",(0,s.jsx)(n.p,{children:"By default, scoped packages are published with private visibility. To publish a scoped package with public visibility, use npm publish --access public."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Note: You cannot change the visibility of an unscoped package. Only scoped packages with a paid subscription may be private."})}),"\n",(0,s.jsx)(n.p,{children:"If your package is prefixed (i.e. scoped with @talkohavy), you'll have to add the access public flag:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm publish --access=public\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Without the access public flag, you'll get an error saying you must sign up for private packages, and the the publish command will fail.",(0,s.jsx)(n.br,{}),"\n","This is because when trying to publish, by default, npm thinks you're trying to publish a private package. You can fix this by adding the ",(0,s.jsx)(n.code,{children:"access"})," flag to the publish command, and setting it to ",(0,s.jsx)(n.em,{children:"public"}),", telling npm that this package is in fact public."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"9-a-publishs-output---deep-dive-strategy",children:"9. A publish's output - Deep Dive Strategy"}),"\n",(0,s.jsxs)(n.p,{children:["Earlier in this guide we talked about the ",(0,s.jsx)(n.code,{children:"divide & conquer"})," approach, where separate the package's output to be published from the repo itself."]}),"\n",(0,s.jsx)(n.p,{children:"Let's take a deep-dive into what it actually means."}),"\n",(0,s.jsx)(n.h3,{id:"--a-a-second-packagejson",children:"- A. A second package.json"}),"\n",(0,s.jsxs)(n.p,{children:["In the build process, we create a ",(0,s.jsx)(n.code,{children:"dist"})," folder. If we were to use the the ",(0,s.jsx)(n.code,{children:"main"})," key within our package.json that resides in our root directory, to point to an index.js file within our ",(0,s.jsx)(n.code,{children:"dist"})," folder, it would result in that ",(0,s.jsx)(n.code,{children:"dist"})," folder appearing in our end result output. But what if we don't to see a ",(0,s.jsx)(n.code,{children:"dist"})," folder as part of our end result? What if we wanted to see just a single file in there?"]}),"\n",(0,s.jsxs)(n.p,{children:["To that goal, and in order to achieve maximum control over our final structure, we would have ourselves a second ",(0,s.jsx)(n.code,{children:"package.json"}),'. This is what we called earlier as "Copy & manipulate the package.json".']}),"\n",(0,s.jsx)(n.p,{children:"In this step, we take the package.json found in our root directory, and copy it into our dist folder. Not before we manipulate it a bit though. The manipulation can have multiple benefits:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"We can remove scripts"}),' - stuff like "test" or "lint". They are no longer needed.']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"We can change access"}),' - We can have the initial package.json start off as "restricted", thus ensuring one can\'t accidentally publish the root as a package, and only during manipulation change it to "public".']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"We can change the private boolean"})," - We can have the initial package.json start off as ",(0,s.jsx)(n.code,{children:'"private": true'}),", which is another way to ensure that no one can publish the root as a package, and only during manipulation, we remove this key entirely."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"--b-a-readmemd-file",children:"- B. A README.md file"}),"\n",(0,s.jsxs)(n.p,{children:["Copy the readme.md file ",(0,s.jsx)(n.em,{children:"as-is"})," to the ",(0,s.jsx)(n.code,{children:"dist"})," folder. This readme file will appear on npm main page of the package, serving as a Getting-Started information on how-to-use the package to other developers."]}),"\n",(0,s.jsx)(n.h3,{id:"--c-main-types--exports-pointing",children:"- C. main, types & exports pointing"}),"\n",(0,s.jsxs)(n.p,{children:['Since I know that there\'s going to be another package.json generated within the dist folder, the pointing on the keys "main", "types", and "exports" should be in relation to ',(0,s.jsx)(n.em,{children:"that"})," package.json."]}),"\n",(0,s.jsx)(n.p,{children:"Let's say you have this project structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"|-- src/\n|-- dist/\n|    |\n|    |-- lib/\n|    |    |\n|    |    |-- index.js\n|    |-- index.d.js\n|    |-- package.json (copied & manipulated)\n|    |-- README.md (copied)\n|-- package.json\n|-- README.md\n"})}),"\n",(0,s.jsx)(n.p,{children:'In the example case above, the pointing of "main" should NOT be "dist/lib/index.js", but rather "lib/index.js". Same for "types", it should be "index.d.js". Same goes for exports:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"exports": {\n  ".": {\n    "import": "./lib/index.js",\n    "require": "./lib/index.cjs"\n  }\n},\n'})}),"\n",(0,s.jsx)(n.h3,{id:"--d-a-complete-build-process",children:"- D. A complete build process"}),"\n",(0,s.jsxs)(n.p,{children:["What I like to do is create a ",(0,s.jsx)(n.code,{children:"build.config.js"})," at the root of the project, and have it look like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import { execSync } from 'child_process';\nimport fs from 'fs';\n\nconst outDirName = 'dist';\n\nbuildPackageConfig();\n\nasync function buildPackageConfig() {\n  cleanDistDirectory();\n\n  buildWithTsc();\n\n  copyReadmeFile();\n\n  copyAndManipulatePackageJsonFile();\n\n  console.log('DONE !!!');\n}\n\nfunction cleanDistDirectory() {\n  console.log('- Step 1: clear the dist directory');\n  execSync('rm -rf dist');\n}\n\nfunction buildWithTsc() {\n  console.log('- Step 2: build with tsc');\n  execSync('tsc -p jsconfig.json');\n}\n\nfunction copyReadmeFile() {\n  console.log('- Step 3: copy the README.md file');\n  const readStreamReadmeMd = fs.createReadStream('./README.md');\n  const writeStreamReadmeMd = fs.createWriteStream(`./${outDirName}/README.md`);\n  readStreamReadmeMd.pipe(writeStreamReadmeMd);\n}\n\nfunction copyAndManipulatePackageJsonFile() {\n  console.log('- Step 4: copy & manipulate the package.json file');\n  // Step 1: get the original package.json file\n  const packageJson = JSON.parse(fs.readFileSync('./package.json').toString());\n\n  // Step 2: Remove all scripts\n  delete packageJson.scripts;\n  console.log('-- deleted `scripts` key');\n\n  // Step 3: Change from private to public\n  delete packageJson.private;\n  packageJson.publishConfig.access = 'public';\n  console.log('-- changed from private to public');\n  console.log('-- changed publishConfig access to public');\n\n  // Step 4: create new package.json file in the output folder\n  fs.writeFileSync(`./${outDirName}/package.json`, JSON.stringify(packageJson));\n  console.log('-- package.json file written successfully!');\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"And now i'm just adding the following script:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "build": "node build.config.js",\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"--e-the-publish-command-as-a-script",children:"- E. The publish command as a script"}),"\n",(0,s.jsx)(n.p,{children:"And finally, i'll create a script that looks like:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    // ...\n    "pub": "npm run build && cd dist && npm publish",\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"10-typescript-types",children:"10. Typescript Types"}),"\n",(0,s.jsx)(n.p,{children:"When you involve typescript, everything changes. New behaviors are introduced, and subtle differences are brought to the table."}),"\n",(0,s.jsx)(n.h3,{id:"--a-emitting-pure-javascript",children:"- A. Emitting Pure Javascript"}),"\n",(0,s.jsx)(n.p,{children:"If your package emits a plain javascript, without so much as a declaration file (.d.ts file) then nothing changes for you. Everything will work as expected."}),"\n",(0,s.jsx)(n.h3,{id:"--b-emitting-js--dts-files",children:"- B. Emitting .js & .d.ts files"}),"\n",(0,s.jsx)(n.p,{children:"This is the most common use-case."}),"\n",(0,s.jsxs)(n.p,{children:["When writing a package in typescript, you'll end up needing to compile it down to javascript. Doesn't matter which tool you use, under the hood they all use ",(0,s.jsx)(n.strong,{children:"tsc"}),", so I'll be using it directly."]}),"\n",(0,s.jsxs)(n.p,{children:["The end result of the compilation process will create a ",(0,s.jsx)(n.code,{children:"dist"})," folder, along with some js files, and a main declaration file - ",(0,s.jsx)(n.code,{children:"index.d.ts"}),". There can be other declaration files emitted during the process, which will be sibling to that ",(0,s.jsx)(n.code,{children:"index.d.ts"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"In this setting, where there are .d.ts files in the final output, there are some subtle differences."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:'The difference between "exports" and "main"'})}),"\n",(0,s.jsx)(n.h3,{id:"--c-using-only-ts-files",children:"- C. Using ONLY .ts files"}),"\n",(0,s.jsx)(n.p,{children:"Let's compare 3 cases:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Having an only js package with ",(0,s.jsx)(n.code,{children:'"main": "lib/index.js"'}),","]}),"\n",(0,s.jsxs)(n.li,{children:["Having an only js package with ",(0,s.jsx)(n.code,{children:'"exports": {".": { "import": "./lib/index.js" }}'})]}),"\n",(0,s.jsxs)(n.li,{children:["Having Case 1 with ",(0,s.jsx)(n.code,{children:'"types": "index.d.ts"'})]}),"\n",(0,s.jsxs)(n.li,{children:["Having Case 2 with ",(0,s.jsx)(n.code,{children:'"types": "index.d.ts"'})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["First of all, it is important to know - not including a ",(0,s.jsx)(n.code,{children:'"types": "index.d.ts"'}),", in your ",(0,s.jsx)(n.code,{children:"package.json"}),", doesn't mean that it defaults to nothing. In fact, the defaults ",(0,s.jsx)(n.em,{children:"is"})," ",(0,s.jsx)(n.code,{children:'"types": "index.d.ts"'}),"!"]}),"\n",(0,s.jsxs)(n.p,{children:['The "types" field only exists for when you have a root .d.ts file with a name that\'s outside the convention on ',(0,s.jsx)(n.code,{children:"index.d.ts"}),", or that it is located deeper in some nested folder, and not on the root."]}),"\n",(0,s.jsxs)(n.p,{children:["By default, using the ",(0,s.jsx)(n.code,{children:"exports"})," key sets every possible key that can be added under it to null."]}),"\n",(0,s.jsx)(n.p,{children:'"."'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"11-auto-completion--auto-suggestion",children:"11. Auto-Completion & Auto-Suggestion"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"12-versioning-helper---changesetscli",children:"12. Versioning Helper - Changesets/cli"}),"\n",(0,s.jsxs)(n.p,{children:["While you can use ",(0,s.jsx)(n.code,{children:"npm version patch/minor/major"}),", it's impractical."]}),"\n",(0,s.jsxs)(n.p,{children:["The flow of versioning is made easy with the help of a tool called ",(0,s.jsx)(n.code,{children:"changesets/cli"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"--a-getting-started",children:"- A. Getting Started"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install -D @changesets/cli\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or..."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add -D @changesets/cli\n"})}),"\n",(0,s.jsx)(n.p,{children:"If this is your first time using changesets in this project, run this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm changeset init\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will create a ",(0,s.jsx)(n.code,{children:".changeset"})," folder with 2 files inside:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"config.json"}),"\n",(0,s.jsx)(n.li,{children:"README.md"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The config file is filled with all sorts of helpful configurations and tooltips explaining what each one does."}),"\n",(0,s.jsx)(n.p,{children:"Two things you'll most definitely want/need to change are:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:'"baseBranch": "main", which determines the branch that Changesets uses when finding what packages have changed. If you set a branch name that doesn\'t exists, the process will fail.'}),"\n",(0,s.jsxs)(n.li,{children:['"commit": false, set it to ',(0,s.jsx)(n.code,{children:"true"})," instead."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"--b-add-new-scripts-to-packagejson",children:"- B. Add new scripts to package.json"}),"\n",(0,s.jsx)(n.p,{children:"Add these new scripts to your package.json:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts:" {\n    "cs-add": "pnpm changeset add",\n    "cs-bump": "pnpm changeset version",\n    "cs-status": "pnpm changeset status --verbose",\n    "cs-publish": "cd dist && pnpm changeset publish"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"--c-add-copy-changeset-to-your-copy-flow",children:"- C. Add copy changeset to your copy flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",metastring:"{11-12,18-26} showLineNumbers",children:"/* eslint-disable */\nimport { execSync } from 'child_process';\nimport fs, { cpSync } from 'fs';\n\nconst outDirName = 'dist';\n\nbuildPackageConfig();\n\nasync function buildPackageConfig() {\n  cleanDistDirectory();\n  // ...\n  copyChangesetDirectory();\n  copyNpmIgnore();\n  // ...\n\n  console.log('DONE !!!');\n}\n\nfunction copyChangesetDirectory() {\n  console.log('- Step 5: copy the .changeset directory');\n  cpSync('.changeset', `${outDirName}/.changeset`, { recursive: true });\n}\n\nfunction copyNpmIgnore() {\n  console.log('- Step 6: copy the .npmignore file');\n  cpSync('.npmignore', `${outDirName}/.npmignore`);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"--d-versioning-flow---how-to-use",children:"- D. Versioning Flow - How to use"}),"\n",(0,s.jsx)(n.p,{children:"Once you've completed the initial setup, the flow is very simple:"}),"\n",(0,s.jsx)(n.h4,{id:"step-1-make-changes--commit-them",children:"Step 1: Make changes & commit them"}),"\n",(0,s.jsxs)(n.p,{children:["Adding a new feature, fixing a bug, or having breaking changes are the only time that this flow is valid. Needless to say that usually when doing either one of these you are standing on a ",(0,s.jsx)(n.code,{children:"side-branch"}),", away from ",(0,s.jsx)(n.code,{children:"master"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"You DO NOT publish a new version of your package simply because you added eslint, or prettier! Theses aren't bugs, or feature that affect the end result package!"})}),"\n",(0,s.jsx)(n.h4,{id:"step-2-run-the-changeset-add-command",children:"Step 2: Run the changeset ADD command"}),"\n",(0,s.jsx)(n.p,{children:"When all commits are done, it's then time to log what has been done."}),"\n",(0,s.jsx)(n.p,{children:"Run the newly created script:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm run cs-add\n"})}),"\n",(0,s.jsx)(n.p,{children:"Choose the semver, and give a short description of what has been done."}),"\n",(0,s.jsxs)(n.p,{children:["You ",(0,s.jsx)(n.em,{children:"can"}),", and sometimes ",(0,s.jsx)(n.em,{children:"should"}),', run the "cs-add" command several times, once for each change that has been made for this current release.']}),"\n",(0,s.jsxs)(n.p,{children:['Each time you run the "cs-add" command, an md file with some weird name will be created under the ',(0,s.jsx)(n.code,{children:".changesets"})," directory."]}),"\n",(0,s.jsx)(n.h4,{id:"step-3-run-the-changeset-status-command",children:"Step 3: Run the changeset STATUS command"}),"\n",(0,s.jsx)(n.p,{children:"To view everything that's going to be added to this release using the ADD command, you can use the STATUS command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm run cs-status\n"})}),"\n",(0,s.jsx)(n.h4,{id:"step-4-run-the-changeset-version-command",children:"Step 4: Run the changeset VERSION command"}),"\n",(0,s.jsx)(n.p,{children:"When you're ready to bump the version, with all the logs you've made, run the BUMP script we've added earlier:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm run cs-bump\n"})}),"\n",(0,s.jsx)(n.p,{children:"This action will take all those md files with weird names, calculate the version number, create or update the CHANGELOG.md file with everything you wrote as notes, and then delete all those weird named files, as they've already served their purpose. These files are meant to be temporary. Their only role is to serve as information guide to the VERSION command."}),"\n",(0,s.jsx)(n.h4,{id:"step-5-run-the-changeset-publish-command",children:"Step 5: Run the changeset PUBLISH command"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"PUBLISH"})," command of changesets looks at the ",(0,s.jsx)(n.code,{children:"config.json"})," file under ",(0,s.jsx)(n.code,{children:".changesets"}),", and makes a publish based on the instruction given to it there."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"13-finalize-process---test--build",children:"13. Finalize Process - test & build"}),"\n",(0,s.jsx)(n.p,{children:"In order to have the flow easy, let's make sure we are running as few script as possible, in a way that makes sense."}),"\n",(0,s.jsx)(n.p,{children:"Look at the following snippet from my package.json:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "clean": "rm -rf dist",\n    "test": "node --test",\n    "build-full": "node build.config.js",\n    "cs-add": "pnpm changeset add",\n    "cs-bump": "npm test && pnpm changeset version",\n    "cs-status": "pnpm changeset status --verbose",\n    "cs-publish": "pnpm run build-full && cd dist && pnpm changeset publish"\n  },\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Notice that right before running the \"bump\" command, that's when I'm running my tests, so there can never be a version upgrade when tests are failing."}),"\n",(0,s.jsx)(n.p,{children:"Notice that right before running the \"publish\" command, that's when I'm running the full-build process that creates the dist folder, along with everything needed for its publish. Since the publish itself is tightly coupled with the output of the build process, it made sense to chain them together."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"999-check-locally-using-pnpm-link---global",children:["999. Check locally using ",(0,s.jsx)(n.code,{children:"pnpm link --global"})]}),"\n",(0,s.jsxs)(n.p,{children:["Before publishing a package to npm, you can test it locally by importing it to a side-project, and check that it works.",(0,s.jsx)(n.br,{}),"\n","For that we use the command ",(0,s.jsx)(n.code,{children:"pnpm link --global"})," (original command is ",(0,s.jsx)(n.code,{children:"npm link"}),")."]}),"\n",(0,s.jsxs)(n.h3,{id:"-step-1-run-pnpm-link-on-the-to-be-published-package",children:["\u2022 Step 1: Run ",(0,s.jsx)(n.code,{children:"pnpm link"})," on the to-be-published package"]}),"\n",(0,s.jsx)(n.p,{children:"Inside the to-be-published package folder, run the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm link --global\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm link\n"})}),"\n",(0,s.jsx)(n.p,{children:"depending on what you're going to use on the tester project."}),"\n",(0,s.jsxs)(n.p,{children:["Running ",(0,s.jsx)(n.code,{children:"npm link"})," symlinks a package folder. This is handy for installing your own stuff, so that you can work on it and test iteratively without having to continually rebuild."]}),"\n",(0,s.jsxs)(n.h3,{id:"-step-2-run-pnpm-link-pkg-name-on-the-tester-project",children:["\u2022 Step 2: Run ",(0,s.jsx)(n.code,{children:"pnpm link pkg-name"})," on the tester project"]}),"\n",(0,s.jsx)(n.p,{children:"Create a dummy project somewhere on your machine, and do:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm init -y\npnpm link <pkg-name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or..."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm init -y\nnpm link <pkg-name>\n"})}),"\n",(0,s.jsx)(n.p,{children:"In the dummy project, create a quick script which imports the to-be-published package, and test it."}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["HOW DOES ",(0,s.jsx)(n.code,{children:"NPM LINK"})," WORK?"]})}),(0,s.jsx)(n.p,{children:"Package linking is a two-step process:"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"npm link"})," inside the package you wish to publish"]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"npm link <pkg-name>"})," inside the test package which imports the package."]}),"\n"]}),(0,s.jsxs)(n.p,{children:["The first step will create a symlink in the global folder < prefix>/lib/node_modules/< name-of-package> that links to the package where the ",(0,s.jsx)(n.code,{children:"npm link"})," command was executed."]}),(0,s.jsx)(n.p,{children:"The second step will create a symbolic link from globally-installed package-name to node_modules/ of the current folder."}),(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"Note that package-name is taken from package.json, not from the directory name."})})]}),"\n",(0,s.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},5710:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>c});var s=i(758);const t={},o=s.createContext(t);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);